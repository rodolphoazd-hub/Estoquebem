<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Estoque - Bem Browneria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Bibliotecas para importa√ß√£o/exporta√ß√£o -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Biblioteca para scanner de c√≥digo de barras -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>

    <style>
        body {
            box-sizing: border-box;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
            }

            to {
                transform: translateX(0);
            }
        }

        .checkbox-produto {
            transform: scale(1.2);
            margin-right: 8px;
        }

        .linha-selecionada {
            background-color: #fef3c7 !important;
        }

        .acoes-multiplas {
            position: sticky;
            top: 0;
            z-index: 10;
            background: white;
            border-bottom: 2px solid #f3f4f6;
            padding: 12px;
            margin: -6px -6px 20px -6px;
            border-radius: 8px 8px 0 0;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            .mobile-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                border-top: 2px solid #F9A8D4;
                z-index: 50;
                padding: 8px;
            }

            .mobile-nav-btn {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 8px 4px;
                font-size: 10px;
                min-height: 60px;
            }

            .mobile-nav-icon {
                font-size: 20px;
                margin-bottom: 4px;
            }

            .desktop-nav {
                display: none;
            }

            .mobile-header {
                position: relative;
                z-index: 40;
            }

            .mobile-content {
                padding-bottom: 80px;
            }

            .mobile-table {
                font-size: 12px;
            }

            .mobile-table td,
            .mobile-table th {
                padding: 8px 4px;
            }

            .mobile-card {
                margin: 8px;
                padding: 16px;
            }

            .mobile-form {
                padding: 16px;
            }

            .mobile-modal {
                margin: 16px;
                max-height: calc(100vh - 32px);
            }

            .mobile-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .mobile-actions {
                flex-direction: column;
                gap: 8px;
            }

            .mobile-export {
                position: fixed;
                top: 16px;
                right: 16px;
                z-index: 30;
            }
        }

        @media (min-width: 769px) {
            .mobile-nav {
                display: none;
            }
        }
    </style>
</head>

<body class="bg-gray-50 h-screen overflow-hidden">
    <div class="flex h-full">
        <!-- Sidebar (Desktop) -->
        <aside id="desktopSidebar"
            class="hidden md:flex flex-col w-64 bg-white shadow-xl z-20 transition-all duration-300 ease-in-out transform">
            <div class="p-6 border-b border-gray-100 flex items-center justify-center">
                <div id="sidebarLogo" class="text-3xl mr-2">üßÅ</div>
                <h1 id="sidebarTitle" class="text-xl font-bold text-gray-800">Doce Controle</h1>
            </div>

            <nav class="flex-1 overflow-y-auto py-4 px-3 space-y-2">
                <button onclick="showSection('dashboard')"
                    class="nav-btn w-full flex items-center px-4 py-3 rounded-xl transition-all duration-200 bg-pink-500 text-white shadow-md">
                    <span class="text-xl mr-3">üìä</span>
                    <span class="font-medium">Dashboard</span>
                </button>

                <button onclick="showSection('vendas')"
                    class="nav-btn w-full flex items-center px-4 py-3 rounded-xl transition-all duration-200 text-gray-600 hover:bg-pink-50 hover:text-pink-600">
                    <span class="text-xl mr-3">üí∞</span>
                    <span class="font-medium">Vendas</span>
                </button>

                <button onclick="showSection('receitas')"
                    class="nav-btn w-full flex items-center px-4 py-3 rounded-xl transition-all duration-200 text-gray-600 hover:bg-pink-50 hover:text-pink-600">
                    <span class="text-xl mr-3">üìù</span>
                    <span class="font-medium">Receitas</span>
                </button>

                <div class="pt-4 mt-4 border-t border-gray-100">
                    <p class="px-4 text-xs font-semibold text-gray-400 uppercase mb-2">Sistema</p>

                    <button onclick="showSection('configuracoes')"
                        class="nav-btn w-full flex items-center px-4 py-3 rounded-xl transition-all duration-200 text-gray-600 hover:bg-pink-50 hover:text-pink-600">
                        <span class="text-xl mr-3">‚öôÔ∏è</span>
                        <span class="font-medium">Configura√ß√µes</span>
                    </button>

                    <button onclick="showSection('personalizacao')"
                        class="nav-btn w-full flex items-center px-4 py-3 rounded-xl transition-all duration-200 text-gray-600 hover:bg-pink-50 hover:text-pink-600">
                        <span class="text-xl mr-3">üé®</span>
                        <span class="font-medium">Personalizar</span>
                    </button>
                </div>
            </nav>

            <div class="p-4 border-t border-gray-100 bg-gray-50">
                <div class="flex items-center space-x-3">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-xs text-gray-500 font-medium" id="sidebar-time"></span>
                </div>
            </div>
        </aside>

        <!-- Main Content Wrapper -->
        <div class="flex-1 flex flex-col h-full overflow-hidden relative">
            <!-- Header (Simplified) -->
            <header class="bg-white shadow-sm border-b mobile-header z-10">
                <div class="px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between items-center py-3">
                        <!-- Mobile Logo (Only visible on small screens) -->
                        <div class="flex items-center md:hidden">
                            <div id="mobileLogo" class="text-2xl mr-2">üßÅ</div>
                            <h1 id="mobileTitle" class="text-lg font-bold text-gray-800">Doce Controle</h1>
                        </div>

                        <!-- Sidebar Toggle Button (Desktop) -->
                        <div class="hidden md:flex items-center">
                            <button onclick="toggleSidebar()"
                                class="p-2 rounded-lg text-gray-600 hover:bg-gray-100 focus:outline-none">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 6h16M4 12h16M4 18h16"></path>
                                </svg>
                            </button>
                        </div>

                        <!-- Right Actions -->
                        <div class="flex items-center space-x-3">
                            <!-- Bot√£o de Alertas -->
                            <div class="relative">
                                <button onclick="toggleAlertas()"
                                    class="relative bg-white text-gray-600 hover:text-yellow-600 p-2 rounded-lg transition-colors duration-200 border border-transparent hover:border-gray-200"
                                    title="Alertas do Sistema">
                                    <span class="text-xl">üîî</span>
                                    <span id="badgeAlertas"
                                        class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center font-bold">0</span>
                                </button>

                                <!-- Dropdown de Alertas -->
                                <div id="dropdownAlertas"
                                    class="hidden absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50">
                                    <!-- ... (Previous Alert Content maintained by logic, but need to re-insert markup) ... -->
                                    <div class="p-4 border-b border-gray-200">
                                        <div class="flex justify-between items-center">
                                            <h3 class="font-semibold text-gray-800">üö® Alertas do Sistema</h3>
                                            <button onclick="verificarNotificacoes()"
                                                class="text-blue-600 hover:text-blue-800 text-sm">Atualizar</button>
                                        </div>
                                    </div>
                                    <div id="listaAlertas" class="max-h-64 overflow-y-auto">
                                        <div class="p-4 text-center text-gray-500">
                                            Nenhum alerta no momento
                                        </div>
                                    </div>
                                    <div class="p-3 border-t border-gray-200 bg-gray-50 rounded-b-lg">
                                        <button onclick="showSection('configuracoes')"
                                            class="w-full text-center text-sm text-blue-600 hover:text-blue-800">
                                            ‚öôÔ∏è Configurar Notifica√ß√µes
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Mobile Export -->
                            <div class="mobile-export md:hidden">
                                <button onclick="toggleExportMenu()"
                                    class="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-lg">
                                    üìä
                                </button>
                                <div id="exportMenu"
                                    class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border">
                                    <button onclick="exportarExcel()"
                                        class="w-full text-left px-4 py-2 hover:bg-gray-100 rounded-t-lg">üìó Exportar
                                        Excel</button>
                                    <button onclick="exportarPDF()"
                                        class="w-full text-left px-4 py-2 hover:bg-gray-100 rounded-b-lg">üìÑ Exportar
                                        PDF</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Scrollable Content Area -->
            <main
                class="flex-1 overflow-y-auto bg-gray-50 px-2 sm:px-4 lg:px-8 py-4 md:py-8 mobile-content scroll-smooth">
                <!-- Dashboard Section -->
                <section id="dashboard" class="section-content">
                    <div class="fade-in">
                        <h2 class="text-3xl font-bold text-gray-800 mb-8 flex items-center">
                            üìä Dashboard de Produtos </h2>

                        <!-- Cards de Resumo -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8">
                            <div
                                class="bg-white rounded-lg md:rounded-xl shadow-lg p-3 md:p-6 border-l-4 border-blue-500">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-xs md:text-sm font-medium text-gray-600">Total de Itens</p>
                                        <p class="text-lg md:text-2xl font-bold text-blue-600" id="totalItens">0</p>
                                    </div>
                                    <div class="text-xl md:text-3xl">üì¶</div>
                                </div>
                            </div>

                            <div
                                class="bg-white rounded-lg md:rounded-xl shadow-lg p-3 md:p-6 border-l-4 border-red-500">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-xs md:text-sm font-medium text-gray-600">Estoque Baixo</p>
                                        <p class="text-lg md:text-2xl font-bold text-red-600" id="estoqueBaixo">0</p>
                                    </div>
                                    <div class="text-xl md:text-3xl">‚ö†Ô∏è</div>
                                </div>
                            </div>

                            <div
                                class="bg-white rounded-lg md:rounded-xl shadow-lg p-3 md:p-6 border-l-4 border-green-500">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-xs md:text-sm font-medium text-gray-600">Valor Total</p>
                                        <p class="text-lg md:text-2xl font-bold text-green-600" id="valorTotal">R$ 0,00
                                        </p>
                                    </div>
                                    <div class="text-xl md:text-3xl">üí∞</div>
                                </div>
                            </div>

                            <div
                                class="bg-white rounded-lg md:rounded-xl shadow-lg p-3 md:p-6 border-l-4 border-purple-500">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-xs md:text-sm font-medium text-gray-600">Categorias</p>
                                        <p class="text-lg md:text-2xl font-bold text-purple-600" id="totalCategorias">0
                                        </p>
                                    </div>
                                    <div class="text-xl md:text-3xl">üìã</div>
                                </div>
                            </div>
                        </div>

                        <!-- Adicionar Item -->
                        <div class="bg-white rounded-lg md:rounded-xl shadow-lg p-4 md:p-6 mb-6 md:mb-8">
                            <div
                                class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 md:mb-6 gap-3">
                                <h3 class="text-lg md:text-xl font-bold text-gray-800">‚ûï Adicionar Item</h3>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="openModal('modalImportacao')"
                                        class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                        üì• Importar Planilha
                                    </button>
                                </div>
                            </div>
                            <form onsubmit="adicionarItemDashboard(event)"
                                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3 md:gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Item</label>
                                    <input type="text" id="nomeItemDash" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                                    <select id="categoriaItemDash" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                        <option value="">Selecione</option>
                                        <option value="Ingredientes B√°sicos">Ingredientes B√°sicos</option>
                                        <option value="Decora√ß√£o">Decora√ß√£o</option>
                                        <option value="Embalagens">Embalagens</option>
                                        <option value="Latic√≠nios">Latic√≠nios</option>
                                        <option value="Frutas">Frutas</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Quantidade</label>
                                    <input type="number" id="quantidadeItemDash" required min="0.01" step="0.01"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Unidade</label>
                                    <select id="unidadeItemDash" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                        <option value="kg">kg</option>
                                        <option value="g">g</option>
                                        <option value="L">L</option>
                                        <option value="ml">ml</option>
                                        <option value="un">un</option>
                                        <option value="cx">cx</option>
                                        <option value="pct">pct</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pre√ßo por Unidade
                                        (R$)</label>
                                    <input type="number" id="precoItemDash" required min="0" step="0.01"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Data de Validade</label>
                                    <input type="date" id="validadeItemDash"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Marca</label>
                                    <input type="text" id="marcaItemDash"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                <div class="col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">C√≥digo de Barras</label>
                                    <div class="flex space-x-2">
                                        <input type="text" id="codigoBarrasItemDash"
                                            placeholder="Digite ou escaneie o c√≥digo"
                                            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            onblur="verificarCodigoBarrasUnico('codigoBarrasItemDash', 'dashboard')">
                                        <button type="button" onclick="iniciarScanner('codigoBarrasItemDash')"
                                            class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded-lg transition-colors duration-200"
                                            title="Escanear c√≥digo de barras">
                                            üì∑
                                        </button>
                                    </div>
                                    <div id="alertaCodigoDash"
                                        class="hidden mt-2 text-sm text-red-600 bg-red-50 border border-red-200 rounded-lg p-2">
                                        ‚ö†Ô∏è Este c√≥digo de barras j√° est√° sendo usado por outro produto!
                                    </div>
                                </div>
                                <div class="flex items-end">
                                    <button type="submit"
                                        class="w-full bg-pink-500 hover:bg-pink-600 text-white py-2 px-4 rounded-lg font-medium transition-colors duration-200">
                                        Adicionar Item
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Lista de Invent√°rio -->
                        <div class="bg-white rounded-lg md:rounded-xl shadow-lg p-4 md:p-6">
                            <div
                                class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 md:mb-6 gap-3">
                                <h3 class="text-lg md:text-xl font-bold text-gray-800">üìã Lista de Invent√°rio</h3>
                                <div class="hidden md:flex space-x-3">
                                    <button onclick="exportarExcel()"
                                        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                        üìó Exportar Excel
                                    </button>
                                    <button onclick="exportarPDF()"
                                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                        üìÑ Exportar PDF
                                    </button>
                                </div>
                            </div>

                            <!-- Controles de Busca e Filtros -->
                            <div class="bg-gray-50 rounded-lg p-3 md:p-4 mb-4 md:mb-6">
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-3 md:gap-4">
                                    <!-- Busca -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üîç Buscar</label>
                                        <input type="text" id="buscarInventario" placeholder="Nome, marca ou c√≥digo..."
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            onkeyup="filtrarInventario()">
                                    </div>

                                    <!-- Filtrar por Categoria -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Filtrar por
                                            Categoria</label>
                                        <select id="filtroCategoria"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            onchange="filtrarInventario()">
                                            <option value="">Todas as categorias</option>
                                            <option value="Ingredientes B√°sicos">Ingredientes B√°sicos</option>
                                            <option value="Decora√ß√£o">Decora√ß√£o</option>
                                            <option value="Embalagens">Embalagens</option>
                                            <option value="Latic√≠nios">Latic√≠nios</option>
                                            <option value="Frutas">Frutas</option>
                                        </select>
                                    </div>

                                    <!-- Filtrar por Estoque -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Filtrar por
                                            Estoque</label>
                                        <select id="filtroEstoque"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            onchange="filtrarInventario()">
                                            <option value="">Todos os n√≠veis</option>
                                            <option value="baixo">üî¥ Estoque Baixo</option>
                                            <option value="medio">üü° Estoque M√©dio</option>
                                            <option value="alto">üü¢ Estoque Alto</option>
                                        </select>
                                    </div>

                                    <!-- Ordenar por -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ordenar por</label>
                                        <select id="ordenarPor"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            onchange="filtrarInventario()">
                                            <option value="nome">Nome (A-Z)</option>
                                            <option value="nome-desc">Nome (Z-A)</option>
                                            <option value="categoria">Categoria</option>
                                            <option value="quantidade">Quantidade (Menor)</option>
                                            <option value="quantidade-desc">Quantidade (Maior)</option>
                                            <option value="preco">Pre√ßo (Menor)</option>
                                            <option value="preco-desc">Pre√ßo (Maior)</option>
                                            <option value="valor-total">Valor Total (Menor)</option>
                                            <option value="valor-total-desc">Valor Total (Maior)</option>
                                            <option value="validade">Validade (Pr√≥xima)</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Bot√£o Limpar Filtros -->
                                <div class="mt-4 flex justify-between items-center">
                                    <button onclick="limparFiltros()"
                                        class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition-colors duration-200">
                                        üóëÔ∏è Limpar Filtros
                                    </button>
                                    <div id="resultadosFiltro" class="text-sm text-gray-600">
                                        Mostrando todos os itens
                                    </div>
                                </div>
                            </div>

                            <!-- A√ß√µes em Lote -->
                            <div id="acoesBatch" class="acoes-multiplas hidden">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-4">
                                        <span id="itensSelecionados" class="text-sm font-medium text-gray-700">0 itens
                                            selecionados</span>
                                        <button onclick="selecionarTodos()"
                                            class="text-sm text-blue-600 hover:text-blue-800">Selecionar Todos</button>
                                        <button onclick="deselecionarTodos()"
                                            class="text-sm text-gray-600 hover:text-gray-800">Desmarcar Todos</button>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="excluirSelecionados()"
                                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                            üóëÔ∏è Excluir Selecionados
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 mobile-table">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                <input type="checkbox" id="selectAll" class="checkbox-produto"
                                                    onchange="toggleSelectAll()">
                                            </th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Item</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Categoria</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Quantidade</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Pre√ßo Unit.</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Valor Total</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Status</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventarioDashboard" class="bg-white divide-y divide-gray-200">
                                        <!-- Itens do invent√°rio ser√£o inseridos aqui -->
                                    </tbody>
                                </table>
                            </div>

                            <!-- Pagina√ß√£o -->
                            <div class="flex items-center justify-between mt-6">
                                <div class="flex items-center space-x-4">
                                    <label class="text-sm font-medium text-gray-700">Itens por p√°gina:</label>
                                    <select id="itensPorPagina"
                                        class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                        onchange="mudarItensPorPagina()">
                                        <option value="10">10</option>
                                        <option value="25" selected>25</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>

                                <div class="flex items-center space-x-2">
                                    <button id="btnAnterior" onclick="paginaAnterior()"
                                        class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                                        disabled>
                                        ‚Üê Anterior
                                    </button>
                                    <div id="infoPagina" class="px-4 py-2 text-sm text-gray-700">
                                        P√°gina 1 de 1
                                    </div>
                                    <button id="btnProximo" onclick="proximaPagina()"
                                        class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                                        disabled>
                                        Pr√≥ximo ‚Üí
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Vendas Section -->
                <section id="vendas" class="section-content hidden">
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-8">
                            <h2 class="text-3xl font-bold text-gray-800 flex items-center">
                                üí∞ Controle de Vendas
                            </h2>
                            <div class="flex space-x-3">
                                <button onclick="openModal('modalVenda')"
                                    class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                    ‚ûï Novo Pedido
                                </button>
                            </div>
                        </div>

                        <!-- Cards de Vendas -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8">
                            <div
                                class="bg-white rounded-lg md:rounded-xl shadow-lg p-3 md:p-6 border-l-4 border-green-500">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-xs md:text-sm font-medium text-gray-600">Vendas Hoje</p>
                                        <p class="text-lg md:text-2xl font-bold text-green-600" id="vendasHoje">R$ 0,00
                                        </p>
                                    </div>
                                    <div class="text-xl md:text-3xl">üìà</div>
                                </div>
                            </div>

                            <div
                                class="bg-white rounded-lg md:rounded-xl shadow-lg p-3 md:p-6 border-l-4 border-blue-500">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-xs md:text-sm font-medium text-gray-600">Vendas do M√™s</p>
                                        <p class="text-lg md:text-2xl font-bold text-blue-600" id="vendasMes">R$ 0,00
                                        </p>
                                    </div>
                                    <div class="text-xl md:text-3xl">üíµ</div>
                                </div>
                            </div>

                            <div
                                class="bg-white rounded-lg md:rounded-xl shadow-lg p-3 md:p-6 border-l-4 border-purple-500">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-xs md:text-sm font-medium text-gray-600">Lucro do M√™s</p>
                                        <p class="text-lg md:text-2xl font-bold text-purple-600" id="lucroMes">R$ 0,00
                                        </p>
                                    </div>
                                    <div class="text-xl md:text-3xl">üíé</div>
                                </div>
                            </div>

                            <div
                                class="bg-white rounded-lg md:rounded-xl shadow-lg p-3 md:p-6 border-l-4 border-orange-500">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-xs md:text-sm font-medium text-gray-600">Margem M√©dia</p>
                                        <p class="text-lg md:text-2xl font-bold text-orange-600" id="margemMedia">0%</p>
                                    </div>
                                    <div class="text-xl md:text-3xl">üìä</div>
                                </div>
                            </div>
                        </div>

                        <!-- Gr√°ficos de An√°lise -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                            <!-- Evolu√ß√£o do Lucro -->
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <div
                                    class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-3">
                                    <h3 class="text-lg font-bold text-gray-800 flex items-center">
                                        üìà Evolu√ß√£o do Lucro
                                    </h3>
                                    <div class="flex flex-col md:flex-row gap-2">
                                        <select id="filtroPer√≠odoLucro"
                                            class="px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                            onchange="atualizarGraficoEvolucaoLucro()">
                                            <option value="7">√öltimos 7 dias</option>
                                            <option value="15">√öltimos 15 dias</option>
                                            <option value="30" selected>√öltimos 30 dias</option>
                                            <option value="60">√öltimos 60 dias</option>
                                            <option value="90">√öltimos 90 dias</option>
                                        </select>
                                        <select id="filtroTipoLucro"
                                            class="px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                            onchange="atualizarGraficoEvolucaoLucro()">
                                            <option value="lucro">Lucro</option>
                                            <option value="vendas">Vendas</option>
                                            <option value="margem">Margem M√©dia</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="h-64 flex items-end justify-between space-x-1" id="graficoEvolucaoLucro">
                                    <!-- Barras do gr√°fico ser√£o inseridas aqui -->
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <p id="labelPeriodoLucro" class="text-sm text-gray-600">√öltimos 30 dias</p>
                                    <div class="flex items-center space-x-4 text-xs">
                                        <div id="totalPeriodoLucro" class="text-green-600 font-medium"></div>
                                        <div id="mediaPeriodoLucro" class="text-blue-600 font-medium"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Vendas vs Lucro Mensal -->
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                    üí∞ Vendas vs Lucro (√öltimos 6 meses)
                                </h3>
                                <div class="h-64" id="graficoVendasLucro">
                                    <div class="h-full flex items-end justify-between space-x-2">
                                        <!-- Barras comparativas ser√£o inseridas aqui -->
                                    </div>
                                </div>
                                <div class="mt-4 flex justify-center space-x-4 text-sm">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-blue-500 rounded mr-2"></div>
                                        <span class="text-gray-600">Vendas</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-green-500 rounded mr-2"></div>
                                        <span class="text-gray-600">Lucro</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Produtos Mais Lucrativos -->
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                    üèÜ Produtos Mais Lucrativos
                                </h3>
                                <div id="produtosMaisLucrativos" class="space-y-3">
                                    <!-- Lista de produtos ser√° inserida aqui -->
                                </div>
                            </div>

                            <!-- Distribui√ß√£o de Margem -->
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                    üéØ Distribui√ß√£o de Margem
                                </h3>
                                <div id="graficoDistribuicaoMargem" class="h-64 flex items-center justify-center">
                                    <!-- Gr√°fico de pizza ser√° inserido aqui -->
                                </div>
                                <div class="mt-4 grid grid-cols-3 gap-2 text-xs">
                                    <div class="text-center">
                                        <div class="w-4 h-4 bg-red-500 rounded mx-auto mb-1"></div>
                                        <span class="text-gray-600">Baixa (&lt;30%)</span>
                                    </div>
                                    <div class="text-center">
                                        <div class="w-4 h-4 bg-yellow-500 rounded mx-auto mb-1"></div>
                                        <span class="text-gray-600">M√©dia (30-60%)</span>
                                    </div>
                                    <div class="text-center">
                                        <div class="w-4 h-4 bg-green-500 rounded mx-auto mb-1"></div>
                                        <span class="text-gray-600">Alta (&gt;60%)</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hist√≥rico de Vendas -->
                        <div class="bg-white rounded-lg md:rounded-xl shadow-lg p-4 md:p-6">
                            <div
                                class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 md:mb-6 gap-3">
                                <h3 class="text-lg md:text-xl font-bold text-gray-800">üìã Hist√≥rico de Vendas</h3>
                                <div class="hidden md:flex space-x-3">
                                    <button onclick="exportarVendasExcel()"
                                        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                        üìó Exportar Excel
                                    </button>
                                    <button onclick="exportarVendasPDF()"
                                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                        üìÑ Exportar PDF
                                    </button>
                                </div>
                            </div>

                            <!-- Controles de Busca e Filtros -->
                            <div class="bg-gray-50 rounded-lg p-3 md:p-4 mb-4 md:mb-6">
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-3 md:gap-4">
                                    <!-- Busca -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üîç Buscar</label>
                                        <input type="text" id="buscarVendas" placeholder="Cliente, produto..."
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                            onkeyup="filtrarVendas()">
                                    </div>

                                    <!-- Filtrar por Per√≠odo -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Per√≠odo</label>
                                        <select id="filtroPeriodo"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                            onchange="filtrarVendas()">
                                            <option value="">Todos os per√≠odos</option>
                                            <option value="hoje">Hoje</option>
                                            <option value="semana">Esta semana</option>
                                            <option value="mes">Este m√™s</option>
                                            <option value="trimestre">√öltimo trimestre</option>
                                        </select>
                                    </div>

                                    <!-- Filtrar por Valor -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Valor da
                                            Venda</label>
                                        <select id="filtroValor"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                            onchange="filtrarVendas()">
                                            <option value="">Todos os valores</option>
                                            <option value="baixo">At√© R$ 50</option>
                                            <option value="medio">R$ 50 - R$ 200</option>
                                            <option value="alto">Acima de R$ 200</option>
                                        </select>
                                    </div>

                                    <!-- Ordenar por -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ordenar por</label>
                                        <select id="ordenarVendasPor"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                            onchange="filtrarVendas()">
                                            <option value="data-desc">Data (Mais recente)</option>
                                            <option value="data">Data (Mais antiga)</option>
                                            <option value="cliente">Cliente (A-Z)</option>
                                            <option value="cliente-desc">Cliente (Z-A)</option>
                                            <option value="total">Valor (Menor)</option>
                                            <option value="total-desc">Valor (Maior)</option>
                                            <option value="lucro">Lucro (Menor)</option>
                                            <option value="lucro-desc">Lucro (Maior)</option>
                                            <option value="margem">Margem (Menor)</option>
                                            <option value="margem-desc">Margem (Maior)</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Bot√£o Limpar Filtros -->
                                <div class="mt-4 flex justify-between items-center">
                                    <button onclick="limparFiltrosVendas()"
                                        class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition-colors duration-200">
                                        üóëÔ∏è Limpar Filtros
                                    </button>
                                    <div id="resultadosFiltroVendas" class="text-sm text-gray-600">
                                        Mostrando todas as vendas
                                    </div>
                                </div>
                            </div>

                            <!-- A√ß√µes em Lote -->
                            <div id="acoesVendasBatch" class="acoes-multiplas hidden">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-4">
                                        <span id="vendasSelecionadas" class="text-sm font-medium text-gray-700">0 vendas
                                            selecionadas</span>
                                        <button onclick="selecionarTodasVendas()"
                                            class="text-sm text-blue-600 hover:text-blue-800">Selecionar Todas</button>
                                        <button onclick="deselecionarTodasVendas()"
                                            class="text-sm text-gray-600 hover:text-gray-800">Desmarcar Todas</button>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="excluirVendasSelecionadas()"
                                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                            üóëÔ∏è Excluir Selecionadas
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 mobile-table">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                <input type="checkbox" id="selectAllVendas" class="checkbox-produto"
                                                    onchange="toggleSelectAllVendas()">
                                            </th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Data</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Cliente</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Itens</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Total</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Lucro</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Margem</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabelaVendas" class="bg-white divide-y divide-gray-200">
                                        <!-- Vendas ser√£o inseridas aqui -->
                                    </tbody>
                                </table>
                            </div>

                            <!-- Pagina√ß√£o de Vendas -->
                            <div class="flex items-center justify-between mt-6">
                                <div class="flex items-center space-x-4">
                                    <label class="text-sm font-medium text-gray-700">Vendas por p√°gina:</label>
                                    <select id="vendasPorPagina"
                                        class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                        onchange="mudarVendasPorPagina()">
                                        <option value="10">10</option>
                                        <option value="25" selected>25</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>

                                <div class="flex items-center space-x-2">
                                    <button id="btnAnteriorVendas" onclick="paginaAnteriorVendas()"
                                        class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                                        disabled>
                                        ‚Üê Anterior
                                    </button>
                                    <div id="infoPaginaVendas" class="px-4 py-2 text-sm text-gray-700">
                                        P√°gina 1 de 1
                                    </div>
                                    <button id="btnProximoVendas" onclick="proximaPaginaVendas()"
                                        class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                                        disabled>
                                        Pr√≥ximo ‚Üí
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Receitas Section -->
                <section id="receitas" class="section-content hidden">
                    <div class="fade-in">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-3">
                            <h2 class="text-3xl font-bold text-gray-800 flex items-center">

                            </h2>
                            <div class="flex flex-wrap gap-3">
                                <button onclick="openModal('modalImportacaoReceitas')"
                                    class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                    üì• Importar Receitas
                                </button>
                                <div class="hidden md:flex space-x-2">
                                    <button onclick="exportarReceitasExcel()"
                                        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                        üìó Exportar Excel
                                    </button>
                                    <button onclick="exportarReceitasPDF()"
                                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                        üìÑ Exportar PDF
                                    </button>
                                </div>
                                <button onclick="openModal('modalReceita')"
                                    class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                    ‚ûï Nova Receita
                                </button>
                            </div>
                        </div>

                        <!-- Lista de Receitas -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="listaReceitas">
                            <!-- Receitas ser√£o inseridas aqui -->
                        </div>
                    </div>
                </section>

                <!-- Configura√ß√µes Section -->
                <section id="configuracoes" class="section-content hidden">
                    <div class="fade-in">
                        <h2 class="text-3xl font-bold text-gray-800 mb-8 flex items-center">
                            ‚öôÔ∏è Configura√ß√µes do Sistema
                        </h2>

                        <!-- Limites de Estoque por Unidade de Medida -->
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-bold text-gray-800 flex items-center">
                                    üìä Limites de Estoque por Unidade de Medida
                                </h3>
                                <button onclick="restaurarPadroes()"
                                    class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                    üîÑ Restaurar Padr√µes
                                </button>
                            </div>

                            <!-- Como Funciona -->
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                                <h4 class="font-semibold text-blue-800 mb-2 flex items-center">
                                    üí° Como Funciona
                                </h4>
                                <p class="text-blue-700 text-sm mb-3">
                                    Configure os limites ideais para cada unidade de medida. O sistema usar√° estes
                                    valores para
                                    classificar automaticamente o status do estoque:
                                </p>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
                                    <div class="flex items-center">
                                        <span class="text-red-500 mr-2">üî¥</span>
                                        <span class="text-blue-700"><strong>Estoque Baixo:</strong> Abaixo do limite
                                            m√≠nimo</span>
                                    </div>
                                    <div class="flex items-center">
                                        <span class="text-yellow-500 mr-2">üü°</span>
                                        <span class="text-blue-700"><strong>Estoque M√©dio:</strong> Entre m√≠nimo e
                                            m√°ximo</span>
                                    </div>
                                    <div class="flex items-center">
                                        <span class="text-green-500 mr-2">üü¢</span>
                                        <span class="text-blue-700"><strong>Estoque Alto:</strong> Acima do limite
                                            m√°ximo</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Configura√ß√£o de Limites -->
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <!-- Unidades de Peso -->
                                <div>
                                    <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                                        ‚öñÔ∏è Unidades de Peso
                                    </h4>
                                    <div class="space-y-4">
                                        <div class="bg-gray-50 rounded-lg p-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Quilogramas
                                                (kg)</label>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√≠nimo</label>
                                                    <input type="number" id="limite-kg-min" value="1" min="0" step="0.1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√°ximo</label>
                                                    <input type="number" id="limite-kg-max" value="10" min="0"
                                                        step="0.1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-gray-50 rounded-lg p-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Gramas
                                                (g)</label>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√≠nimo</label>
                                                    <input type="number" id="limite-g-min" value="100" min="0" step="1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√°ximo</label>
                                                    <input type="number" id="limite-g-max" value="1000" min="0" step="1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Unidades de Volume -->
                                <div>
                                    <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                                        ü•õ Unidades de Volume
                                    </h4>
                                    <div class="space-y-4">
                                        <div class="bg-gray-50 rounded-lg p-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Litros
                                                (L)</label>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√≠nimo</label>
                                                    <input type="number" id="limite-L-min" value="1" min="0" step="0.1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√°ximo</label>
                                                    <input type="number" id="limite-L-max" value="10" min="0" step="0.1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-gray-50 rounded-lg p-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Mililitros
                                                (ml)</label>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√≠nimo</label>
                                                    <input type="number" id="limite-ml-min" value="100" min="0" step="1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√°ximo</label>
                                                    <input type="number" id="limite-ml-max" value="1000" min="0"
                                                        step="1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Unidades e Embalagens -->
                                <div>
                                    <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                                        üì¶ Unidades e Embalagens
                                    </h4>
                                    <div class="space-y-4">
                                        <div class="bg-gray-50 rounded-lg p-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Unidades
                                                (un)</label>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√≠nimo</label>
                                                    <input type="number" id="limite-un-min" value="5" min="0" step="1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√°ximo</label>
                                                    <input type="number" id="limite-un-max" value="50" min="0" step="1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-gray-50 rounded-lg p-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Caixas
                                                (cx)</label>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√≠nimo</label>
                                                    <input type="number" id="limite-cx-min" value="2" min="0" step="1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√°ximo</label>
                                                    <input type="number" id="limite-cx-max" value="20" min="0" step="1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-gray-50 rounded-lg p-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Pacotes
                                                (pct)</label>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√≠nimo</label>
                                                    <input type="number" id="limite-pct-min" value="3" min="0" step="1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-1">M√°ximo</label>
                                                    <input type="number" id="limite-pct-max" value="30" min="0" step="1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        onchange="salvarLimites()">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Resumo dos Limites -->
                            <div class="mt-8">
                                <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                                    üìã Resumo dos Limites Configurados
                                </h4>
                                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3" id="resumoLimites">
                                    <!-- Resumo ser√° inserido aqui -->
                                </div>
                                <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <p class="text-yellow-800 text-sm">
                                        <strong>üí° Dica:</strong> Ajuste os limites baseado no seu consumo m√©dio e
                                        frequ√™ncia de
                                        compras. Produtos com maior rotatividade precisam de limites mais altos.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Notifica√ß√µes Push -->
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-bold text-gray-800 flex items-center">
                                    üì± Notifica√ß√µes Push
                                </h3>
                                <button onclick="verificarNotificacoes()"
                                    class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center">
                                    üîî Verificar Alertas
                                </button>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <!-- Configura√ß√µes de Notifica√ß√£o -->
                                <div>
                                    <div class="space-y-4">
                                        <label
                                            class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer">
                                            <input type="checkbox" id="notificarEstoqueBaixo" checked
                                                class="rounded border-gray-300 text-purple-600 focus:ring-purple-500 mr-3"
                                                onchange="salvarConfiguracoes()">
                                            <div>
                                                <div class="font-medium text-gray-800">Notificar quando estoque baixo
                                                </div>
                                                <div class="text-sm text-gray-600">Receba alertas quando produtos
                                                    atingirem o
                                                    limite m√≠nimo</div>
                                            </div>
                                        </label>

                                        <label
                                            class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer">
                                            <input type="checkbox" id="notificarVencimento" checked
                                                class="rounded border-gray-300 text-purple-600 focus:ring-purple-500 mr-3"
                                                onchange="salvarConfiguracoes()">
                                            <div>
                                                <div class="font-medium text-gray-800">Notificar produtos pr√≥ximos ao
                                                    vencimento
                                                </div>
                                                <div class="text-sm text-gray-600">Alertas para produtos que est√£o
                                                    pr√≥ximos da
                                                    data de validade</div>
                                            </div>
                                        </label>

                                        <label
                                            class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer">
                                            <input type="checkbox" id="notificarWhatsApp"
                                                class="rounded border-gray-300 text-purple-600 focus:ring-purple-500 mr-3"
                                                onchange="salvarConfiguracoes()">
                                            <div>
                                                <div class="font-medium text-gray-800">Enviar avisos por WhatsApp ou
                                                    email</div>
                                                <div class="text-sm text-gray-600">Receba notifica√ß√µes tamb√©m em canais
                                                    externos
                                                </div>
                                            </div>
                                        </label>

                                        <label
                                            class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer">
                                            <input type="checkbox" id="notificacaoAutomatica"
                                                class="rounded border-gray-300 text-purple-600 focus:ring-purple-500 mr-3"
                                                onchange="salvarConfiguracoes()">
                                            <div>
                                                <div class="font-medium text-gray-800">Verifica√ß√£o autom√°tica de alertas
                                                </div>
                                                <div class="text-sm text-gray-600">Verifica automaticamente a cada 30
                                                    minutos
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Configura√ß√µes de Vencimento -->
                                <div>
                                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4">
                                        <h4 class="font-semibold text-orange-800 mb-4 flex items-center">
                                            ‚è∞ Dias de Anteced√™ncia para Vencimento
                                        </h4>
                                        <div class="flex items-center space-x-4">
                                            <input type="number" id="diasAntecedencia" value="7" min="1" max="30"
                                                class="w-20 px-3 py-2 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-center font-bold text-lg"
                                                onchange="salvarConfiguracoes()">
                                            <span class="text-orange-700 font-medium">dias</span>
                                        </div>
                                        <p class="text-orange-700 text-sm mt-2">
                                            Quantos dias antes do vencimento voc√™ quer ser notificado
                                        </p>
                                    </div>

                                    <!-- Status das Notifica√ß√µes -->
                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                        <h4 class="font-semibold text-blue-800 mb-3 flex items-center">
                                            üìä Status Atual dos Alertas
                                        </h4>
                                        <div id="statusNotificacoes" class="space-y-2 text-sm">
                                            <div class="flex justify-between">
                                                <span class="text-blue-700">Produtos com estoque baixo:</span>
                                                <span id="countEstoqueBaixo" class="font-bold text-red-600">0</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-blue-700">Produtos pr√≥ximos ao vencimento:</span>
                                                <span id="countVencimento" class="font-bold text-orange-600">0</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-blue-700">√öltima verifica√ß√£o:</span>
                                                <span id="ultimaVerificacao"
                                                    class="font-medium text-blue-800">Nunca</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Configura√ß√µes de Contato (aparece quando WhatsApp est√° ativo) -->
                                    <div id="configContato" class="hidden mt-4 space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">WhatsApp</label>
                                            <input type="tel" id="whatsappContato" placeholder="(11) 99999-9999"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                onchange="salvarConfiguracoes()">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                            <input type="email" id="emailContato" placeholder="seu@email.com"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                onchange="salvarConfiguracoes()">
                                        </div>

                                        <!-- Bot√£o de Teste de Envio -->
                                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                            <h5 class="font-semibold text-blue-800 mb-3 flex items-center">
                                                üì§ Teste de Envio Manual
                                            </h5>
                                            <p class="text-blue-700 text-sm mb-4">
                                                Envie um relat√≥rio de alertas manualmente para testar suas configura√ß√µes
                                                de
                                                contato.
                                            </p>
                                            <div class="flex space-x-2">
                                                <button onclick="enviarAlertasWhatsApp()"
                                                    class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center">
                                                    üì± Enviar WhatsApp
                                                </button>
                                                <button onclick="enviarAlertasEmail()"
                                                    class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center">
                                                    üìß Enviar Email
                                                </button>
                                            </div>
                                            <div class="mt-3">
                                                <button onclick="gerarRelatorioAlertas()"
                                                    class="w-full bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center">
                                                    üìã Gerar Relat√≥rio Completo
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Backup e Restaura√ß√£o -->
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                üíæ Backup e Restaura√ß√£o
                            </h3>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                                    <h4 class="font-semibold text-green-800 mb-3 flex items-center">
                                        üì§ Exportar Backup
                                    </h4>
                                    <p class="text-green-700 text-sm mb-4">
                                        Salve todos os seus dados (produtos, receitas, vendas e configura√ß√µes) em um
                                        arquivo
                                        seguro.
                                    </p>
                                    <button onclick="exportarBackup()"
                                        class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg font-medium transition-colors duration-200">
                                        üì• Fazer Backup Completo
                                    </button>
                                </div>

                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                    <h4 class="font-semibold text-blue-800 mb-3 flex items-center">
                                        üì• Importar Backup
                                    </h4>
                                    <p class="text-blue-700 text-sm mb-4">
                                        Restaure seus dados de um arquivo de backup anterior. <strong>Aten√ß√£o:</strong>
                                        Isso
                                        substituir√° todos os dados atuais.
                                    </p>
                                    <button onclick="importarBackup()"
                                        class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors duration-200">
                                        üì§ Restaurar Backup
                                    </button>
                                </div>

                                <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                                    <h4 class="font-semibold text-red-800 mb-3 flex items-center">
                                        üóëÔ∏è Limpar Sistema
                                    </h4>
                                    <p class="text-red-700 text-sm mb-4">
                                        Remove todos os dados do sistema e reinicia completamente.
                                        <strong>Cuidado:</strong>
                                        Esta a√ß√£o n√£o pode ser desfeita!
                                    </p>
                                    <button onclick="limparTodosDados()"
                                        class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium transition-colors duration-200">
                                        üóëÔ∏è Limpar Todos os Dados
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Gerenciamento de Categorias -->
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                üìÇ Gerenciamento de Categorias
                            </h3>

                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <!-- Lista de Categorias -->
                                <div>
                                    <h4 class="font-semibold text-gray-800 mb-4">Categorias Existentes</h4>
                                    <div class="space-y-3" id="listaCategorias">
                                        <!-- Categorias ser√£o inseridas aqui -->
                                    </div>

                                    <!-- Adicionar Nova Categoria -->
                                    <div class="mt-4 flex space-x-2">
                                        <input type="text" id="novaCategoria" placeholder="Nome da nova categoria"
                                            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            onkeypress="if(event.key==='Enter') adicionarCategoria()">
                                        <button onclick="adicionarCategoria()"
                                            class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200">
                                            ‚ûï Adicionar
                                        </button>
                                    </div>
                                </div>

                                <!-- Estat√≠sticas das Categorias -->
                                <div>
                                    <h4 class="font-semibold text-gray-800 mb-4">Estat√≠sticas por Categoria</h4>
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <div class="space-y-2" id="estatisticasCategorias">
                                            <!-- Estat√≠sticas ser√£o inseridas aqui -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Configura√ß√µes Gerais -->
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-6">Configura√ß√µes Gerais</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Moeda do Sistema</label>
                                    <select id="moeda"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        onchange="salvarConfiguracoes()">
                                        <option value="BRL">üáßüá∑ Real Brasileiro (R$)</option>
                                        <option value="USD">üá∫üá∏ D√≥lar Americano ($)</option>
                                        <option value="EUR">üá™üá∫ Euro (‚Ç¨)</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Fuso Hor√°rio</label>
                                    <select
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                        <option value="America/Sao_Paulo">üáßüá∑ Bras√≠lia (GMT-3)</option>
                                        <option value="America/New_York">üá∫üá∏ Nova York (GMT-5)</option>
                                        <option value="Europe/London">üá¨üáß Londres (GMT+0)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Personaliza√ß√£o Section -->
                <section id="personalizacao" class="section-content hidden">
                    <div class="fade-in">
                        <h2 class="text-3xl font-bold text-gray-800 mb-8 flex items-center">
                            üé® Personaliza√ß√£o do Sistema
                        </h2>

                        <div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8">
                            <!-- Identidade Visual -->
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                    üè∑Ô∏è Identidade da Empresa
                                </h3>

                                <div class="space-y-6">
                                    <!-- Nome da Empresa -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome da
                                            Empresa</label>
                                        <input type="text" id="nomeEmpresa" value="Doce Controle"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            onchange="atualizarNomeEmpresa()">
                                        <p class="text-xs text-gray-500 mt-1">Este nome aparecer√° no cabe√ßalho do
                                            sistema</p>
                                    </div>

                                    <!-- Logo da Empresa -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Logo da
                                            Empresa</label>
                                        <div class="space-y-3">
                                            <!-- Upload de Logo -->
                                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-pink-400 transition-colors cursor-pointer"
                                                onclick="document.getElementById('logoUpload').click()">
                                                <div class="text-2xl mb-2">üìÅ</div>
                                                <p class="text-sm text-gray-600">Clique para fazer upload do logo</p>
                                                <p class="text-xs text-gray-400 mt-1">PNG, JPG ou SVG (m√°x. 2MB)</p>
                                                <input type="file" id="logoUpload" accept="image/*" class="hidden"
                                                    onchange="processarLogo(this)">
                                            </div>

                                            <!-- Preview do Logo -->
                                            <div id="logoPreview" class="hidden bg-gray-50 rounded-lg p-4 text-center">
                                                <img id="logoImage" src="" alt="Logo" class="max-h-16 mx-auto mb-2">
                                                <button onclick="removerLogo()"
                                                    class="text-red-500 hover:text-red-700 text-sm">üóëÔ∏è Remover
                                                    Logo</button>
                                            </div>

                                            <!-- Emojis Alternativos -->
                                            <div>
                                                <label class="block text-sm font-medium text-gray-500 mb-2">Ou escolha
                                                    um
                                                    emoji:</label>
                                                <div class="grid grid-cols-8 gap-2">
                                                    <button onclick="selecionarEmoji('üßÅ')"
                                                        class="emoji-btn p-2 text-2xl hover:bg-pink-100 rounded-lg transition-colors">üßÅ</button>
                                                    <button onclick="selecionarEmoji('üç∞')"
                                                        class="emoji-btn p-2 text-2xl hover:bg-pink-100 rounded-lg transition-colors">üç∞</button>
                                                    <button onclick="selecionarEmoji('üéÇ')"
                                                        class="emoji-btn p-2 text-2xl hover:bg-pink-100 rounded-lg transition-colors">üéÇ</button>
                                                    <button onclick="selecionarEmoji('üç™')"
                                                        class="emoji-btn p-2 text-2xl hover:bg-pink-100 rounded-lg transition-colors">üç™</button>
                                                    <button onclick="selecionarEmoji('ü•ß')"
                                                        class="emoji-btn p-2 text-2xl hover:bg-pink-100 rounded-lg transition-colors">ü•ß</button>
                                                    <button onclick="selecionarEmoji('üç©')"
                                                        class="emoji-btn p-2 text-2xl hover:bg-pink-100 rounded-lg transition-colors">üç©</button>
                                                    <button onclick="selecionarEmoji('üßà')"
                                                        class="emoji-btn p-2 text-2xl hover:bg-pink-100 rounded-lg transition-colors">üßà</button>
                                                    <button onclick="selecionarEmoji('üçØ')"
                                                        class="emoji-btn p-2 text-2xl hover:bg-pink-100 rounded-lg transition-colors">üçØ</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Preview do Cabe√ßalho -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Preview do
                                            Cabe√ßalho:</label>
                                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                            <div class="flex items-center">
                                                <div id="previewLogo" class="text-3xl mr-3">üßÅ</div>
                                                <h1 id="previewNome" class="text-2xl font-bold text-gray-800">Doce
                                                    Controle</h1>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Temas e Modo Escuro -->
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                    üåô Temas e Modo Escuro
                                </h3>

                                <div class="space-y-6">
                                    <!-- Modo Escuro -->
                                    <div>
                                        <label
                                            class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer">
                                            <input type="checkbox" id="modoEscuro"
                                                class="rounded border-gray-300 text-gray-800 focus:ring-gray-500 mr-3"
                                                onchange="toggleModoEscuro()">
                                            <div>
                                                <div class="font-medium text-gray-800">üåô Modo Escuro</div>
                                                <div class="text-sm text-gray-600">Ativar tema escuro para reduzir o
                                                    cansa√ßo
                                                    visual</div>
                                            </div>
                                        </label>
                                    </div>

                                    <!-- Tema Principal -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-3">Tema de
                                            Cores</label>

                                        <!-- Temas Predefinidos -->
                                        <div class="grid grid-cols-2 gap-3 mb-4">
                                            <button onclick="aplicarTema('rosa')"
                                                class="tema-btn flex items-center justify-center p-4 border-2 border-pink-300 rounded-lg hover:border-pink-500 transition-colors bg-gradient-to-br from-pink-50 to-purple-50">
                                                <div class="text-center">
                                                    <div class="w-8 h-8 bg-pink-500 rounded-full mx-auto mb-2"></div>
                                                    <span class="text-sm font-medium">Rosa</span>
                                                </div>
                                            </button>
                                            <button onclick="aplicarTema('azul')"
                                                class="tema-btn flex items-center justify-center p-4 border-2 border-gray-300 rounded-lg hover:border-blue-500 transition-colors bg-gradient-to-br from-blue-50 to-indigo-50">
                                                <div class="text-center">
                                                    <div class="w-8 h-8 bg-blue-500 rounded-full mx-auto mb-2"></div>
                                                    <span class="text-sm font-medium">Azul</span>
                                                </div>
                                            </button>
                                            <button onclick="aplicarTema('verde')"
                                                class="tema-btn flex items-center justify-center p-4 border-2 border-gray-300 rounded-lg hover:border-green-500 transition-colors bg-gradient-to-br from-green-50 to-emerald-50">
                                                <div class="text-center">
                                                    <div class="w-8 h-8 bg-green-500 rounded-full mx-auto mb-2"></div>
                                                    <span class="text-sm font-medium">Verde</span>
                                                </div>
                                            </button>
                                            <button onclick="aplicarTema('roxo')"
                                                class="tema-btn flex items-center justify-center p-4 border-2 border-gray-300 rounded-lg hover:border-purple-500 transition-colors bg-gradient-to-br from-purple-50 to-violet-50">
                                                <div class="text-center">
                                                    <div class="w-8 h-8 bg-purple-500 rounded-full mx-auto mb-2"></div>
                                                    <span class="text-sm font-medium">Roxo</span>
                                                </div>
                                            </button>
                                        </div>

                                        <!-- Cores Personalizadas -->
                                        <div class="border-t pt-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-3">üé® Cores
                                                Personalizadas</label>

                                            <div class="grid grid-cols-2 gap-4">
                                                <!-- Cor Prim√°ria -->
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-2">Cor Prim√°ria</label>
                                                    <div class="flex items-center space-x-2">
                                                        <input type="color" id="corPrimaria" value="#ec4899"
                                                            class="w-12 h-10 border border-gray-300 rounded-lg cursor-pointer"
                                                            onchange="aplicarCoresPersonalizadas()">
                                                        <div class="flex-1">
                                                            <input type="text" id="corPrimariaHex" value="#ec4899"
                                                                class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                                onchange="sincronizarCorPrimaria()"
                                                                placeholder="#ec4899">
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Cor Secund√°ria -->
                                                <div>
                                                    <label class="block text-xs text-gray-600 mb-2">Cor
                                                        Secund√°ria</label>
                                                    <div class="flex items-center space-x-2">
                                                        <input type="color" id="corSecundaria" value="#a855f7"
                                                            class="w-12 h-10 border border-gray-300 rounded-lg cursor-pointer"
                                                            onchange="aplicarCoresPersonalizadas()">
                                                        <div class="flex-1">
                                                            <input type="text" id="corSecundariaHex" value="#a855f7"
                                                                class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                                onchange="sincronizarCorSecundaria()"
                                                                placeholder="#a855f7">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Bot√µes de A√ß√£o -->
                                            <div class="flex space-x-2 mt-4">
                                                <button onclick="aplicarCoresPersonalizadas()"
                                                    class="flex-1 bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white py-2 px-4 rounded-lg text-sm font-medium transition-colors duration-200">
                                                    ‚ú® Aplicar Cores
                                                </button>
                                                <button onclick="gerarPaletaAleatoria()"
                                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg text-sm font-medium transition-colors duration-200">
                                                    üé≤ Aleat√≥rio
                                                </button>
                                            </div>

                                            <!-- Paletas Sugeridas -->
                                            <div class="mt-4">
                                                <label class="block text-xs text-gray-600 mb-2">üí° Paletas
                                                    Sugeridas</label>
                                                <div class="grid grid-cols-4 gap-2">
                                                    <button onclick="aplicarPaletaSugerida('#ff6b6b', '#4ecdc4')"
                                                        class="h-8 rounded-lg border border-gray-300 hover:border-gray-500 transition-colors"
                                                        style="background: linear-gradient(45deg, #ff6b6b 50%, #4ecdc4 50%)"
                                                        title="Coral & Turquesa"></button>
                                                    <button onclick="aplicarPaletaSugerida('#667eea', '#764ba2')"
                                                        class="h-8 rounded-lg border border-gray-300 hover:border-gray-500 transition-colors"
                                                        style="background: linear-gradient(45deg, #667eea 50%, #764ba2 50%)"
                                                        title="Azul & Roxo"></button>
                                                    <button onclick="aplicarPaletaSugerida('#f093fb', '#f5576c')"
                                                        class="h-8 rounded-lg border border-gray-300 hover:border-gray-500 transition-colors"
                                                        style="background: linear-gradient(45deg, #f093fb 50%, #f5576c 50%)"
                                                        title="Rosa & Vermelho"></button>
                                                    <button onclick="aplicarPaletaSugerida('#4facfe', '#00f2fe')"
                                                        class="h-8 rounded-lg border border-gray-300 hover:border-gray-500 transition-colors"
                                                        style="background: linear-gradient(45deg, #4facfe 50%, #00f2fe 50%)"
                                                        title="Azul Claro"></button>
                                                    <button onclick="aplicarPaletaSugerida('#43e97b', '#38f9d7')"
                                                        class="h-8 rounded-lg border border-gray-300 hover:border-gray-500 transition-colors"
                                                        style="background: linear-gradient(45deg, #43e97b 50%, #38f9d7 50%)"
                                                        title="Verde & Ciano"></button>
                                                    <button onclick="aplicarPaletaSugerida('#fa709a', '#fee140')"
                                                        class="h-8 rounded-lg border border-gray-300 hover:border-gray-500 transition-colors"
                                                        style="background: linear-gradient(45deg, #fa709a 50%, #fee140 50%)"
                                                        title="Rosa & Amarelo"></button>
                                                    <button onclick="aplicarPaletaSugerida('#a8edea', '#fed6e3')"
                                                        class="h-8 rounded-lg border border-gray-300 hover:border-gray-500 transition-colors"
                                                        style="background: linear-gradient(45deg, #a8edea 50%, #fed6e3 50%)"
                                                        title="Menta & Rosa Claro"></button>
                                                    <button onclick="aplicarPaletaSugerida('#ff9a9e', '#fecfef')"
                                                        class="h-8 rounded-lg border border-gray-300 hover:border-gray-500 transition-colors"
                                                        style="background: linear-gradient(45deg, #ff9a9e 50%, #fecfef 50%)"
                                                        title="Rosa Suave"></button>
                                                </div>
                                            </div>

                                            <!-- Preview das Cores -->
                                            <div class="mt-4 p-4 rounded-lg border border-gray-200" id="previewCores">
                                                <div class="text-xs text-gray-600 mb-2">Preview do Tema:</div>
                                                <div class="h-16 rounded-lg" id="previewGradiente"
                                                    style="background: linear-gradient(135deg, #ec4899, #a855f7)"></div>
                                                <div class="flex justify-between mt-2 text-xs text-gray-600">
                                                    <span id="previewPrimaria">#ec4899</span>
                                                    <span id="previewSecundaria">#a855f7</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Transpar√™ncia -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-3">Transpar√™ncia dos
                                            Cards</label>
                                        <div class="flex items-center space-x-4">
                                            <span class="text-sm text-gray-600">Opaco</span>
                                            <input type="range" id="transparenciaSlider" min="0.7" max="1" step="0.05"
                                                value="1" class="flex-1" onchange="ajustarTransparencia(this.value)">
                                            <span class="text-sm text-gray-600">Transparente</span>
                                        </div>
                                        <div class="text-xs text-gray-500 mt-1">Ajuste a transpar√™ncia dos elementos da
                                            interface</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Fundos e Padr√µes -->
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                    üñºÔ∏è Fundos e Padr√µes
                                </h3>

                                <div class="space-y-6">
                                    <!-- Padr√µes de Fundo -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-3">Padr√£o de
                                            Fundo</label>
                                        <div class="grid grid-cols-2 gap-3">
                                            <button onclick="aplicarPadrao('padrao')"
                                                class="padrao-btn p-4 border-2 border-pink-300 rounded-lg hover:border-pink-500 transition-colors bg-gradient-to-br from-pink-50 to-purple-50">
                                                <div class="text-center">
                                                    <div class="text-sm font-medium">Padr√£o</div>
                                                    <div class="text-xs text-gray-600">(Atual)</div>
                                                </div>
                                            </button>
                                            <button onclick="aplicarPadrao('solido')"
                                                class="padrao-btn p-4 border-2 border-gray-300 rounded-lg hover:border-gray-500 transition-colors bg-gray-100">
                                                <div class="text-center">
                                                    <div class="text-sm font-medium">S√≥lido</div>
                                                    <div class="text-xs text-gray-600">Cor √∫nica</div>
                                                </div>
                                            </button>
                                            <button onclick="aplicarPadrao('geometrico')"
                                                class="padrao-btn p-4 border-2 border-gray-300 rounded-lg hover:border-gray-500 transition-colors"
                                                style="background-image: repeating-linear-gradient(45deg, #f3f4f6 0px, #f3f4f6 10px, #e5e7eb 10px, #e5e7eb 20px);">
                                                <div class="text-center">
                                                    <div class="text-sm font-medium">Geom√©trico</div>
                                                    <div class="text-xs text-gray-600">Formas</div>
                                                </div>
                                            </button>
                                            <button onclick="aplicarPadrao('ondas')"
                                                class="padrao-btn p-4 border-2 border-gray-300 rounded-lg hover:border-gray-500 transition-colors"
                                                style="background: radial-gradient(circle at 50% 50%, #f3f4f6 0%, #e5e7eb 50%, #f3f4f6 100%);">
                                                <div class="text-center">
                                                    <div class="text-sm font-medium">Ondas</div>
                                                    <div class="text-xs text-gray-600">Suave</div>
                                                </div>
                                            </button>
                                            <button onclick="aplicarPadrao('pontos')"
                                                class="padrao-btn p-4 border-2 border-gray-300 rounded-lg hover:border-gray-500 transition-colors"
                                                style="background-image: radial-gradient(circle, #e5e7eb 1px, transparent 1px); background-size: 20px 20px;">
                                                <div class="text-center">
                                                    <div class="text-sm font-medium">Pontos</div>
                                                    <div class="text-xs text-gray-600">Discreto</div>
                                                </div>
                                            </button>
                                            <button onclick="aplicarPadrao('listras')"
                                                class="padrao-btn p-4 border-2 border-gray-300 rounded-lg hover:border-gray-500 transition-colors"
                                                style="background: repeating-linear-gradient(90deg, #f3f4f6 0px, #f3f4f6 2px, #e5e7eb 2px, #e5e7eb 4px);">
                                                <div class="text-center">
                                                    <div class="text-sm font-medium">Listras</div>
                                                    <div class="text-xs text-gray-600">Vertical</div>
                                                </div>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Upload de Fundo Personalizado -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Fundo
                                            Personalizado</label>
                                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-pink-400 transition-colors cursor-pointer"
                                            onclick="document.getElementById('fundoUpload').click()">
                                            <div class="text-2xl mb-2">üìÅ</div>
                                            <p class="text-sm text-gray-600">Upload de imagem de fundo</p>
                                            <p class="text-xs text-gray-400 mt-1">JPG ou PNG (m√°x. 5MB)</p>
                                            <input type="file" id="fundoUpload" accept="image/*" class="hidden"
                                                onchange="processarFundoPersonalizado(this)">
                                        </div>

                                        <!-- Preview do Fundo -->
                                        <div id="fundoPreview"
                                            class="hidden mt-3 bg-gray-50 rounded-lg p-4 text-center">
                                            <div class="text-sm text-gray-600 mb-2">Fundo personalizado ativo</div>
                                            <button onclick="removerFundoPersonalizado()"
                                                class="text-red-500 hover:text-red-700 text-sm">üóëÔ∏è Remover
                                                Fundo</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- A√ß√µes de Personaliza√ß√£o -->
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                ‚öôÔ∏è A√ß√µes de Personaliza√ß√£o
                            </h3>

                            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                                <button onclick="salvarPersonalizacao()"
                                    class="bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-colors duration-200 flex flex-col items-center">
                                    <div class="text-2xl mb-1">üíæ</div>
                                    <span class="text-sm">Salvar</span>
                                </button>

                                <button onclick="exportarConfiguracoes()"
                                    class="bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg font-medium transition-colors duration-200 flex flex-col items-center">
                                    <div class="text-2xl mb-1">üì§</div>
                                    <span class="text-sm">Exportar</span>
                                </button>

                                <button onclick="importarConfiguracoes()"
                                    class="bg-purple-500 hover:bg-purple-600 text-white py-3 px-4 rounded-lg font-medium transition-colors duration-200 flex flex-col items-center">
                                    <div class="text-2xl mb-1">üì•</div>
                                    <span class="text-sm">Importar</span>
                                </button>

                                <button onclick="restaurarPadraoPersonalizacao()"
                                    class="bg-orange-500 hover:bg-orange-600 text-white py-3 px-4 rounded-lg font-medium transition-colors duration-200 flex flex-col items-center">
                                    <div class="text-2xl mb-1">üîÑ</div>
                                    <span class="text-sm">Restaurar</span>
                                </button>

                                <button onclick="previewPersonalizacao()"
                                    class="bg-indigo-500 hover:bg-indigo-600 text-white py-3 px-4 rounded-lg font-medium transition-colors duration-200 flex flex-col items-center">
                                    <div class="text-2xl mb-1">üëÅÔ∏è</div>
                                    <span class="text-sm">Preview</span>
                                </button>
                            </div>

                            <!-- Status da Personaliza√ß√£o -->
                            <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-semibold text-blue-800">Status da Personaliza√ß√£o</h4>
                                        <p id="statusPersonalizacao" class="text-blue-700 text-sm">Configura√ß√µes padr√£o
                                            ativas
                                        </p>
                                    </div>
                                    <div class="text-blue-600">
                                        <span id="ultimaPersonalizacao" class="text-xs">Nunca personalizado</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>

            <!-- Modal Venda -->
            <div id="modalVenda" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                <div
                    class="bg-white rounded-lg md:rounded-xl shadow-2xl p-4 md:p-6 w-full max-w-3xl mx-2 md:mx-4 slide-in max-h-[95vh] md:max-h-[90vh] overflow-y-auto mobile-modal">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">Novo Pedido</h3>
                        <button onclick="closeModal('modalVenda')"
                            class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
                    </div>

                    <!-- Informa√ß√µes do Cliente -->
                    <div class="bg-gray-50 p-4 rounded-lg mb-6">
                        <h4 class="font-medium text-gray-800 mb-3">Informa√ß√µes do Cliente</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Cliente</label>
                                <input type="text" id="clientePedido" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                                <input type="tel" id="telefonePedido"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- Itens do Pedido -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-medium text-gray-800">Itens do Pedido</h4>
                            <button type="button" onclick="adicionarItemPedido()"
                                class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200">
                                ‚ûï Adicionar Item
                            </button>
                        </div>

                        <div id="itensPedido" class="space-y-4">
                            <!-- Primeiro item -->
                            <div class="item-pedido bg-white border border-gray-200 rounded-lg p-4">
                                <div class="flex justify-between items-start mb-3">
                                    <span class="font-medium text-gray-800">Item 1</span>
                                    <button type="button" onclick="removerItemPedido(this)"
                                        class="text-red-500 hover:text-red-700 hidden">üóëÔ∏è</button>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Receita</label>
                                        <select
                                            class="receita-select w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                            onchange="atualizarCustoItem(this)" required>
                                            <option value="">Selecione uma receita</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Quantidade</label>
                                        <input type="number"
                                            class="quantidade-item w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                            min="1" step="1" value="1" onchange="calcularTotalItem(this)" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Pre√ßo Unit.
                                            (R$)</label>
                                        <input type="number"
                                            class="preco-item w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                            min="0" step="0.01" onchange="calcularTotalItem(this)" required>
                                    </div>
                                </div>
                                <div class="mt-3 grid grid-cols-3 gap-4 text-sm">
                                    <div class="bg-gray-50 p-2 rounded">
                                        <span class="text-gray-600">Custo:</span>
                                        <span class="custo-item font-medium">R$ 0,00</span>
                                    </div>
                                    <div class="bg-gray-50 p-2 rounded">
                                        <span class="text-gray-600">Total:</span>
                                        <span class="total-item font-medium">R$ 0,00</span>
                                    </div>
                                    <div class="bg-gray-50 p-2 rounded">
                                        <span class="text-gray-600">Lucro:</span>
                                        <span class="lucro-item font-medium text-green-600">R$ 0,00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resumo do Pedido -->
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                        <h4 class="font-medium text-gray-800 mb-3">Resumo do Pedido</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600">Custo Total:</span>
                                <div id="custoTotalPedido" class="font-bold text-lg">R$ 0,00</div>
                            </div>
                            <div>
                                <span class="text-gray-600">Total do Pedido:</span>
                                <div id="totalPedido" class="font-bold text-lg text-green-600">R$ 0,00</div>
                            </div>
                            <div>
                                <span class="text-gray-600">Lucro Total:</span>
                                <div id="lucroTotalPedido" class="font-bold text-lg text-purple-600">R$ 0,00</div>
                            </div>
                            <div>
                                <span class="text-gray-600">Margem M√©dia:</span>
                                <div id="margemMediaPedido" class="font-bold text-lg text-orange-600">0%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√µes -->
                    <div class="flex space-x-3">
                        <button type="button" onclick="closeModal('modalVenda')"
                            class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg transition-colors duration-200">
                            Cancelar
                        </button>
                        <button type="button" onclick="finalizarPedido()"
                            class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg transition-colors duration-200">
                            Finalizar Pedido
                        </button>
                    </div>
                </div>
            </div>



            <!-- Modal Importa√ß√£o -->
            <div id="modalImportacao"
                class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                <div
                    class="bg-white rounded-lg md:rounded-xl shadow-2xl p-4 md:p-6 w-full max-w-4xl mx-2 md:mx-4 slide-in max-h-[95vh] md:max-h-[90vh] overflow-y-auto mobile-modal">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">üì• Importar Produtos</h3>
                        <button onclick="closeModal('modalImportacao')"
                            class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
                    </div>

                    <!-- Passo 1: Upload do Arquivo -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-medium text-gray-800">1. Selecionar Arquivo</h4>
                            <button onclick="baixarTemplate()"
                                class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 text-sm">
                                üìÑ Baixar Template
                            </button>
                        </div>

                        <!-- Drag and Drop Zone -->
                        <div id="dropZone"
                            class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors cursor-pointer">
                            <div class="text-4xl mb-4">üìÅ</div>
                            <p class="text-lg font-medium text-gray-700 mb-2">Arraste e solte seu arquivo aqui</p>
                            <p class="text-sm text-gray-500 mb-4">ou clique para selecionar</p>
                            <input type="file" id="arquivoImportacao" accept=".xlsx,.xls,.csv"
                                onchange="processarArquivo(this)" class="hidden">
                            <button type="button" onclick="document.getElementById('arquivoImportacao').click()"
                                class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-200">
                                Selecionar Arquivo
                            </button>
                            <p class="text-xs text-gray-400 mt-2">Formatos aceitos: Excel (.xlsx, .xls) e CSV (.csv)</p>
                        </div>

                        <!-- Arquivo Selecionado -->
                        <div id="arquivoSelecionado" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="text-2xl">üìÑ</div>
                                    <div>
                                        <p class="font-medium text-gray-800" id="nomeArquivo">arquivo.xlsx</p>
                                        <p class="text-sm text-gray-600" id="tamanhoArquivo">125 KB</p>
                                    </div>
                                </div>
                                <button onclick="removerArquivo()" class="text-red-500 hover:text-red-700 p-2">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Passo 2: Mapeamento de Campos -->
                    <div id="secaoMapeamento" class="hidden mb-6">
                        <h4 class="font-medium text-gray-800 mb-4">2. Mapear Campos</h4>
                        <div class="bg-gray-50 rounded-lg p-4 mb-4">
                            <p class="text-sm text-gray-600 mb-3">Associe as colunas do seu arquivo aos campos do
                                sistema:</p>
                            <div id="mapeamentoCampos" class="space-y-3">
                                <!-- Campos de mapeamento ser√£o inseridos aqui -->
                            </div>
                        </div>

                        <!-- Preview dos Dados -->
                        <div class="bg-white border border-gray-200 rounded-lg">
                            <div class="px-4 py-3 border-b border-gray-200 flex justify-between items-center">
                                <h5 class="font-medium text-gray-800">Preview dos Dados</h5>
                                <span id="contadorImportacao" class="text-sm text-gray-600">0 de 0 registros
                                    v√°lidos</span>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Nome</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Categoria</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Quantidade</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Pre√ßo</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="previewImportacao" class="bg-white divide-y divide-gray-200">
                                        <!-- Preview ser√° inserido aqui -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√µes -->
                    <div class="flex space-x-3">
                        <button type="button" onclick="closeModal('modalImportacao')"
                            class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg transition-colors duration-200">
                            Cancelar
                        </button>
                        <button type="button" onclick="executarImportacao()"
                            class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg transition-colors duration-200 opacity-50 cursor-not-allowed"
                            disabled>
                            Importar Produtos
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modal Scanner -->
            <div id="modalScanner" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                <div
                    class="bg-white rounded-lg md:rounded-xl shadow-2xl p-4 md:p-6 w-full max-w-md mx-2 md:mx-4 slide-in">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">üì∑ Scanner de C√≥digo</h3>
                        <button onclick="pararScanner()" class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
                    </div>

                    <!-- √Årea do Scanner -->
                    <div id="scanner-container" class="relative bg-black rounded-lg overflow-hidden mb-4">
                        <div id="interactive" class="viewport w-full h-64"></div>
                        <div class="absolute inset-0 border-2 border-red-500 rounded-lg pointer-events-none">
                            <div
                                class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-48 h-32 border-2 border-red-500 rounded-lg">
                            </div>
                        </div>
                    </div>

                    <!-- Instru√ß√µes -->
                    <div class="text-center mb-4">
                        <p class="text-sm text-gray-600">Posicione o c√≥digo de barras dentro do quadrado vermelho</p>
                        <p class="text-xs text-gray-500 mt-1">O scanner detectar√° automaticamente o c√≥digo</p>
                    </div>

                    <!-- Resultado -->
                    <div id="resultado-scanner" class="hidden bg-green-50 border border-green-200 rounded-lg p-3 mb-4">
                        <div class="flex items-center space-x-2">
                            <span class="text-green-600">‚úÖ</span>
                            <span class="font-medium text-green-800">C√≥digo detectado:</span>
                            <span id="codigo-detectado" class="font-mono text-green-900"></span>
                        </div>
                    </div>

                    <!-- Bot√µes -->
                    <div class="flex space-x-3">
                        <button type="button" onclick="pararScanner()"
                            class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-lg transition-colors duration-200">
                            Cancelar
                        </button>
                        <button type="button" id="btnUsarCodigo" onclick="usarCodigoDetectado()"
                            class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg transition-colors duration-200 opacity-50 cursor-not-allowed"
                            disabled>
                            Usar C√≥digo
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modal Importa√ß√£o de Receitas -->
            <div id="modalImportacaoReceitas"
                class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                <div
                    class="bg-white rounded-lg md:rounded-xl shadow-2xl p-4 md:p-6 w-full max-w-4xl mx-2 md:mx-4 slide-in max-h-[95vh] md:max-h-[90vh] overflow-y-auto mobile-modal">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">üì• Importar Receitas</h3>
                        <button onclick="closeModal('modalImportacaoReceitas')"
                            class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
                    </div>

                    <!-- Passo 1: Upload do Arquivo -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-medium text-gray-800">1. Selecionar Arquivo</h4>
                            <button onclick="baixarTemplateReceitas()"
                                class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 text-sm">
                                üìÑ Baixar Template
                            </button>
                        </div>

                        <!-- Drag and Drop Zone -->
                        <div id="dropZoneReceitas"
                            class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-purple-400 transition-colors cursor-pointer">
                            <div class="text-4xl mb-4">üìÅ</div>
                            <p class="text-lg font-medium text-gray-700 mb-2">Arraste e solte seu arquivo aqui</p>
                            <p class="text-sm text-gray-500 mb-4">ou clique para selecionar</p>
                            <input type="file" id="arquivoImportacaoReceitas" accept=".xlsx,.xls,.csv"
                                onchange="processarArquivoReceitas(this)" class="hidden">
                            <button type="button" onclick="document.getElementById('arquivoImportacaoReceitas').click()"
                                class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-200">
                                Selecionar Arquivo
                            </button>
                            <p class="text-xs text-gray-400 mt-2">Formatos aceitos: Excel (.xlsx, .xls) e CSV (.csv)</p>
                        </div>

                        <!-- Arquivo Selecionado -->
                        <div id="arquivoSelecionadoReceitas"
                            class="hidden bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="text-2xl">üìÑ</div>
                                    <div>
                                        <p class="font-medium text-gray-800" id="nomeArquivoReceitas">arquivo.xlsx</p>
                                        <p class="text-sm text-gray-600" id="tamanhoArquivoReceitas">125 KB</p>
                                    </div>
                                </div>
                                <button onclick="removerArquivoReceitas()" class="text-red-500 hover:text-red-700 p-2">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Passo 2: Mapeamento de Campos -->
                    <div id="secaoMapeamentoReceitas" class="hidden mb-6">
                        <h4 class="font-medium text-gray-800 mb-4">2. Mapear Campos</h4>
                        <div class="bg-gray-50 rounded-lg p-4 mb-4">
                            <p class="text-sm text-gray-600 mb-3">Associe as colunas do seu arquivo aos campos do
                                sistema:</p>
                            <div id="mapeamentoCamposReceitas" class="space-y-3">
                                <!-- Campos de mapeamento ser√£o inseridos aqui -->
                            </div>
                        </div>

                        <!-- Preview dos Dados -->
                        <div class="bg-white border border-gray-200 rounded-lg">
                            <div class="px-4 py-3 border-b border-gray-200 flex justify-between items-center">
                                <h5 class="font-medium text-gray-800">Preview das Receitas</h5>
                                <span id="contadorImportacaoReceitas" class="text-sm text-gray-600">0 de 0 registros
                                    v√°lidos</span>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Nome</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Rendimento</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Ingredientes</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Modo de Preparo</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="previewImportacaoReceitas" class="bg-white divide-y divide-gray-200">
                                        <!-- Preview ser√° inserido aqui -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√µes -->
                    <div class="flex space-x-3">
                        <button type="button" onclick="closeModal('modalImportacaoReceitas')"
                            class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg transition-colors duration-200">
                            Cancelar
                        </button>
                        <button type="button" onclick="executarImportacaoReceitas()"
                            class="flex-1 bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-lg transition-colors duration-200 opacity-50 cursor-not-allowed"
                            disabled>
                            Importar Receitas
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modal Receita -->
            <div id="modalReceita" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                <div
                    class="bg-white rounded-lg md:rounded-xl shadow-2xl p-4 md:p-6 w-full max-w-3xl mx-2 md:mx-4 slide-in max-h-[95vh] md:max-h-[90vh] overflow-y-auto mobile-modal">
                    <div class="flex justify-between items-center mb-6">
                        <h3 id="tituloModalReceita" class="text-xl font-bold text-gray-800">Nova Receita</h3>
                        <button onclick="closeModal('modalReceita')"
                            class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
                    </div>
                    <form onsubmit="adicionarReceita(event)" class="space-y-6">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Receita</label>
                                <input type="text" id="nomeReceita" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Rendimento (por√ß√µes)</label>
                                <input type="number" id="rendimentoReceita" required min="1"
                                    onchange="calcularCustoReceita()"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ingredientes</label>
                            <div id="ingredientesReceita" class="space-y-2">
                                <div class="flex space-x-2 ingrediente-row">
                                    <select
                                        class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ingrediente-select"
                                        onchange="calcularCustoReceita()">
                                        <option value="">Selecione um ingrediente</option>
                                    </select>
                                    <input type="number" placeholder="Qtd" min="0.01" step="0.01"
                                        class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent quantidade-ingrediente"
                                        onchange="calcularCustoReceita()">
                                    <button type="button" onclick="removerIngrediente(this)"
                                        class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">üóëÔ∏è</button>
                                </div>
                            </div>
                            <button type="button" onclick="adicionarIngrediente()"
                                class="mt-2 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition-colors duration-200">
                                ‚ûï Adicionar Ingrediente
                            </button>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Modo de Preparo</label>
                            <textarea id="modoPreparoReceita" rows="4"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                placeholder="Descreva o passo a passo do preparo..."></textarea>
                        </div>

                        <!-- C√°lculo de Pre√ßo -->
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h4 class="font-semibold text-green-800 mb-4 flex items-center">
                                üí∞ C√°lculo de Pre√ßo de Venda
                            </h4>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Margem de Lucro
                                        (%)</label>
                                    <input type="number" id="margemLucro" value="200" min="0" step="10"
                                        onchange="calcularPrecoSugerido()"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pre√ßo Sugerido</label>
                                    <input type="number" id="precoSugerido" readonly
                                        class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-lg text-gray-600">
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">üí° Meu Pre√ßo de
                                    Venda</label>
                                <input type="number" id="meuPreco" min="0" step="0.01" placeholder="Digite seu pre√ßo"
                                    onchange="calcularLucroPersonalizado()"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            </div>

                            <!-- Resumo de Custos -->
                            <div class="grid grid-cols-3 gap-4 text-sm">
                                <div class="bg-white p-3 rounded border">
                                    <div class="text-gray-600">Custo por Por√ß√£o:</div>
                                    <div id="custoPorPorcaoDisplay" class="font-bold text-lg text-gray-800">R$ 0,00
                                    </div>
                                </div>
                                <div class="bg-white p-3 rounded border">
                                    <div class="text-gray-600">Custo Total:</div>
                                    <div id="custoTotalDisplay" class="font-bold text-lg text-gray-800">R$ 0,00</div>
                                </div>
                                <div class="bg-white p-3 rounded border">
                                    <div class="text-gray-600">Lucro Sugerido:</div>
                                    <div id="lucroSugeridoDisplay" class="font-bold text-lg text-green-600">R$ 0,00
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-3 pt-4">
                            <button type="button" onclick="closeModal('modalReceita')"
                                class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-lg transition-colors duration-200">
                                Cancelar
                            </button>
                            <button type="submit" id="btnSalvarReceita"
                                class="flex-1 bg-purple-500 hover:bg-purple-600 text-white py-2 rounded-lg transition-colors duration-200">
                                Salvar Receita
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <script>
                // Dados do sistema - Iniciar vazio
                let produtos = [];
                let receitas = [];
                let vendas = [];
                let proximoIdProduto = 1;
                let proximoIdReceita = 1;
                let proximoIdVenda = 1;

                // Configura√ß√µes do sistema
                let configuracoes = {
                    limites: {
                        'kg': { min: 1, max: 10 },
                        'g': { min: 100, max: 1000 },
                        'L': { min: 1, max: 10 },
                        'ml': { min: 100, max: 1000 },
                        'un': { min: 5, max: 50 },
                        'cx': { min: 2, max: 20 },
                        'pct': { min: 3, max: 30 }
                    },
                    notificacoes: {
                        estoqueBaixo: true,
                        vencimento: true,
                        whatsapp: false,
                        diasAntecedencia: 7,
                        automatica: false
                    },
                    contato: {
                        whatsapp: '',
                        email: ''
                    },
                    moeda: 'BRL'
                };

                // Vari√°veis do sistema de notifica√ß√µes
                let alertasAtivos = [];
                let ultimaVerificacaoNotificacoes = null;
                let intervalNotificacoes = null;

                let categorias = [
                    'Ingredientes B√°sicos',
                    'Decora√ß√£o',
                    'Embalagens',
                    'Latic√≠nios',
                    'Frutas'
                ];

                // Vari√°veis de pagina√ß√£o
                let paginaAtual = 1;
                let itensPorPagina = 25;
                let produtosFiltrados = [];

                // Vari√°veis de pagina√ß√£o de vendas
                let paginaAtualVendas = 1;
                let vendasPorPagina = 25;
                let vendasFiltradas = [];

                // Vari√°veis de importa√ß√£o
                let dadosImportacao = [];
                let mapeamentoCampos = {};
                let camposObrigatorios = ['nome', 'categoria', 'quantidade', 'unidade', 'preco'];

                // Vari√°veis de importa√ß√£o de receitas
                let dadosImportacaoReceitas = [];
                let mapeamentoCamposReceitas = {};
                let camposObrigatoriosReceitas = ['nome', 'rendimento', 'ingredientes'];

                // Fun√ß√µes avan√ßadas de importa√ß√£o/exporta√ß√£o
                function baixarTemplate() {
                    // Criar template Excel
                    const wb = XLSX.utils.book_new();
                    const templateData = [
                        ['nome', 'categoria', 'quantidade', 'unidade', 'preco', 'validade', 'marca', 'codigoBarras'],
                        ['Farinha de Trigo', 'Ingredientes B√°sicos', '2.5', 'kg', '4.50', '2024-12-31', 'Dona Benta', '7891118001507'],
                        ['A√ß√∫car Cristal', 'Ingredientes B√°sicos', '1.8', 'kg', '3.20', '2025-06-15', 'Uni√£o', '7891000100004'],
                        ['Ovos', 'Ingredientes B√°sicos', '24', 'un', '0.45', '2024-02-10', 'Korin', '7891234567890']
                    ];

                    const ws = XLSX.utils.aoa_to_sheet(templateData);

                    // Definir larguras das colunas
                    ws['!cols'] = [
                        { wch: 20 }, // nome
                        { wch: 20 }, // categoria
                        { wch: 12 }, // quantidade
                        { wch: 10 }, // unidade
                        { wch: 10 }, // preco
                        { wch: 12 }, // validade
                        { wch: 15 }, // marca
                        { wch: 15 }  // codigoBarras
                    ];

                    XLSX.utils.book_append_sheet(wb, ws, 'Template');
                    XLSX.writeFile(wb, 'template_produtos.xlsx');
                }

                function processarArquivo(input) {
                    const file = input.files[0];
                    if (!file) return;

                    // Mostrar arquivo selecionado
                    document.getElementById('dropZone').classList.add('hidden');
                    document.getElementById('arquivoSelecionado').classList.remove('hidden');
                    document.getElementById('nomeArquivo').textContent = file.name;
                    document.getElementById('tamanhoArquivo').textContent = `${(file.size / 1024).toFixed(1)} KB`;

                    const reader = new FileReader();

                    reader.onload = function (e) {
                        try {
                            let data;

                            if (file.name.endsWith('.csv')) {
                                // Processar CSV
                                const csv = e.target.result;
                                const lines = csv.split('\n');
                                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));

                                data = lines.slice(1).filter(line => line.trim()).map(line => {
                                    const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
                                    const obj = {};
                                    headers.forEach((header, index) => {
                                        obj[header] = values[index] || '';
                                    });
                                    return obj;
                                });
                            } else {
                                // Processar Excel
                                const workbook = XLSX.read(e.target.result, { type: 'binary' });
                                const sheetName = workbook.SheetNames[0];
                                const worksheet = workbook.Sheets[sheetName];
                                data = XLSX.utils.sheet_to_json(worksheet);
                            }

                            dadosImportacao = data;
                            mostrarMapeamentoCampos(data);

                        } catch (error) {
                            alert('‚ùå Erro ao processar arquivo: ' + error.message);
                            removerArquivo();
                        }
                    };

                    if (file.name.endsWith('.csv')) {
                        reader.readAsText(file);
                    } else {
                        reader.readAsBinaryString(file);
                    }
                }

                function mostrarMapeamentoCampos(data) {
                    if (data.length === 0) {
                        alert('‚ùå Arquivo vazio ou sem dados v√°lidos!');
                        return;
                    }

                    const camposArquivo = Object.keys(data[0]);
                    const container = document.getElementById('mapeamentoCampos');
                    container.innerHTML = '';

                    // Resetar mapeamento
                    mapeamentoCampos = {};

                    camposObrigatorios.forEach(campo => {
                        const div = document.createElement('div');
                        div.className = 'grid grid-cols-2 gap-4 items-center';

                        // Campo obrigat√≥rio
                        const labelDiv = document.createElement('div');
                        labelDiv.innerHTML = `
                    <label class="block text-sm font-medium text-gray-700">
                        ${campo.charAt(0).toUpperCase() + campo.slice(1)} *
                    </label>
                `;

                        // Select para mapear
                        const selectDiv = document.createElement('div');
                        const select = document.createElement('select');
                        select.className = 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent';
                        select.setAttribute('data-campo', campo);
                        select.onchange = () => atualizarMapeamento();

                        // Op√ß√£o vazia
                        const emptyOption = document.createElement('option');
                        emptyOption.value = '';
                        emptyOption.textContent = 'Selecione uma coluna';
                        select.appendChild(emptyOption);

                        // Op√ß√µes do arquivo
                        camposArquivo.forEach(campoArquivo => {
                            const option = document.createElement('option');
                            option.value = campoArquivo;
                            option.textContent = campoArquivo;

                            // Auto-mapear campos similares
                            if (campoArquivo.toLowerCase().includes(campo.toLowerCase()) ||
                                campo.toLowerCase().includes(campoArquivo.toLowerCase())) {
                                option.selected = true;
                                mapeamentoCampos[campo] = campoArquivo;
                            }

                            select.appendChild(option);
                        });

                        selectDiv.appendChild(select);
                        div.appendChild(labelDiv);
                        div.appendChild(selectDiv);
                        container.appendChild(div);
                    });

                    // Campos opcionais
                    const camposOpcionais = ['validade', 'marca', 'codigoBarras'];
                    camposOpcionais.forEach(campo => {
                        const div = document.createElement('div');
                        div.className = 'grid grid-cols-2 gap-4 items-center';

                        const labelDiv = document.createElement('div');
                        labelDiv.innerHTML = `
                    <label class="block text-sm font-medium text-gray-500">
                        ${campo.charAt(0).toUpperCase() + campo.slice(1)}
                    </label>
                `;

                        const selectDiv = document.createElement('div');
                        const select = document.createElement('select');
                        select.className = 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent';
                        select.setAttribute('data-campo', campo);
                        select.onchange = () => atualizarMapeamento();

                        const emptyOption = document.createElement('option');
                        emptyOption.value = '';
                        emptyOption.textContent = 'N√£o mapear';
                        select.appendChild(emptyOption);

                        camposArquivo.forEach(campoArquivo => {
                            const option = document.createElement('option');
                            option.value = campoArquivo;
                            option.textContent = campoArquivo;

                            if (campoArquivo.toLowerCase().includes(campo.toLowerCase()) ||
                                campo.toLowerCase().includes(campoArquivo.toLowerCase())) {
                                option.selected = true;
                                mapeamentoCampos[campo] = campoArquivo;
                            }

                            select.appendChild(option);
                        });

                        selectDiv.appendChild(select);
                        div.appendChild(labelDiv);
                        div.appendChild(selectDiv);
                        container.appendChild(div);
                    });

                    // Mostrar preview
                    atualizarPreviewImportacao();

                    // Mostrar se√ß√£o de mapeamento
                    document.getElementById('secaoMapeamento').classList.remove('hidden');
                }

                function atualizarMapeamento() {
                    const selects = document.querySelectorAll('#mapeamentoCampos select');
                    mapeamentoCampos = {};

                    selects.forEach(select => {
                        const campo = select.getAttribute('data-campo');
                        if (select.value) {
                            mapeamentoCampos[campo] = select.value;
                        }
                    });

                    atualizarPreviewImportacao();
                }

                function atualizarPreviewImportacao() {
                    const tbody = document.getElementById('previewImportacao');
                    tbody.innerHTML = '';

                    // Mostrar apenas os primeiros 5 registros
                    const preview = dadosImportacao.slice(0, 5);

                    preview.forEach((item, index) => {
                        const row = document.createElement('tr');
                        row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';

                        const nome = item[mapeamentoCampos.nome] || '';
                        const categoria = item[mapeamentoCampos.categoria] || '';
                        const quantidade = item[mapeamentoCampos.quantidade] || '';
                        const unidade = item[mapeamentoCampos.unidade] || '';
                        const preco = item[mapeamentoCampos.preco] || '';

                        // Validar dados
                        const erros = [];
                        if (!nome) erros.push('Nome obrigat√≥rio');
                        if (!categoria) erros.push('Categoria obrigat√≥ria');
                        if (!quantidade || isNaN(parseFloat(quantidade))) erros.push('Quantidade inv√°lida');
                        if (!unidade) erros.push('Unidade obrigat√≥ria');
                        if (!preco || isNaN(parseFloat(preco))) erros.push('Pre√ßo inv√°lido');

                        const statusClass = erros.length > 0 ? 'text-red-600' : 'text-green-600';
                        const statusIcon = erros.length > 0 ? '‚ùå' : '‚úÖ';
                        const statusText = erros.length > 0 ? erros.join(', ') : 'OK';

                        row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${nome}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${categoria}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${quantidade} ${unidade}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">R$ ${preco}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${statusClass}">
                        ${statusIcon} ${statusText}
                    </td>
                `;
                        tbody.appendChild(row);
                    });

                    // Atualizar contador
                    const totalRegistros = dadosImportacao.length;
                    const registrosValidos = dadosImportacao.filter(item => {
                        const nome = item[mapeamentoCampos.nome];
                        const categoria = item[mapeamentoCampos.categoria];
                        const quantidade = item[mapeamentoCampos.quantidade];
                        const unidade = item[mapeamentoCampos.unidade];
                        const preco = item[mapeamentoCampos.preco];

                        return nome && categoria && quantidade && !isNaN(parseFloat(quantidade)) &&
                            unidade && preco && !isNaN(parseFloat(preco));
                    }).length;

                    document.getElementById('contadorImportacao').textContent =
                        `${registrosValidos} de ${totalRegistros} registros v√°lidos`;

                    // Habilitar/desabilitar bot√£o de importa√ß√£o
                    const btnImportar = document.querySelector('button[onclick="executarImportacao()"]');
                    if (registrosValidos > 0) {
                        btnImportar.disabled = false;
                        btnImportar.classList.remove('opacity-50', 'cursor-not-allowed');
                    } else {
                        btnImportar.disabled = true;
                        btnImportar.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                }

                function removerArquivo() {
                    document.getElementById('arquivoImportacao').value = '';
                    document.getElementById('dropZone').classList.remove('hidden');
                    document.getElementById('arquivoSelecionado').classList.add('hidden');
                    document.getElementById('secaoMapeamento').classList.add('hidden');
                    dadosImportacao = [];
                    mapeamentoCampos = {};
                }

                function executarImportacao() {
                    if (dadosImportacao.length === 0) {
                        alert('‚ùå Nenhum dado para importar!');
                        return;
                    }

                    let importados = 0;
                    let erros = 0;

                    dadosImportacao.forEach(item => {
                        try {
                            const nome = item[mapeamentoCampos.nome];
                            const categoria = item[mapeamentoCampos.categoria];
                            const quantidade = parseFloat(item[mapeamentoCampos.quantidade]);
                            const unidade = item[mapeamentoCampos.unidade];
                            const preco = parseFloat(item[mapeamentoCampos.preco]);
                            const validade = item[mapeamentoCampos.validade] || null;
                            const marca = item[mapeamentoCampos.marca] || '';
                            const codigoBarras = item[mapeamentoCampos.codigoBarras] || '';

                            // Validar dados obrigat√≥rios
                            if (!nome || !categoria || isNaN(quantidade) || !unidade || isNaN(preco)) {
                                erros++;
                                return;
                            }

                            // Verificar se produto j√° existe (por nome ou c√≥digo de barras)
                            const produtoExistente = produtos.find(p =>
                                p.nome.toLowerCase() === nome.toLowerCase() ||
                                (codigoBarras && p.codigoBarras === codigoBarras)
                            );

                            if (produtoExistente) {
                                // Atualizar produto existente
                                produtoExistente.categoria = categoria;
                                produtoExistente.quantidade = quantidade;
                                produtoExistente.unidade = unidade;
                                produtoExistente.preco = preco;
                                if (validade) produtoExistente.validade = validade;
                                if (marca) produtoExistente.marca = marca;
                                if (codigoBarras) produtoExistente.codigoBarras = codigoBarras;
                            } else {
                                // Criar novo produto
                                const novoProduto = {
                                    id: proximoIdProduto++,
                                    nome,
                                    categoria,
                                    quantidade,
                                    unidade,
                                    preco,
                                    validade,
                                    marca,
                                    codigoBarras
                                };
                                produtos.push(novoProduto);
                            }

                            importados++;
                        } catch (error) {
                            erros++;
                        }
                    });

                    // Salvar dados ap√≥s importa√ß√£o
                    if (importados > 0) {
                        salvarDados();
                    }

                    // Fechar modal e atualizar dashboard
                    closeModal('modalImportacao');
                    atualizarDashboard();

                    // Mostrar resultado
                    let mensagem = `‚úÖ Importa√ß√£o conclu√≠da!\n\n`;
                    mensagem += `üì¶ ${importados} produtos importados com sucesso\n`;
                    if (erros > 0) {
                        mensagem += `‚ùå ${erros} registros com erro foram ignorados`;
                    }

                    alert(mensagem);
                }

                // Fun√ß√µes de exporta√ß√£o avan√ßadas
                function toggleExportMenu() {
                    const menu = document.getElementById('exportMenu');
                    menu.classList.toggle('hidden');
                }

                function exportarExcel() {
                    if (produtos.length === 0) {
                        alert('‚ùå Nenhum produto para exportar!');
                        return;
                    }

                    // Preparar dados para exporta√ß√£o
                    const dadosExportacao = produtos.map(produto => ({
                        'Nome': produto.nome,
                        'Categoria': produto.categoria,
                        'Quantidade': produto.quantidade,
                        'Unidade': produto.unidade,
                        'Pre√ßo Unit√°rio': produto.preco,
                        'Valor Total': (produto.quantidade * produto.preco).toFixed(2),
                        'Status Estoque': getStatusEstoque(produto.quantidade, produto.unidade) === 'baixo' ? 'Baixo' :
                            getStatusEstoque(produto.quantidade, produto.unidade) === 'medio' ? 'M√©dio' : 'Alto',
                        'Validade': produto.validade ? new Date(produto.validade).toLocaleDateString('pt-BR') : '',
                        'Marca': produto.marca || '',
                        'C√≥digo de Barras': produto.codigoBarras || ''
                    }));

                    // Criar workbook
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.json_to_sheet(dadosExportacao);

                    // Definir larguras das colunas
                    ws['!cols'] = [
                        { wch: 25 }, // Nome
                        { wch: 20 }, // Categoria
                        { wch: 12 }, // Quantidade
                        { wch: 10 }, // Unidade
                        { wch: 15 }, // Pre√ßo Unit√°rio
                        { wch: 15 }, // Valor Total
                        { wch: 15 }, // Status Estoque
                        { wch: 12 }, // Validade
                        { wch: 15 }, // Marca
                        { wch: 18 }  // C√≥digo de Barras
                    ];

                    XLSX.utils.book_append_sheet(wb, ws, 'Invent√°rio');

                    // Gerar nome do arquivo com data
                    const agora = new Date();
                    const dataFormatada = agora.toISOString().split('T')[0];
                    const nomeArquivo = `inventario_${dataFormatada}.xlsx`;

                    XLSX.writeFile(wb, nomeArquivo);

                    alert(`‚úÖ Arquivo Excel exportado com sucesso!\nüìÅ ${nomeArquivo}`);
                }

                function exportarPDF() {
                    if (produtos.length === 0) {
                        alert('‚ùå Nenhum produto para exportar!');
                        return;
                    }

                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();

                    // Configurar fonte
                    doc.setFont('helvetica');

                    // Cabe√ßalho
                    doc.setFontSize(20);
                    doc.text('Relat√≥rio de Invent√°rio', 20, 20);

                    doc.setFontSize(12);
                    doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}`, 20, 30);
                    doc.text(`Total de produtos: ${produtos.length}`, 20, 40);

                    // Resumo
                    const totalItens = produtos.length;
                    const estoqueBaixo = produtos.filter(p => getStatusEstoque(p.quantidade, p.unidade) === 'baixo').length;
                    const valorTotal = produtos.reduce((total, p) => total + (p.quantidade * p.preco), 0);

                    doc.text(`Produtos com estoque baixo: ${estoqueBaixo}`, 20, 50);
                    doc.text(`Valor total do invent√°rio: R$ ${valorTotal.toFixed(2)}`, 20, 60);

                    // Linha separadora
                    doc.line(20, 70, 190, 70);

                    // Cabe√ßalho da tabela
                    let yPos = 85;
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'bold');

                    doc.text('Produto', 20, yPos);
                    doc.text('Categoria', 70, yPos);
                    doc.text('Qtd', 110, yPos);
                    doc.text('Pre√ßo', 130, yPos);
                    doc.text('Total', 150, yPos);
                    doc.text('Status', 170, yPos);

                    yPos += 5;
                    doc.line(20, yPos, 190, yPos);

                    // Dados dos produtos
                    doc.setFont('helvetica', 'normal');
                    yPos += 10;

                    produtos.forEach((produto, index) => {
                        if (yPos > 270) {
                            doc.addPage();
                            yPos = 20;
                        }

                        const status = getStatusEstoque(produto.quantidade, produto.unidade);
                        const statusText = status === 'baixo' ? 'Baixo' : status === 'medio' ? 'M√©dio' : 'Alto';

                        doc.text(produto.nome.substring(0, 20), 20, yPos);
                        doc.text(produto.categoria.substring(0, 15), 70, yPos);
                        doc.text(`${produto.quantidade} ${produto.unidade}`, 110, yPos);
                        doc.text(`R$ ${produto.preco.toFixed(2)}`, 130, yPos);
                        doc.text(`R$ ${(produto.quantidade * produto.preco).toFixed(2)}`, 150, yPos);
                        doc.text(statusText, 170, yPos);

                        yPos += 8;
                    });

                    // Salvar PDF
                    const agora = new Date();
                    const dataFormatada = agora.toISOString().split('T')[0];
                    const nomeArquivo = `relatorio_inventario_${dataFormatada}.pdf`;

                    doc.save(nomeArquivo);

                    alert(`‚úÖ Relat√≥rio PDF gerado com sucesso!\nüìÅ ${nomeArquivo}`);
                }

                // Fun√ß√µes de navega√ß√£o
                function showSection(sectionName) {
                    // Esconder todas as se√ß√µes
                    const sections = document.querySelectorAll('.section-content');
                    sections.forEach(section => {
                        section.classList.add('hidden');
                    });

                    // Mostrar a se√ß√£o selecionada
                    const targetSection = document.getElementById(sectionName);
                    if (targetSection) {
                        targetSection.classList.remove('hidden');
                    }

                    // Atualizar bot√µes de navega√ß√£o (desktop e mobile)
                    const navButtons = document.querySelectorAll('.nav-btn');
                    navButtons.forEach(btn => {
                        btn.classList.remove('bg-pink-500', 'text-white');
                        btn.classList.add('text-gray-600', 'hover:bg-pink-100');
                    });

                    // Destacar bot√£o ativo
                    event.target.classList.remove('text-gray-600', 'hover:bg-pink-100');
                    event.target.classList.add('bg-pink-500', 'text-white');

                    // Atualizar dados espec√≠ficos da se√ß√£o
                    if (sectionName === 'dashboard') {
                        atualizarDashboard();
                    } else if (sectionName === 'vendas') {
                        atualizarVendas();
                    } else if (sectionName === 'receitas') {
                        atualizarReceitas();
                    }
                }

                // Fun√ß√µes de modal
                function openModal(modalId) {
                    const modal = document.getElementById(modalId);
                    if (modal) {
                        modal.classList.remove('hidden');
                        modal.classList.add('flex');

                        // Preparar dados espec√≠ficos do modal
                        if (modalId === 'modalReceita') {
                            atualizarIngredientesDisponiveis();
                        } else if (modalId === 'modalVenda') {
                            atualizarReceitasDisponiveis();
                        } else if (modalId === 'modalImportacao') {
                            configurarDragAndDrop();
                        } else if (modalId === 'modalImportacaoReceitas') {
                            configurarDragAndDropReceitas();
                        }
                    }
                }

                function closeModal(modalId) {
                    const modal = document.getElementById(modalId);
                    if (modal) {
                        modal.classList.add('hidden');
                        modal.classList.remove('flex');

                        // Limpar formul√°rios
                        const forms = modal.querySelectorAll('form');
                        forms.forEach(form => form.reset());

                        // Limpar dados espec√≠ficos do modal
                        if (modalId === 'modalImportacao') {
                            removerArquivo();
                        } else if (modalId === 'modalImportacaoReceitas') {
                            removerArquivoReceitas();
                        } else if (modalId === 'modalReceita') {
                            // Resetar modal de receita
                            receitaEditando = null;
                            document.getElementById('tituloModalReceita').textContent = 'Nova Receita';
                            document.getElementById('btnSalvarReceita').textContent = 'Salvar Receita';

                            // Limpar ingredientes e deixar apenas um
                            const container = document.getElementById('ingredientesReceita');
                            container.innerHTML = `
                        <div class="flex space-x-2 ingrediente-row">
                            <select class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ingrediente-select" onchange="calcularCustoReceita()">
                                <option value="">Selecione um ingrediente</option>
                            </select>
                            <input type="number" placeholder="Qtd" min="0.01" step="0.01" class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent quantidade-ingrediente" onchange="calcularCustoReceita()">
                            <button type="button" onclick="removerIngrediente(this)" class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">üóëÔ∏è</button>
                        </div>
                    `;

                            // Resetar displays de custo
                            document.getElementById('custoTotalDisplay').textContent = 'R$ 0,00';
                            document.getElementById('custoPorPorcaoDisplay').textContent = 'R$ 0,00';
                            document.getElementById('lucroSugeridoDisplay').textContent = 'R$ 0,00';
                            document.getElementById('precoSugerido').value = '';
                            document.getElementById('margemLucro').value = '200';
                            document.getElementById('meuPreco').value = '';
                        }
                    }
                }

                function configurarDragAndDropReceitas() {
                    const dropZone = document.getElementById('dropZoneReceitas');

                    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                        dropZone.addEventListener(eventName, preventDefaults, false);
                    });

                    function preventDefaults(e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }

                    ['dragenter', 'dragover'].forEach(eventName => {
                        dropZone.addEventListener(eventName, highlight, false);
                    });

                    ['dragleave', 'drop'].forEach(eventName => {
                        dropZone.addEventListener(eventName, unhighlight, false);
                    });

                    function highlight(e) {
                        dropZone.classList.add('border-purple-400', 'bg-purple-50');
                    }

                    function unhighlight(e) {
                        dropZone.classList.remove('border-purple-400', 'bg-purple-50');
                    }

                    dropZone.addEventListener('drop', handleDrop, false);

                    function handleDrop(e) {
                        const dt = e.dataTransfer;
                        const files = dt.files;

                        if (files.length > 0) {
                            const input = document.getElementById('arquivoImportacaoReceitas');
                            input.files = files;
                            processarArquivoReceitas(input);
                        }
                    }
                }

                function configurarDragAndDrop() {
                    const dropZone = document.getElementById('dropZone');

                    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                        dropZone.addEventListener(eventName, preventDefaults, false);
                    });

                    function preventDefaults(e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }

                    ['dragenter', 'dragover'].forEach(eventName => {
                        dropZone.addEventListener(eventName, highlight, false);
                    });

                    ['dragleave', 'drop'].forEach(eventName => {
                        dropZone.addEventListener(eventName, unhighlight, false);
                    });

                    function highlight(e) {
                        dropZone.classList.add('border-blue-400', 'bg-blue-50');
                    }

                    function unhighlight(e) {
                        dropZone.classList.remove('border-blue-400', 'bg-blue-50');
                    }

                    dropZone.addEventListener('drop', handleDrop, false);

                    function handleDrop(e) {
                        const dt = e.dataTransfer;
                        const files = dt.files;

                        if (files.length > 0) {
                            const input = document.getElementById('arquivoImportacao');
                            input.files = files;
                            processarArquivo(input);
                        }
                    }
                }

                // Fun√ß√µes de salvamento e carregamento de dados
                function salvarDados() {
                    const dados = {
                        produtos,
                        receitas,
                        vendas,
                        proximoIdProduto,
                        proximoIdReceita,
                        proximoIdVenda,
                        categorias,
                        versao: '1.0',
                        ultimaSalvamento: new Date().toISOString()
                    };

                    localStorage.setItem('doceControle_dados', JSON.stringify(dados));
                    console.log('üíæ Dados salvos automaticamente');
                }

                function carregarDados() {
                    try {
                        const dadosSalvos = localStorage.getItem('doceControle_dados');
                        if (dadosSalvos) {
                            const dados = JSON.parse(dadosSalvos);

                            // Restaurar dados
                            produtos = dados.produtos || [];
                            receitas = dados.receitas || [];
                            vendas = dados.vendas || [];
                            proximoIdProduto = dados.proximoIdProduto || 1;
                            proximoIdReceita = dados.proximoIdReceita || 1;
                            proximoIdVenda = dados.proximoIdVenda || 1;
                            categorias = dados.categorias || [
                                'Ingredientes B√°sicos',
                                'Decora√ß√£o',
                                'Embalagens',
                                'Latic√≠nios',
                                'Frutas'
                            ];

                            console.log(`üìÇ Dados carregados: ${produtos.length} produtos, ${receitas.length} receitas, ${vendas.length} vendas`);
                            return true;
                        }
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar dados:', error);
                        alert('‚ö†Ô∏è Erro ao carregar dados salvos. O sistema iniciar√° vazio.');
                    }
                    return false;
                }

                function limparTodosDados() {
                    const confirmacao = confirm(
                        'üóëÔ∏è LIMPAR TODOS OS DADOS\n\n' +
                        'Esta a√ß√£o ir√° remover PERMANENTEMENTE:\n' +
                        `‚Ä¢ ${produtos.length} produtos\n` +
                        `‚Ä¢ ${receitas.length} receitas\n` +
                        `‚Ä¢ ${vendas.length} vendas\n` +
                        '‚Ä¢ Todas as configura√ß√µes\n\n' +
                        '‚ö†Ô∏è ESTA A√á√ÉO N√ÉO PODE SER DESFEITA!\n\n' +
                        'Tem certeza que deseja continuar?'
                    );

                    if (confirmacao) {
                        const confirmacaoFinal = confirm(
                            'üö® CONFIRMA√á√ÉO FINAL\n\n' +
                            'Digite "LIMPAR" para confirmar a exclus√£o de todos os dados:'
                        );

                        if (confirmacaoFinal) {
                            const texto = prompt('Digite "LIMPAR" para confirmar:');
                            if (texto === 'LIMPAR') {
                                // Limpar todos os dados
                                produtos = [];
                                receitas = [];
                                vendas = [];
                                proximoIdProduto = 1;
                                proximoIdReceita = 1;
                                proximoIdVenda = 1;

                                // Limpar localStorage
                                localStorage.removeItem('doceControle_dados');
                                localStorage.removeItem('configuracoes');
                                localStorage.removeItem('personalizacao');

                                // Atualizar interface
                                atualizarDashboard();
                                atualizarReceitas();
                                atualizarVendas();
                                atualizarListaCategorias();
                                atualizarSelectsCategorias();
                                atualizarEstatisticasCategorias();

                                alert('‚úÖ Todos os dados foram removidos!\n\nO sistema foi reiniciado completamente.');
                            } else {
                                alert('‚ùå Confirma√ß√£o incorreta. Dados n√£o foram removidos.');
                            }
                        }
                    }
                }

                // Fun√ß√£o para adicionar item no dashboard
                function adicionarItemDashboard(event) {
                    event.preventDefault();

                    const nome = document.getElementById('nomeItemDash').value;
                    const categoria = document.getElementById('categoriaItemDash').value;
                    const quantidade = parseFloat(document.getElementById('quantidadeItemDash').value);
                    const unidade = document.getElementById('unidadeItemDash').value;
                    const preco = parseFloat(document.getElementById('precoItemDash').value);
                    const validade = document.getElementById('validadeItemDash').value || null;
                    const marca = document.getElementById('marcaItemDash').value || '';
                    const codigoBarras = document.getElementById('codigoBarrasItemDash').value || '';

                    const novoProduto = {
                        id: proximoIdProduto++,
                        nome,
                        categoria,
                        quantidade,
                        unidade,
                        preco,
                        validade,
                        marca,
                        codigoBarras
                    };

                    produtos.push(novoProduto);

                    // Salvar dados automaticamente
                    salvarDados();

                    // Limpar formul√°rio
                    event.target.reset();

                    // Atualizar dashboard
                    atualizarDashboard();

                    // Mostrar mensagem de sucesso
                    alert('‚úÖ Item adicionado com sucesso!');
                }

                // Fun√ß√£o para atualizar dashboard
                function atualizarDashboard() {
                    // Atualizar cards de resumo
                    const totalItens = produtos.length;
                    const estoqueBaixo = produtos.filter(p => getStatusEstoque(p.quantidade, p.unidade) === 'baixo').length;
                    const valorTotal = produtos.reduce((total, p) => total + (p.quantidade * p.preco), 0);
                    const categorias = [...new Set(produtos.map(p => p.categoria))].length;

                    document.getElementById('totalItens').textContent = totalItens;
                    document.getElementById('estoqueBaixo').textContent = estoqueBaixo;
                    document.getElementById('valorTotal').textContent = `R$ ${valorTotal.toFixed(2)}`;
                    document.getElementById('totalCategorias').textContent = categorias;

                    // Aplicar filtros e atualizar tabela
                    filtrarInventario();
                }

                // Fun√ß√£o para filtrar e ordenar invent√°rio
                function filtrarInventario() {
                    const busca = document.getElementById('buscarInventario').value.toLowerCase();
                    const filtroCategoria = document.getElementById('filtroCategoria').value;
                    const filtroEstoque = document.getElementById('filtroEstoque').value;
                    const ordenarPor = document.getElementById('ordenarPor').value;

                    // Filtrar produtos
                    produtosFiltrados = produtos.filter(produto => {
                        // Filtro de busca
                        const matchBusca = !busca ||
                            produto.nome.toLowerCase().includes(busca) ||
                            (produto.marca && produto.marca.toLowerCase().includes(busca)) ||
                            (produto.codigoBarras && produto.codigoBarras.includes(busca));

                        // Filtro de categoria
                        const matchCategoria = !filtroCategoria || produto.categoria === filtroCategoria;

                        // Filtro de estoque
                        const statusEstoque = getStatusEstoque(produto.quantidade, produto.unidade);
                        const matchEstoque = !filtroEstoque || statusEstoque === filtroEstoque;

                        return matchBusca && matchCategoria && matchEstoque;
                    });

                    // Ordenar produtos
                    produtosFiltrados.sort((a, b) => {
                        switch (ordenarPor) {
                            case 'nome':
                                return a.nome.localeCompare(b.nome);
                            case 'nome-desc':
                                return b.nome.localeCompare(a.nome);
                            case 'categoria':
                                return a.categoria.localeCompare(b.categoria);
                            case 'quantidade':
                                return a.quantidade - b.quantidade;
                            case 'quantidade-desc':
                                return b.quantidade - a.quantidade;
                            case 'preco':
                                return a.preco - b.preco;
                            case 'preco-desc':
                                return b.preco - a.preco;
                            case 'valor-total':
                                return (a.quantidade * a.preco) - (b.quantidade * b.preco);
                            case 'valor-total-desc':
                                return (b.quantidade * b.preco) - (a.quantidade * a.preco);
                            case 'validade':
                                if (!a.validade && !b.validade) return 0;
                                if (!a.validade) return 1;
                                if (!b.validade) return -1;
                                return new Date(a.validade) - new Date(b.validade);
                            default:
                                return 0;
                        }
                    });

                    // Resetar para primeira p√°gina quando filtros mudarem
                    paginaAtual = 1;

                    // Atualizar tabela com pagina√ß√£o
                    atualizarTabelaInventario();
                    atualizarPaginacao();
                }

                // Fun√ß√£o para atualizar tabela do invent√°rio com pagina√ß√£o
                function atualizarTabelaInventario() {
                    const tbody = document.getElementById('inventarioDashboard');
                    tbody.innerHTML = '';

                    // Calcular itens da p√°gina atual
                    const inicio = (paginaAtual - 1) * itensPorPagina;
                    const fim = inicio + itensPorPagina;
                    const itensPagina = produtosFiltrados.slice(inicio, fim);

                    itensPagina.forEach(produto => {
                        const status = getStatusEstoque(produto.quantidade, produto.unidade);
                        const statusClass = status === 'baixo' ? 'bg-red-100 text-red-800' :
                            status === 'medio' ? 'bg-yellow-100 text-yellow-800' :
                                'bg-green-100 text-green-800';
                        const statusText = status === 'baixo' ? 'üî¥ Baixo' :
                            status === 'medio' ? 'üü° M√©dio' :
                                'üü¢ Alto';

                        const row = document.createElement('tr');
                        row.className = 'produto-row';
                        row.setAttribute('data-produto-id', produto.id);
                        row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="checkbox" class="checkbox-produto produto-checkbox" data-produto-id="${produto.id}" onchange="atualizarSelecao()">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${produto.nome}</div>
                        <div class="text-sm text-gray-500">${produto.marca || 'Sem marca'}</div>
                        ${produto.codigoBarras ? `<div class="text-xs text-gray-400">${produto.codigoBarras}</div>` : ''}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${produto.categoria}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${produto.quantidade} ${produto.unidade}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">R$ ${produto.preco.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600">R$ ${(produto.quantidade * produto.preco).toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                            ${statusText}
                        </span>
                        ${produto.validade ? `<div class="text-xs text-gray-500 mt-1">Validade: ${new Date(produto.validade).toLocaleDateString('pt-BR')}</div>` : ''}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editarProduto(${produto.id})" class="text-indigo-600 hover:text-indigo-900 mr-3">‚úèÔ∏è</button>
                        <button onclick="excluirProduto(${produto.id})" class="text-red-600 hover:text-red-900">üóëÔ∏è</button>
                    </td>
                `;
                        tbody.appendChild(row);
                    });

                    // Atualizar contador de resultados
                    const resultadosDiv = document.getElementById('resultadosFiltro');
                    if (produtosFiltrados.length === produtos.length) {
                        resultadosDiv.textContent = `Mostrando ${inicio + 1}-${Math.min(fim, produtosFiltrados.length)} de ${produtos.length} itens`;
                    } else {
                        resultadosDiv.textContent = `Mostrando ${inicio + 1}-${Math.min(fim, produtosFiltrados.length)} de ${produtosFiltrados.length} itens filtrados (${produtos.length} total)`;
                    }
                }

                // Fun√ß√£o para atualizar pagina√ß√£o
                function atualizarPaginacao() {
                    const totalPaginas = Math.ceil(produtosFiltrados.length / itensPorPagina);

                    document.getElementById('infoPagina').textContent = `P√°gina ${paginaAtual} de ${totalPaginas}`;

                    const btnAnterior = document.getElementById('btnAnterior');
                    const btnProximo = document.getElementById('btnProximo');

                    btnAnterior.disabled = paginaAtual <= 1;
                    btnProximo.disabled = paginaAtual >= totalPaginas;
                }

                // Fun√ß√µes de navega√ß√£o de p√°ginas
                function paginaAnterior() {
                    if (paginaAtual > 1) {
                        paginaAtual--;
                        atualizarTabelaInventario();
                        atualizarPaginacao();
                        deselecionarTodos();
                    }
                }

                function proximaPagina() {
                    const totalPaginas = Math.ceil(produtosFiltrados.length / itensPorPagina);
                    if (paginaAtual < totalPaginas) {
                        paginaAtual++;
                        atualizarTabelaInventario();
                        atualizarPaginacao();
                        deselecionarTodos();
                    }
                }

                function mudarItensPorPagina() {
                    itensPorPagina = parseInt(document.getElementById('itensPorPagina').value);
                    paginaAtual = 1;
                    atualizarTabelaInventario();
                    atualizarPaginacao();
                    deselecionarTodos();
                }

                // Fun√ß√µes de sele√ß√£o m√∫ltipla
                function atualizarSelecao() {
                    const checkboxes = document.querySelectorAll('.produto-checkbox');
                    const selecionados = document.querySelectorAll('.produto-checkbox:checked');
                    const selectAll = document.getElementById('selectAll');
                    const acoesBatch = document.getElementById('acoesBatch');
                    const itensSelecionados = document.getElementById('itensSelecionados');

                    // Atualizar contador
                    itensSelecionados.textContent = `${selecionados.length} itens selecionados`;

                    // Mostrar/esconder a√ß√µes em lote
                    if (selecionados.length > 0) {
                        acoesBatch.classList.remove('hidden');
                    } else {
                        acoesBatch.classList.add('hidden');
                    }

                    // Atualizar checkbox "selecionar todos"
                    if (selecionados.length === 0) {
                        selectAll.indeterminate = false;
                        selectAll.checked = false;
                    } else if (selecionados.length === checkboxes.length) {
                        selectAll.indeterminate = false;
                        selectAll.checked = true;
                    } else {
                        selectAll.indeterminate = true;
                        selectAll.checked = false;
                    }

                    // Destacar linhas selecionadas
                    document.querySelectorAll('.produto-row').forEach(row => {
                        const checkbox = row.querySelector('.produto-checkbox');
                        if (checkbox.checked) {
                            row.classList.add('linha-selecionada');
                        } else {
                            row.classList.remove('linha-selecionada');
                        }
                    });
                }

                function toggleSelectAll() {
                    const selectAll = document.getElementById('selectAll');
                    const checkboxes = document.querySelectorAll('.produto-checkbox');

                    checkboxes.forEach(checkbox => {
                        checkbox.checked = selectAll.checked;
                    });

                    atualizarSelecao();
                }

                function selecionarTodos() {
                    const checkboxes = document.querySelectorAll('.produto-checkbox');
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = true;
                    });
                    atualizarSelecao();
                }

                function deselecionarTodos() {
                    const checkboxes = document.querySelectorAll('.produto-checkbox');
                    const selectAll = document.getElementById('selectAll');

                    checkboxes.forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    selectAll.checked = false;
                    selectAll.indeterminate = false;

                    atualizarSelecao();
                }

                function excluirSelecionados() {
                    const selecionados = document.querySelectorAll('.produto-checkbox:checked');
                    const ids = Array.from(selecionados).map(cb => parseInt(cb.getAttribute('data-produto-id')));

                    if (ids.length === 0) {
                        alert('‚ö†Ô∏è Nenhum item selecionado!');
                        return;
                    }

                    const confirmacao = confirm(`Tem certeza que deseja excluir ${ids.length} item(ns) selecionado(s)?`);
                    if (confirmacao) {
                        // Remover produtos selecionados
                        produtos = produtos.filter(produto => !ids.includes(produto.id));

                        // Salvar dados
                        salvarDados();

                        // Atualizar dashboard
                        atualizarDashboard();
                        deselecionarTodos();

                        alert(`‚úÖ ${ids.length} item(ns) exclu√≠do(s) com sucesso!`);
                    }
                }

                // Fun√ß√£o para limpar filtros
                function limparFiltros() {
                    document.getElementById('buscarInventario').value = '';
                    document.getElementById('filtroCategoria').value = '';
                    document.getElementById('filtroEstoque').value = '';
                    document.getElementById('ordenarPor').value = 'nome';
                    paginaAtual = 1;
                    deselecionarTodos();
                    filtrarInventario();
                }

                // Fun√ß√£o para determinar status do estoque
                function getStatusEstoque(quantidade, unidade) {
                    const limite = configuracoes.limites[unidade] || { min: 5, max: 50 };

                    if (quantidade <= limite.min) return 'baixo';
                    if (quantidade >= limite.max) return 'alto';
                    return 'medio';
                }

                // Vari√°veis para edi√ß√£o de receita
                let receitaEditando = null;

                // Fun√ß√£o para adicionar/editar receita
                function adicionarReceita(event) {
                    event.preventDefault();

                    const nome = document.getElementById('nomeReceita').value;
                    const rendimento = parseInt(document.getElementById('rendimentoReceita').value);
                    const modoPreparo = document.getElementById('modoPreparoReceita').value;
                    const margemLucro = parseFloat(document.getElementById('margemLucro').value) || 200;
                    const meuPreco = parseFloat(document.getElementById('meuPreco').value) || 0;

                    // Coletar ingredientes
                    const ingredientes = [];
                    const ingredienteRows = document.querySelectorAll('.ingrediente-row');

                    ingredienteRows.forEach(row => {
                        const select = row.querySelector('.ingrediente-select');
                        const quantidadeInput = row.querySelector('.quantidade-ingrediente');

                        if (select.value && quantidadeInput.value) {
                            ingredientes.push({
                                produtoId: parseInt(select.value),
                                quantidade: parseFloat(quantidadeInput.value)
                            });
                        }
                    });

                    if (ingredientes.length === 0) {
                        alert('‚ö†Ô∏è Adicione pelo menos um ingrediente!');
                        return;
                    }

                    // Calcular custo
                    let custoTotal = 0;
                    ingredientes.forEach(ing => {
                        const produto = produtos.find(p => p.id === ing.produtoId);
                        if (produto) {
                            custoTotal += ing.quantidade * produto.preco;
                        }
                    });

                    const custoPorPorcao = custoTotal / rendimento;
                    const precoSugerido = custoPorPorcao * (1 + margemLucro / 100);
                    const precoVenda = meuPreco > 0 ? meuPreco : precoSugerido;

                    if (receitaEditando) {
                        // Editando receita existente
                        const receita = receitas.find(r => r.id === receitaEditando);
                        if (receita) {
                            receita.nome = nome;
                            receita.rendimento = rendimento;
                            receita.ingredientes = ingredientes;
                            receita.modoPreparo = modoPreparo;
                            receita.custoTotal = custoTotal;
                            receita.custoPorPorcao = custoPorPorcao;
                            receita.margemLucro = margemLucro;
                            receita.precoSugerido = precoSugerido;
                            receita.precoVenda = precoVenda;
                        }

                        alert('‚úÖ Receita atualizada com sucesso!');
                    } else {
                        // Criando nova receita
                        const novaReceita = {
                            id: proximoIdReceita++,
                            nome,
                            rendimento,
                            ingredientes,
                            modoPreparo,
                            custoTotal,
                            custoPorPorcao,
                            margemLucro,
                            precoSugerido,
                            precoVenda
                        };

                        receitas.push(novaReceita);
                        alert('‚úÖ Receita adicionada com sucesso!');
                    }



                    // Salvar dados automaticamente
                    salvarDados();

                    // Limpar vari√°vel de edi√ß√£o
                    receitaEditando = null;

                    // Fechar modal e atualizar lista
                    closeModal('modalReceita');
                    atualizarReceitas();
                }

                // Fun√ß√£o para atualizar ingredientes dispon√≠veis
                function atualizarIngredientesDisponiveis() {
                    const selects = document.querySelectorAll('.ingrediente-select');
                    selects.forEach(select => {
                        select.innerHTML = '<option value="">Selecione um ingrediente</option>';
                        produtos.forEach(produto => {
                            const option = document.createElement('option');
                            option.value = produto.id;
                            option.textContent = `${produto.nome} (${produto.quantidade} ${produto.unidade})`;
                            select.appendChild(option);
                        });
                    });
                }

                // Fun√ß√£o para adicionar ingrediente na receita
                function adicionarIngrediente() {
                    const container = document.getElementById('ingredientesReceita');
                    const newRow = document.createElement('div');
                    newRow.className = 'flex space-x-2 ingrediente-row';
                    newRow.innerHTML = `
                <select class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ingrediente-select" onchange="calcularCustoReceita()">
                    <option value="">Selecione um ingrediente</option>
                </select>
                <input type="number" placeholder="Qtd" min="0.01" step="0.01" class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent quantidade-ingrediente" onchange="calcularCustoReceita()">
                <button type="button" onclick="removerIngrediente(this)" class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">üóëÔ∏è</button>
            `;
                    container.appendChild(newRow);

                    // Atualizar op√ß√µes do novo select
                    const newSelect = newRow.querySelector('.ingrediente-select');
                    produtos.forEach(produto => {
                        const option = document.createElement('option');
                        option.value = produto.id;
                        option.textContent = `${produto.nome} (${produto.unidade})`;
                        newSelect.appendChild(option);
                    });
                }

                // Fun√ß√£o para remover ingrediente
                function removerIngrediente(button) {
                    button.parentElement.remove();
                    calcularCustoReceita();
                }

                // Fun√ß√£o para calcular custo da receita em tempo real
                function calcularCustoReceita() {
                    const rendimento = parseInt(document.getElementById('rendimentoReceita').value) || 1;
                    const ingredienteRows = document.querySelectorAll('.ingrediente-row');

                    let custoTotal = 0;

                    ingredienteRows.forEach(row => {
                        const select = row.querySelector('.ingrediente-select');
                        const quantidadeInput = row.querySelector('.quantidade-ingrediente');

                        if (select.value && quantidadeInput.value) {
                            const produto = produtos.find(p => p.id === parseInt(select.value));
                            if (produto) {
                                const quantidade = parseFloat(quantidadeInput.value);
                                custoTotal += quantidade * produto.preco;
                            }
                        }
                    });

                    const custoPorPorcao = custoTotal / rendimento;

                    // Atualizar displays
                    document.getElementById('custoTotalDisplay').textContent = `R$ ${custoTotal.toFixed(2)}`;
                    document.getElementById('custoPorPorcaoDisplay').textContent = `R$ ${custoPorPorcao.toFixed(2)}`;

                    // Recalcular pre√ßo sugerido
                    calcularPrecoSugerido();
                }

                // Fun√ß√£o para calcular pre√ßo sugerido
                function calcularPrecoSugerido() {
                    const custoTotalText = document.getElementById('custoTotalDisplay').textContent;
                    const custoTotal = parseFloat(custoTotalText.replace('R$ ', '').replace(',', '.')) || 0;
                    const rendimento = parseInt(document.getElementById('rendimentoReceita').value) || 1;
                    const margemLucro = parseFloat(document.getElementById('margemLucro').value) || 200;

                    const custoPorPorcao = custoTotal / rendimento;
                    const precoSugerido = custoPorPorcao * (1 + margemLucro / 100);
                    const lucroSugerido = precoSugerido - custoPorPorcao;

                    document.getElementById('precoSugerido').value = precoSugerido.toFixed(2);
                    document.getElementById('lucroSugeridoDisplay').textContent = `R$ ${lucroSugerido.toFixed(2)}`;
                }

                // Fun√ß√£o para calcular lucro personalizado
                function calcularLucroPersonalizado() {
                    const meuPreco = parseFloat(document.getElementById('meuPreco').value) || 0;
                    const custoPorPorcaoText = document.getElementById('custoPorPorcaoDisplay').textContent;
                    const custoPorPorcao = parseFloat(custoPorPorcaoText.replace('R$ ', '').replace(',', '.')) || 0;

                    if (meuPreco > 0) {
                        const lucroPersonalizado = meuPreco - custoPorPorcao;
                        document.getElementById('lucroSugeridoDisplay').textContent = `R$ ${lucroPersonalizado.toFixed(2)}`;
                    } else {
                        calcularPrecoSugerido();
                    }
                }

                // Fun√ß√£o para atualizar receitas
                function atualizarReceitas() {
                    const container = document.getElementById('listaReceitas');
                    container.innerHTML = '';

                    receitas.forEach(receita => {
                        const card = document.createElement('div');
                        card.className = 'bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100 overflow-hidden';

                        // Calcular pre√ßo sugerido (margem de 200%)
                        const precoSugerido = receita.custoPorPorcao * 3;
                        const margem = 200;
                        const lucro = precoSugerido - receita.custoPorPorcao;

                        const ingredientesDetalhados = receita.ingredientes.map(ing => {
                            const produto = produtos.find(p => p.id === ing.produtoId);
                            if (produto) {
                                const custoIngrediente = ing.quantidade * produto.preco;
                                return `‚Ä¢ ${ing.quantidade} ${produto.unidade} de ${produto.nome} (R$ ${custoIngrediente.toFixed(2)})`;
                            }
                            return '';
                        }).filter(Boolean);

                        card.innerHTML = `
                    <!-- Header do Card -->
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="text-xl font-bold mb-1">${receita.nome}</h4>
                                <p class="text-purple-100 text-sm">Rendimento: ${receita.rendimento} por√ß√µes</p>
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="editarReceita(${receita.id})" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white p-2 rounded-lg transition-colors duration-200" title="Editar receita">
                                    ‚úèÔ∏è
                                </button>
                                <button onclick="excluirReceita(${receita.id})" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white p-2 rounded-lg transition-colors duration-200" title="Excluir receita">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Conte√∫do do Card -->
                    <div class="p-6">
                        <!-- Informa√ß√µes de Custo -->
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="text-sm text-gray-600 mb-1">Custo Total</div>
                                <div class="text-2xl font-bold text-gray-800">R$ ${receita.custoTotal.toFixed(2)}</div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="text-sm text-gray-600 mb-1">Custo por Por√ß√£o</div>
                                <div class="text-2xl font-bold text-gray-800">R$ ${receita.custoPorPorcao.toFixed(2)}</div>
                            </div>
                        </div>

                        <!-- Pre√ßo Sugerido -->
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-4 mb-6">
                            <div class="flex items-center justify-between mb-2">
                                <h5 class="font-semibold text-green-800 flex items-center">
                                    üí∞ Pre√ßo de Venda (Sugerido)
                                </h5>
                            </div>
                            <div class="grid grid-cols-3 gap-4 text-sm">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-600">R$ ${precoSugerido.toFixed(2)}</div>
                                    <div class="text-green-700">por por√ß√£o</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-bold text-orange-600">${margem.toFixed(1)}%</div>
                                    <div class="text-orange-700">Margem</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-bold text-purple-600">R$ ${lucro.toFixed(2)}</div>
                                    <div class="text-purple-700">Lucro</div>
                                </div>
                            </div>
                        </div>

                        <!-- Ingredientes -->
                        <div class="mb-4">
                            <h5 class="font-semibold text-gray-800 mb-3 flex items-center">
                                üßÑ Ingredientes:
                            </h5>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="space-y-1 text-sm text-gray-700">
                                    ${ingredientesDetalhados.join('<br>')}
                                </div>
                            </div>
                        </div>

                        <!-- Modo de Preparo (se existir) -->
                        ${receita.modoPreparo ? `
                            <div class="border-t pt-4">
                                <h5 class="font-semibold text-gray-800 mb-2 flex items-center">
                                    üë®‚Äçüç≥ Modo de Preparo:
                                </h5>
                                <p class="text-sm text-gray-600 bg-blue-50 p-3 rounded-lg">${receita.modoPreparo}</p>
                            </div>
                        ` : ''}

                        <!-- A√ß√µes R√°pidas -->
                        <div class="flex space-x-2 mt-4 pt-4 border-t">
                            <button onclick="duplicarReceita(${receita.id})" class="flex-1 bg-blue-100 hover:bg-blue-200 text-blue-700 py-2 px-3 rounded-lg text-sm font-medium transition-colors duration-200">
                                üìã Duplicar
                            </button>
                            <button onclick="calcularReceita(${receita.id})" class="flex-1 bg-green-100 hover:bg-green-200 text-green-700 py-2 px-3 rounded-lg text-sm font-medium transition-colors duration-200">
                                üßÆ Calcular
                            </button>
                            <button onclick="imprimirReceita(${receita.id})" class="flex-1 bg-purple-100 hover:bg-purple-200 text-purple-700 py-2 px-3 rounded-lg text-sm font-medium transition-colors duration-200">
                                üñ®Ô∏è Imprimir
                            </button>
                        </div>
                    </div>
                `;
                        container.appendChild(card);
                    });

                    // Mostrar mensagem se n√£o houver receitas
                    if (receitas.length === 0) {
                        container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-6xl mb-4">üë®‚Äçüç≥</div>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">Nenhuma receita cadastrada</h3>
                        <p class="text-gray-500 mb-6">Comece criando sua primeira receita!</p>
                        <button onclick="openModal('modalReceita')" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200">
                            ‚ûï Criar Primeira Receita
                        </button>
                    </div>
                `;
                    }
                }

                // Fun√ß√£o para atualizar receitas dispon√≠veis no pedido
                function atualizarReceitasDisponiveis() {
                    const selects = document.querySelectorAll('.receita-select');
                    selects.forEach(select => {
                        select.innerHTML = '<option value="">Selecione uma receita</option>';
                        receitas.forEach(receita => {
                            const option = document.createElement('option');
                            option.value = receita.id;
                            option.textContent = `${receita.nome} (R$ ${receita.custoPorPorcao.toFixed(2)}/por√ß√£o)`;
                            select.appendChild(option);
                        });
                    });
                }

                // Fun√ß√£o para adicionar item ao pedido
                function adicionarItemPedido() {
                    const container = document.getElementById('itensPedido');
                    const itemCount = container.children.length + 1;

                    const newItem = document.createElement('div');
                    newItem.className = 'item-pedido bg-white border border-gray-200 rounded-lg p-4';
                    newItem.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <span class="font-medium text-gray-800">Item ${itemCount}</span>
                    <button type="button" onclick="removerItemPedido(this)" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Receita</label>
                        <select class="receita-select w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" onchange="atualizarCustoItem(this)" required>
                            <option value="">Selecione uma receita</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Quantidade</label>
                        <input type="number" class="quantidade-item w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" min="1" step="1" value="1" onchange="calcularTotalItem(this)" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pre√ßo Unit. (R$)</label>
                        <input type="number" class="preco-item w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" min="0" step="0.01" onchange="calcularTotalItem(this)" required>
                    </div>
                </div>
                <div class="mt-3 grid grid-cols-3 gap-4 text-sm">
                    <div class="bg-gray-50 p-2 rounded">
                        <span class="text-gray-600">Custo:</span>
                        <span class="custo-item font-medium">R$ 0,00</span>
                    </div>
                    <div class="bg-gray-50 p-2 rounded">
                        <span class="text-gray-600">Total:</span>
                        <span class="total-item font-medium">R$ 0,00</span>
                    </div>
                    <div class="bg-gray-50 p-2 rounded">
                        <span class="text-gray-600">Lucro:</span>
                        <span class="lucro-item font-medium text-green-600">R$ 0,00</span>
                    </div>
                </div>
            `;

                    container.appendChild(newItem);

                    // Atualizar op√ß√µes de receitas no novo select
                    const newSelect = newItem.querySelector('.receita-select');
                    receitas.forEach(receita => {
                        const option = document.createElement('option');
                        option.value = receita.id;
                        option.textContent = `${receita.nome} (R$ ${receita.custoPorPorcao.toFixed(2)}/por√ß√£o)`;
                        newSelect.appendChild(option);
                    });

                    // Mostrar bot√£o de remover se houver mais de um item
                    const removeButtons = container.querySelectorAll('button[onclick*="removerItemPedido"]');
                    removeButtons.forEach(btn => btn.classList.remove('hidden'));
                }

                // Fun√ß√£o para remover item do pedido
                function removerItemPedido(button) {
                    const container = document.getElementById('itensPedido');
                    button.closest('.item-pedido').remove();

                    // Renumerar itens
                    const items = container.querySelectorAll('.item-pedido');
                    items.forEach((item, index) => {
                        const label = item.querySelector('span');
                        label.textContent = `Item ${index + 1}`;
                    });

                    // Esconder bot√£o de remover se houver apenas um item
                    if (items.length === 1) {
                        const removeButton = items[0].querySelector('button[onclick*="removerItemPedido"]');
                        removeButton.classList.add('hidden');
                    }

                    calcularTotalPedido();
                }

                // Fun√ß√£o para atualizar custo do item quando receita √© selecionada
                function atualizarCustoItem(select) {
                    const receitaId = parseInt(select.value);
                    const receita = receitas.find(r => r.id === receitaId);

                    if (receita) {
                        const itemDiv = select.closest('.item-pedido');
                        const precoInput = itemDiv.querySelector('.preco-item');
                        const custoSpan = itemDiv.querySelector('.custo-item');

                        // Sugerir pre√ßo baseado no custo + margem de 200%
                        const precoSugerido = receita.custoPorPorcao * 3;
                        precoInput.value = precoSugerido.toFixed(2);

                        custoSpan.textContent = `R$ ${receita.custoPorPorcao.toFixed(2)}`;

                        calcularTotalItem(precoInput);
                    }
                }

                // Fun√ß√£o para calcular total do item
                function calcularTotalItem(input) {
                    const itemDiv = input.closest('.item-pedido');
                    const quantidade = parseFloat(itemDiv.querySelector('.quantidade-item').value) || 0;
                    const preco = parseFloat(itemDiv.querySelector('.preco-item').value) || 0;
                    const custoText = itemDiv.querySelector('.custo-item').textContent;
                    const custo = parseFloat(custoText.replace('R$ ', '').replace(',', '.')) || 0;

                    const total = quantidade * preco;
                    const custoTotal = quantidade * custo;
                    const lucro = total - custoTotal;

                    itemDiv.querySelector('.total-item').textContent = `R$ ${total.toFixed(2)}`;
                    itemDiv.querySelector('.lucro-item').textContent = `R$ ${lucro.toFixed(2)}`;

                    calcularTotalPedido();
                }

                // Fun√ß√£o para calcular total do pedido
                function calcularTotalPedido() {
                    const items = document.querySelectorAll('.item-pedido');
                    let custoTotal = 0;
                    let totalPedido = 0;
                    let lucroTotal = 0;

                    items.forEach(item => {
                        const quantidade = parseFloat(item.querySelector('.quantidade-item').value) || 0;
                        const preco = parseFloat(item.querySelector('.preco-item').value) || 0;
                        const custoText = item.querySelector('.custo-item').textContent;
                        const custo = parseFloat(custoText.replace('R$ ', '').replace(',', '.')) || 0;

                        custoTotal += quantidade * custo;
                        totalPedido += quantidade * preco;
                    });

                    lucroTotal = totalPedido - custoTotal;
                    const margemMedia = totalPedido > 0 ? (lucroTotal / custoTotal * 100) : 0;

                    document.getElementById('custoTotalPedido').textContent = `R$ ${custoTotal.toFixed(2)}`;
                    document.getElementById('totalPedido').textContent = `R$ ${totalPedido.toFixed(2)}`;
                    document.getElementById('lucroTotalPedido').textContent = `R$ ${lucroTotal.toFixed(2)}`;
                    document.getElementById('margemMediaPedido').textContent = `${margemMedia.toFixed(1)}%`;
                }

                // Fun√ß√£o para finalizar pedido
                function finalizarPedido() {
                    const cliente = document.getElementById('clientePedido').value;
                    const telefone = document.getElementById('telefonePedido').value;

                    if (!cliente) {
                        alert('‚ö†Ô∏è Por favor, informe o nome do cliente!');
                        return;
                    }

                    const items = document.querySelectorAll('.item-pedido');
                    const itensPedido = [];

                    let valid = true;
                    items.forEach(item => {
                        const receitaSelect = item.querySelector('.receita-select');
                        const quantidade = parseFloat(item.querySelector('.quantidade-item').value);
                        const preco = parseFloat(item.querySelector('.preco-item').value);

                        if (!receitaSelect.value || !quantidade || !preco) {
                            valid = false;
                            return;
                        }

                        const receita = receitas.find(r => r.id === parseInt(receitaSelect.value));
                        itensPedido.push({
                            receita: receita.nome,
                            quantidade,
                            preco,
                            custo: receita.custoPorPorcao,
                            total: quantidade * preco,
                            lucro: (quantidade * preco) - (quantidade * receita.custoPorPorcao)
                        });
                    });

                    if (!valid) {
                        alert('‚ö†Ô∏è Por favor, preencha todos os campos dos itens!');
                        return;
                    }

                    const custoTotal = parseFloat(document.getElementById('custoTotalPedido').textContent.replace('R$ ', ''));
                    const totalPedido = parseFloat(document.getElementById('totalPedido').textContent.replace('R$ ', ''));
                    const lucroTotal = parseFloat(document.getElementById('lucroTotalPedido').textContent.replace('R$ ', ''));
                    const margemMedia = parseFloat(document.getElementById('margemMediaPedido').textContent.replace('%', ''));

                    const novaVenda = {
                        id: proximoIdVenda++,
                        data: new Date().toISOString().split('T')[0],
                        cliente,
                        telefone,
                        itens: itensPedido,
                        custoTotal,
                        totalPedido,
                        lucroTotal,
                        margemMedia
                    };

                    vendas.push(novaVenda);

                    // Salvar dados automaticamente
                    salvarDados();

                    closeModal('modalVenda');
                    alert('‚úÖ Pedido finalizado com sucesso!');

                    // Atualizar vendas se estivermos na se√ß√£o de vendas
                    if (!document.getElementById('vendas').classList.contains('hidden')) {
                        atualizarVendas();
                    }
                }

                // Fun√ß√£o para atualizar vendas
                function atualizarVendas() {
                    // Calcular estat√≠sticas
                    const hoje = new Date().toISOString().split('T')[0];
                    const mesAtual = new Date().getMonth();
                    const anoAtual = new Date().getFullYear();

                    const vendasHoje = vendas.filter(v => v.data === hoje).reduce((sum, v) => sum + v.totalPedido, 0);
                    const vendasMes = vendas.filter(v => {
                        const dataVenda = new Date(v.data);
                        return dataVenda.getMonth() === mesAtual && dataVenda.getFullYear() === anoAtual;
                    }).reduce((sum, v) => sum + v.totalPedido, 0);

                    const lucroMes = vendas.filter(v => {
                        const dataVenda = new Date(v.data);
                        return dataVenda.getMonth() === mesAtual && dataVenda.getFullYear() === anoAtual;
                    }).reduce((sum, v) => sum + v.lucroTotal, 0);

                    const margemMedia = vendas.length > 0 ?
                        vendas.reduce((sum, v) => sum + v.margemMedia, 0) / vendas.length : 0;

                    // Atualizar cards
                    document.getElementById('vendasHoje').textContent = `R$ ${vendasHoje.toFixed(2)}`;
                    document.getElementById('vendasMes').textContent = `R$ ${vendasMes.toFixed(2)}`;
                    document.getElementById('lucroMes').textContent = `R$ ${lucroMes.toFixed(2)}`;
                    document.getElementById('margemMedia').textContent = `${margemMedia.toFixed(1)}%`;

                    // Atualizar gr√°ficos
                    atualizarGraficos();

                    // Aplicar filtros e atualizar tabela
                    filtrarVendas();
                }

                // Fun√ß√£o para atualizar gr√°ficos
                function atualizarGraficos() {
                    atualizarGraficoEvolucaoLucro();
                    atualizarGraficoVendasLucro();
                    atualizarProdutosMaisLucrativos();
                    atualizarGraficoDistribuicaoMargem();
                }

                // Gr√°fico de Evolu√ß√£o do Lucro com filtros
                function atualizarGraficoEvolucaoLucro() {
                    const container = document.getElementById('graficoEvolucaoLucro');
                    const labelPeriodo = document.getElementById('labelPeriodoLucro');
                    const totalPeriodo = document.getElementById('totalPeriodoLucro');
                    const mediaPeriodo = document.getElementById('mediaPeriodoLucro');

                    container.innerHTML = '';

                    // Obter valores dos filtros
                    const diasFiltro = parseInt(document.getElementById('filtroPer√≠odoLucro')?.value || 30);
                    const tipoFiltro = document.getElementById('filtroTipoLucro')?.value || 'lucro';

                    // Gerar dados do per√≠odo selecionado
                    const dados = [];
                    const hoje = new Date();
                    let totalValor = 0;
                    let diasComVendas = 0;

                    for (let i = diasFiltro - 1; i >= 0; i--) {
                        const data = new Date(hoje);
                        data.setDate(data.getDate() - i);
                        const dataStr = data.toISOString().split('T')[0];

                        const vendasDia = vendas.filter(v => v.data === dataStr);

                        let valorDia = 0;

                        switch (tipoFiltro) {
                            case 'lucro':
                                valorDia = vendasDia.reduce((sum, v) => sum + v.lucroTotal, 0);
                                break;
                            case 'vendas':
                                valorDia = vendasDia.reduce((sum, v) => sum + v.totalPedido, 0);
                                break;
                            case 'margem':
                                if (vendasDia.length > 0) {
                                    valorDia = vendasDia.reduce((sum, v) => sum + v.margemMedia, 0) / vendasDia.length;
                                    diasComVendas++;
                                }
                                break;
                        }

                        totalValor += valorDia;

                        dados.push({
                            data: data.getDate(),
                            mes: data.getMonth() + 1,
                            valor: valorDia,
                            dataCompleta: data.toLocaleDateString('pt-BR')
                        });
                    }

                    // Calcular valores m√°ximos para escala
                    const maxValor = Math.max(...dados.map(d => d.valor), 1);

                    // Definir cores baseadas no tipo
                    const cores = {
                        'lucro': { from: 'from-green-500', to: 'to-green-300', text: 'text-green-600' },
                        'vendas': { from: 'from-blue-500', to: 'to-blue-300', text: 'text-blue-600' },
                        'margem': { from: 'from-purple-500', to: 'to-purple-300', text: 'text-purple-600' }
                    };

                    const cor = cores[tipoFiltro];

                    // Criar barras do gr√°fico
                    dados.forEach(dia => {
                        const altura = (dia.valor / maxValor) * 100;
                        const barra = document.createElement('div');
                        barra.className = `bg-gradient-to-t ${cor.from} ${cor.to} rounded-t flex-1 relative group cursor-pointer hover:opacity-80 transition-opacity`;
                        barra.style.height = `${altura}%`;
                        barra.style.minHeight = '2px';

                        // Tooltip com informa√ß√µes detalhadas
                        let tooltipText = '';
                        switch (tipoFiltro) {
                            case 'lucro':
                                tooltipText = `${dia.dataCompleta}: R$ ${dia.valor.toFixed(2)} em lucro`;
                                break;
                            case 'vendas':
                                tooltipText = `${dia.dataCompleta}: R$ ${dia.valor.toFixed(2)} em vendas`;
                                break;
                            case 'margem':
                                tooltipText = `${dia.dataCompleta}: ${dia.valor.toFixed(1)}% de margem m√©dia`;
                                break;
                        }
                        barra.title = tooltipText;

                        container.appendChild(barra);
                    });

                    // Atualizar labels e estat√≠sticas
                    labelPeriodo.textContent = `√öltimos ${diasFiltro} dias`;

                    let totalTexto = '';
                    let mediaTexto = '';

                    switch (tipoFiltro) {
                        case 'lucro':
                            totalTexto = `Total: R$ ${totalValor.toFixed(2)}`;
                            mediaTexto = `M√©dia: R$ ${(totalValor / diasFiltro).toFixed(2)}/dia`;
                            break;
                        case 'vendas':
                            totalTexto = `Total: R$ ${totalValor.toFixed(2)}`;
                            mediaTexto = `M√©dia: R$ ${(totalValor / diasFiltro).toFixed(2)}/dia`;
                            break;
                        case 'margem':
                            const mediaReal = diasComVendas > 0 ? totalValor / diasComVendas : 0;
                            totalTexto = `Dias com vendas: ${diasComVendas}`;
                            mediaTexto = `Margem m√©dia: ${mediaReal.toFixed(1)}%`;
                            break;
                    }

                    totalPeriodo.textContent = totalTexto;
                    mediaPeriodo.textContent = mediaTexto;
                }

                // Gr√°fico Vendas vs Lucro (√∫ltimos 6 meses)
                function atualizarGraficoVendasLucro() {
                    const container = document.getElementById('graficoVendasLucro').querySelector('.h-full');
                    container.innerHTML = '';

                    // Gerar dados dos √∫ltimos 6 meses
                    const dados = [];
                    const hoje = new Date();

                    for (let i = 5; i >= 0; i--) {
                        const data = new Date(hoje.getFullYear(), hoje.getMonth() - i, 1);
                        const mes = data.toLocaleDateString('pt-BR', { month: 'short' });

                        const vendasMes = vendas
                            .filter(v => {
                                const dataVenda = new Date(v.data);
                                return dataVenda.getMonth() === data.getMonth() &&
                                    dataVenda.getFullYear() === data.getFullYear();
                            })
                            .reduce((sum, v) => sum + v.totalPedido, 0);

                        const lucroMes = vendas
                            .filter(v => {
                                const dataVenda = new Date(v.data);
                                return dataVenda.getMonth() === data.getMonth() &&
                                    dataVenda.getFullYear() === data.getFullYear();
                            })
                            .reduce((sum, v) => sum + v.lucroTotal, 0);

                        dados.push({ mes, vendas: vendasMes, lucro: lucroMes });
                    }

                    const maxValor = Math.max(...dados.map(d => Math.max(d.vendas, d.lucro)), 1);

                    dados.forEach(mes => {
                        const alturaVendas = (mes.vendas / maxValor) * 100;
                        const alturaLucro = (mes.lucro / maxValor) * 100;

                        const grupo = document.createElement('div');
                        grupo.className = 'flex flex-col items-center space-y-1 flex-1';

                        const barras = document.createElement('div');
                        barras.className = 'flex items-end space-x-1 h-48';

                        const barraVendas = document.createElement('div');
                        barraVendas.className = 'bg-blue-500 w-4 rounded-t cursor-pointer';
                        barraVendas.style.height = `${alturaVendas}%`;
                        barraVendas.style.minHeight = '2px';
                        barraVendas.title = `Vendas ${mes.mes}: R$ ${mes.vendas.toFixed(2)}`;

                        const barraLucro = document.createElement('div');
                        barraLucro.className = 'bg-green-500 w-4 rounded-t cursor-pointer';
                        barraLucro.style.height = `${alturaLucro}%`;
                        barraLucro.style.minHeight = '2px';
                        barraLucro.title = `Lucro ${mes.mes}: R$ ${mes.lucro.toFixed(2)}`;

                        const label = document.createElement('div');
                        label.className = 'text-xs text-gray-600 text-center';
                        label.textContent = mes.mes;

                        barras.appendChild(barraVendas);
                        barras.appendChild(barraLucro);
                        grupo.appendChild(barras);
                        grupo.appendChild(label);
                        container.appendChild(grupo);
                    });
                }

                // Produtos Mais Lucrativos
                function atualizarProdutosMaisLucrativos() {
                    const container = document.getElementById('produtosMaisLucrativos');
                    container.innerHTML = '';

                    // Calcular lucro por produto
                    const lucrosPorProduto = {};

                    vendas.forEach(venda => {
                        venda.itens.forEach(item => {
                            if (!lucrosPorProduto[item.receita]) {
                                lucrosPorProduto[item.receita] = 0;
                            }
                            lucrosPorProduto[item.receita] += item.lucro;
                        });
                    });

                    // Ordenar por lucro
                    const produtosOrdenados = Object.entries(lucrosPorProduto)
                        .sort(([, a], [, b]) => b - a)
                        .slice(0, 5);

                    if (produtosOrdenados.length === 0) {
                        container.innerHTML = '<p class="text-gray-500 text-center">Nenhuma venda registrada ainda</p>';
                        return;
                    }

                    const maxLucro = produtosOrdenados[0][1];

                    produtosOrdenados.forEach(([produto, lucro], index) => {
                        const porcentagem = (lucro / maxLucro) * 100;

                        const item = document.createElement('div');
                        item.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                        item.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="text-lg">${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ'}</div>
                        <div>
                            <div class="font-medium text-gray-800">${produto}</div>
                            <div class="text-sm text-gray-600">R$ ${lucro.toFixed(2)} em lucro</div>
                        </div>
                    </div>
                    <div class="w-20 bg-gray-200 rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full" style="width: ${porcentagem}%"></div>
                    </div>
                `;
                        container.appendChild(item);
                    });
                }

                // Gr√°fico de Distribui√ß√£o de Margem
                function atualizarGraficoDistribuicaoMargem() {
                    const container = document.getElementById('graficoDistribuicaoMargem');
                    container.innerHTML = '';

                    if (vendas.length === 0) {
                        container.innerHTML = '<p class="text-gray-500">Nenhuma venda para an√°lise</p>';
                        return;
                    }

                    // Calcular distribui√ß√£o de margem
                    let baixa = 0, media = 0, alta = 0;

                    vendas.forEach(venda => {
                        if (venda.margemMedia < 30) baixa++;
                        else if (venda.margemMedia <= 60) media++;
                        else alta++;
                    });

                    const total = vendas.length;
                    const dados = [
                        { label: 'Baixa', valor: baixa, cor: 'bg-red-500', porcentagem: (baixa / total) * 100 },
                        { label: 'M√©dia', valor: media, cor: 'bg-yellow-500', porcentagem: (media / total) * 100 },
                        { label: 'Alta', valor: alta, cor: 'bg-green-500', porcentagem: (alta / total) * 100 }
                    ];

                    // Criar gr√°fico de pizza simples
                    const pizza = document.createElement('div');
                    pizza.className = 'relative w-32 h-32 rounded-full mx-auto';
                    pizza.style.background = `conic-gradient(
                #ef4444 0deg ${dados[0].porcentagem * 3.6}deg,
                #eab308 ${dados[0].porcentagem * 3.6}deg ${(dados[0].porcentagem + dados[1].porcentagem) * 3.6}deg,
                #22c55e ${(dados[0].porcentagem + dados[1].porcentagem) * 3.6}deg 360deg
            )`;

                    // Centro do gr√°fico
                    const centro = document.createElement('div');
                    centro.className = 'absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-white rounded-full flex items-center justify-center';
                    centro.innerHTML = '<span class="text-sm font-bold text-gray-800">Margem</span>';

                    pizza.appendChild(centro);
                    container.appendChild(pizza);

                    // Estat√≠sticas
                    const stats = document.createElement('div');
                    stats.className = 'mt-4 space-y-2 text-sm';
                    dados.forEach(item => {
                        if (item.valor > 0) {
                            const stat = document.createElement('div');
                            stat.className = 'flex justify-between items-center';
                            stat.innerHTML = `
                        <span class="text-gray-600">${item.label}:</span>
                        <span class="font-medium">${item.valor} (${item.porcentagem.toFixed(1)}%)</span>
                    `;
                            stats.appendChild(stat);
                        }
                    });
                    container.appendChild(stats);
                }

                // Fun√ß√£o para filtrar vendas
                function filtrarVendas() {
                    const busca = document.getElementById('buscarVendas').value.toLowerCase();
                    const filtroPeriodo = document.getElementById('filtroPeriodo').value;
                    const filtroValor = document.getElementById('filtroValor').value;
                    const ordenarPor = document.getElementById('ordenarVendasPor').value;

                    // Filtrar vendas
                    vendasFiltradas = vendas.filter(venda => {
                        // Filtro de busca
                        const matchBusca = !busca ||
                            venda.cliente.toLowerCase().includes(busca) ||
                            venda.itens.some(item => item.receita.toLowerCase().includes(busca));

                        // Filtro de per√≠odo
                        let matchPeriodo = true;
                        if (filtroPeriodo) {
                            const dataVenda = new Date(venda.data);
                            const hoje = new Date();

                            switch (filtroPeriodo) {
                                case 'hoje':
                                    matchPeriodo = venda.data === hoje.toISOString().split('T')[0];
                                    break;
                                case 'semana':
                                    const inicioSemana = new Date(hoje);
                                    inicioSemana.setDate(hoje.getDate() - hoje.getDay());
                                    matchPeriodo = dataVenda >= inicioSemana;
                                    break;
                                case 'mes':
                                    matchPeriodo = dataVenda.getMonth() === hoje.getMonth() &&
                                        dataVenda.getFullYear() === hoje.getFullYear();
                                    break;
                                case 'trimestre':
                                    const inicioTrimestre = new Date(hoje);
                                    inicioTrimestre.setMonth(hoje.getMonth() - 3);
                                    matchPeriodo = dataVenda >= inicioTrimestre;
                                    break;
                            }
                        }

                        // Filtro de valor
                        let matchValor = true;
                        if (filtroValor) {
                            switch (filtroValor) {
                                case 'baixo':
                                    matchValor = venda.totalPedido <= 50;
                                    break;
                                case 'medio':
                                    matchValor = venda.totalPedido > 50 && venda.totalPedido <= 200;
                                    break;
                                case 'alto':
                                    matchValor = venda.totalPedido > 200;
                                    break;
                            }
                        }

                        return matchBusca && matchPeriodo && matchValor;
                    });

                    // Ordenar vendas
                    vendasFiltradas.sort((a, b) => {
                        switch (ordenarPor) {
                            case 'data':
                                return new Date(a.data) - new Date(b.data);
                            case 'data-desc':
                                return new Date(b.data) - new Date(a.data);
                            case 'cliente':
                                return a.cliente.localeCompare(b.cliente);
                            case 'cliente-desc':
                                return b.cliente.localeCompare(a.cliente);
                            case 'total':
                                return a.totalPedido - b.totalPedido;
                            case 'total-desc':
                                return b.totalPedido - a.totalPedido;
                            case 'lucro':
                                return a.lucroTotal - b.lucroTotal;
                            case 'lucro-desc':
                                return b.lucroTotal - a.lucroTotal;
                            case 'margem':
                                return a.margemMedia - b.margemMedia;
                            case 'margem-desc':
                                return b.margemMedia - a.margemMedia;
                            default:
                                return 0;
                        }
                    });

                    // Resetar para primeira p√°gina quando filtros mudarem
                    paginaAtualVendas = 1;

                    // Atualizar tabela com pagina√ß√£o
                    atualizarTabelaVendas();
                    atualizarPaginacaoVendas();
                }

                // Fun√ß√£o para atualizar tabela de vendas com pagina√ß√£o
                function atualizarTabelaVendas() {
                    const tbody = document.getElementById('tabelaVendas');
                    tbody.innerHTML = '';

                    // Calcular itens da p√°gina atual
                    const inicio = (paginaAtualVendas - 1) * vendasPorPagina;
                    const fim = inicio + vendasPorPagina;
                    const vendasPagina = vendasFiltradas.slice(inicio, fim);

                    vendasPagina.forEach(venda => {
                        const row = document.createElement('tr');
                        row.className = 'venda-row';
                        row.setAttribute('data-venda-id', venda.id);

                        const itensTexto = venda.itens.map(item => `${item.receita} (${item.quantidade}x)`).join(', ');
                        const margemClass = venda.margemMedia < 30 ? 'text-red-600' :
                            venda.margemMedia <= 60 ? 'text-yellow-600' : 'text-green-600';

                        row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="checkbox" class="checkbox-produto venda-checkbox" data-venda-id="${venda.id}" onchange="atualizarSelecaoVendas()">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(venda.data).toLocaleDateString('pt-BR')}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${venda.cliente}</div>
                        <div class="text-sm text-gray-500">${venda.telefone || 'Sem telefone'}</div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">${itensTexto}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600">R$ ${venda.totalPedido.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-purple-600">R$ ${venda.lucroTotal.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${margemClass}">${venda.margemMedia.toFixed(1)}%</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="verDetalhesVenda(${venda.id})" class="text-blue-600 hover:text-blue-900 mr-3">üëÅÔ∏è</button>
                        <button onclick="excluirVenda(${venda.id})" class="text-red-600 hover:text-red-900">üóëÔ∏è</button>
                    </td>
                `;
                        tbody.appendChild(row);
                    });

                    // Atualizar contador de resultados
                    const resultadosDiv = document.getElementById('resultadosFiltroVendas');
                    if (vendasFiltradas.length === vendas.length) {
                        resultadosDiv.textContent = `Mostrando ${inicio + 1}-${Math.min(fim, vendasFiltradas.length)} de ${vendas.length} vendas`;
                    } else {
                        resultadosDiv.textContent = `Mostrando ${inicio + 1}-${Math.min(fim, vendasFiltradas.length)} de ${vendasFiltradas.length} vendas filtradas (${vendas.length} total)`;
                    }
                }

                // Fun√ß√µes de pagina√ß√£o de vendas
                function atualizarPaginacaoVendas() {
                    const totalPaginas = Math.ceil(vendasFiltradas.length / vendasPorPagina);

                    document.getElementById('infoPaginaVendas').textContent = `P√°gina ${paginaAtualVendas} de ${totalPaginas}`;

                    const btnAnterior = document.getElementById('btnAnteriorVendas');
                    const btnProximo = document.getElementById('btnProximoVendas');

                    btnAnterior.disabled = paginaAtualVendas <= 1;
                    btnProximo.disabled = paginaAtualVendas >= totalPaginas;
                }

                function paginaAnteriorVendas() {
                    if (paginaAtualVendas > 1) {
                        paginaAtualVendas--;
                        atualizarTabelaVendas();
                        atualizarPaginacaoVendas();
                        deselecionarTodasVendas();
                    }
                }

                function proximaPaginaVendas() {
                    const totalPaginas = Math.ceil(vendasFiltradas.length / vendasPorPagina);
                    if (paginaAtualVendas < totalPaginas) {
                        paginaAtualVendas++;
                        atualizarTabelaVendas();
                        atualizarPaginacaoVendas();
                        deselecionarTodasVendas();
                    }
                }

                function mudarVendasPorPagina() {
                    vendasPorPagina = parseInt(document.getElementById('vendasPorPagina').value);
                    paginaAtualVendas = 1;
                    atualizarTabelaVendas();
                    atualizarPaginacaoVendas();
                    deselecionarTodasVendas();
                }

                // Fun√ß√µes de sele√ß√£o m√∫ltipla de vendas
                function atualizarSelecaoVendas() {
                    const checkboxes = document.querySelectorAll('.venda-checkbox');
                    const selecionados = document.querySelectorAll('.venda-checkbox:checked');
                    const selectAll = document.getElementById('selectAllVendas');
                    const acoesBatch = document.getElementById('acoesVendasBatch');
                    const vendasSelecionadas = document.getElementById('vendasSelecionadas');

                    // Atualizar contador
                    vendasSelecionadas.textContent = `${selecionados.length} vendas selecionadas`;

                    // Mostrar/esconder a√ß√µes em lote
                    if (selecionados.length > 0) {
                        acoesBatch.classList.remove('hidden');
                    } else {
                        acoesBatch.classList.add('hidden');
                    }

                    // Atualizar checkbox "selecionar todas"
                    if (selecionados.length === 0) {
                        selectAll.indeterminate = false;
                        selectAll.checked = false;
                    } else if (selecionados.length === checkboxes.length) {
                        selectAll.indeterminate = false;
                        selectAll.checked = true;
                    } else {
                        selectAll.indeterminate = true;
                        selectAll.checked = false;
                    }

                    // Destacar linhas selecionadas
                    document.querySelectorAll('.venda-row').forEach(row => {
                        const checkbox = row.querySelector('.venda-checkbox');
                        if (checkbox.checked) {
                            row.classList.add('linha-selecionada');
                        } else {
                            row.classList.remove('linha-selecionada');
                        }
                    });
                }

                function toggleSelectAllVendas() {
                    const selectAll = document.getElementById('selectAllVendas');
                    const checkboxes = document.querySelectorAll('.venda-checkbox');

                    checkboxes.forEach(checkbox => {
                        checkbox.checked = selectAll.checked;
                    });

                    atualizarSelecaoVendas();
                }

                function selecionarTodasVendas() {
                    const checkboxes = document.querySelectorAll('.venda-checkbox');
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = true;
                    });
                    atualizarSelecaoVendas();
                }

                function deselecionarTodasVendas() {
                    const checkboxes = document.querySelectorAll('.venda-checkbox');
                    const selectAll = document.getElementById('selectAllVendas');

                    checkboxes.forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    selectAll.checked = false;
                    selectAll.indeterminate = false;

                    atualizarSelecaoVendas();
                }

                function excluirVendasSelecionadas() {
                    const selecionados = document.querySelectorAll('.venda-checkbox:checked');
                    const ids = Array.from(selecionados).map(cb => parseInt(cb.getAttribute('data-venda-id')));

                    if (ids.length === 0) {
                        alert('‚ö†Ô∏è Nenhuma venda selecionada!');
                        return;
                    }

                    const confirmacao = confirm(`Tem certeza que deseja excluir ${ids.length} venda(s) selecionada(s)?`);
                    if (confirmacao) {
                        // Remover vendas selecionadas
                        vendas = vendas.filter(venda => !ids.includes(venda.id));

                        // Salvar dados
                        salvarDados();

                        // Atualizar vendas
                        atualizarVendas();
                        deselecionarTodasVendas();

                        alert(`‚úÖ ${ids.length} venda(s) exclu√≠da(s) com sucesso!`);
                    }
                }

                // Fun√ß√£o para limpar filtros de vendas
                function limparFiltrosVendas() {
                    document.getElementById('buscarVendas').value = '';
                    document.getElementById('filtroPeriodo').value = '';
                    document.getElementById('filtroValor').value = '';
                    document.getElementById('ordenarVendasPor').value = 'data-desc';
                    paginaAtualVendas = 1;
                    deselecionarTodasVendas();
                    filtrarVendas();
                }

                // Fun√ß√µes de exporta√ß√£o de vendas avan√ßadas
                function exportarVendasExcel() {
                    if (vendas.length === 0) {
                        alert('‚ùå Nenhuma venda para exportar!');
                        return;
                    }

                    // Preparar dados para exporta√ß√£o
                    const dadosExportacao = vendas.map(venda => ({
                        'Data': new Date(venda.data).toLocaleDateString('pt-BR'),
                        'Cliente': venda.cliente,
                        'Telefone': venda.telefone || '',
                        'Itens': venda.itens.map(item => `${item.receita} (${item.quantidade}x)`).join('; '),
                        'Custo Total': venda.custoTotal.toFixed(2),
                        'Total da Venda': venda.totalPedido.toFixed(2),
                        'Lucro Total': venda.lucroTotal.toFixed(2),
                        'Margem (%)': venda.margemMedia.toFixed(1)
                    }));

                    // Criar workbook
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.json_to_sheet(dadosExportacao);

                    // Definir larguras das colunas
                    ws['!cols'] = [
                        { wch: 12 }, // Data
                        { wch: 25 }, // Cliente
                        { wch: 15 }, // Telefone
                        { wch: 40 }, // Itens
                        { wch: 15 }, // Custo Total
                        { wch: 18 }, // Total da Venda
                        { wch: 15 }, // Lucro Total
                        { wch: 12 }  // Margem
                    ];

                    XLSX.utils.book_append_sheet(wb, ws, 'Vendas');

                    // Gerar nome do arquivo com data
                    const agora = new Date();
                    const dataFormatada = agora.toISOString().split('T')[0];
                    const nomeArquivo = `vendas_${dataFormatada}.xlsx`;

                    XLSX.writeFile(wb, nomeArquivo);

                    alert(`‚úÖ Relat√≥rio de vendas exportado com sucesso!\nüìÅ ${nomeArquivo}`);
                }

                function exportarVendasPDF() {
                    if (vendas.length === 0) {
                        alert('‚ùå Nenhuma venda para exportar!');
                        return;
                    }

                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();

                    // Configurar fonte
                    doc.setFont('helvetica');

                    // Cabe√ßalho
                    doc.setFontSize(20);
                    doc.text('Relat√≥rio de Vendas', 20, 20);

                    doc.setFontSize(12);
                    doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}`, 20, 30);
                    doc.text(`Total de vendas: ${vendas.length}`, 20, 40);

                    // Resumo
                    const totalVendas = vendas.reduce((sum, v) => sum + v.totalPedido, 0);
                    const totalLucro = vendas.reduce((sum, v) => sum + v.lucroTotal, 0);
                    const margemMedia = vendas.length > 0 ? vendas.reduce((sum, v) => sum + v.margemMedia, 0) / vendas.length : 0;

                    doc.text(`Total em vendas: R$ ${totalVendas.toFixed(2)}`, 20, 50);
                    doc.text(`Total em lucro: R$ ${totalLucro.toFixed(2)}`, 20, 60);
                    doc.text(`Margem m√©dia: ${margemMedia.toFixed(1)}%`, 20, 70);

                    // Linha separadora
                    doc.line(20, 80, 190, 80);

                    // Cabe√ßalho da tabela
                    let yPos = 95;
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'bold');

                    doc.text('Data', 20, yPos);
                    doc.text('Cliente', 45, yPos);
                    doc.text('Total', 100, yPos);
                    doc.text('Lucro', 130, yPos);
                    doc.text('Margem', 160, yPos);

                    yPos += 5;
                    doc.line(20, yPos, 190, yPos);

                    // Dados das vendas
                    doc.setFont('helvetica', 'normal');
                    yPos += 10;

                    vendas.forEach((venda, index) => {
                        if (yPos > 270) {
                            doc.addPage();
                            yPos = 20;
                        }

                        doc.text(new Date(venda.data).toLocaleDateString('pt-BR'), 20, yPos);
                        doc.text(venda.cliente.substring(0, 20), 45, yPos);
                        doc.text(`R$ ${venda.totalPedido.toFixed(2)}`, 100, yPos);
                        doc.text(`R$ ${venda.lucroTotal.toFixed(2)}`, 130, yPos);
                        doc.text(`${venda.margemMedia.toFixed(1)}%`, 160, yPos);

                        yPos += 8;
                    });

                    // Salvar PDF
                    const agora = new Date();
                    const dataFormatada = agora.toISOString().split('T')[0];
                    const nomeArquivo = `relatorio_vendas_${dataFormatada}.pdf`;

                    doc.save(nomeArquivo);

                    alert(`‚úÖ Relat√≥rio de vendas PDF gerado com sucesso!\nüìÅ ${nomeArquivo}`);
                }

                // Vari√°veis de personaliza√ß√£o
                let personalizacao = {
                    nomeEmpresa: 'Doce Controle',
                    logo: null,
                    logoTipo: 'emoji', // 'emoji' ou 'imagem'
                    emoji: 'üßÅ',
                    tema: 'rosa',
                    coresPersonalizadas: {
                        primaria: '#ec4899',
                        secundaria: '#a855f7',
                        ativo: false
                    },
                    modoEscuro: false,
                    transparencia: 1,
                    padrao: 'padrao',
                    fundoPersonalizado: null
                };

                // Fun√ß√µes de personaliza√ß√£o b√°sica
                function selecionarEmoji(emoji) {
                    personalizacao.emoji = emoji;
                    personalizacao.logoTipo = 'emoji';
                    personalizacao.logo = null;

                    document.getElementById('previewLogo').innerHTML = emoji;

                    // Atualizar emoji na sidebar e header
                    ['sidebarLogo', 'mobileLogo'].forEach(id => {
                        const el = document.getElementById(id);
                        if (el) {
                            el.textContent = emoji;
                            el.innerHTML = emoji;
                        }
                    });

                    // Esconder preview de logo se estiver vis√≠vel
                    document.getElementById('logoPreview').classList.add('hidden');

                    salvarPersonalizacaoLocal();
                }

                function atualizarNomeEmpresa() {
                    const nome = document.getElementById('nomeEmpresa').value;
                    personalizacao.nomeEmpresa = nome;

                    document.getElementById('previewNome').textContent = nome;

                    // Atualizar nome na sidebar e header
                    ['sidebarTitle', 'mobileTitle'].forEach(id => {
                        const el = document.getElementById(id);
                        if (el) el.textContent = nome;
                    });

                    salvarPersonalizacaoLocal();
                }

                // Fun√ß√µes de logo
                function processarLogo(input) {
                    const file = input.files[0];
                    if (!file) return;

                    // Validar tamanho (2MB)
                    if (file.size > 2 * 1024 * 1024) {
                        alert('‚ùå Arquivo muito grande! O logo deve ter no m√°ximo 2MB.');
                        return;
                    }

                    // Validar tipo
                    if (!file.type.startsWith('image/')) {
                        alert('‚ùå Formato inv√°lido! Use PNG, JPG ou SVG.');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const logoData = e.target.result;

                        personalizacao.logo = logoData;
                        personalizacao.logoTipo = 'imagem';

                        // Mostrar preview
                        document.getElementById('logoImage').src = logoData;
                        document.getElementById('logoPreview').classList.remove('hidden');

                        // Atualizar preview
                        document.getElementById('previewLogo').innerHTML = `<img src="${logoData}" alt="Logo" class="h-8 w-auto">`;

                        // Atualizar logo na sidebar e header
                        ['sidebarLogo', 'mobileLogo'].forEach(id => {
                            const el = document.getElementById(id);
                            if (el) el.innerHTML = `<img src="${logoData}" alt="Logo" class="h-8 w-auto">`;
                        });

                        salvarPersonalizacaoLocal();
                        alert('‚úÖ Logo carregado com sucesso!');
                    };

                    reader.readAsDataURL(file);
                }

                function removerLogo() {
                    personalizacao.logo = null;
                    personalizacao.logoTipo = 'emoji';

                    document.getElementById('logoPreview').classList.add('hidden');
                    document.getElementById('logoUpload').value = '';

                    // Voltar para emoji
                    const emoji = personalizacao.emoji;
                    document.getElementById('previewLogo').innerHTML = emoji;

                    // Atualizar sidebar e header
                    ['sidebarLogo', 'mobileLogo'].forEach(id => {
                        const el = document.getElementById(id);
                        if (el) {
                            el.textContent = emoji;
                            el.innerHTML = emoji;
                        }
                    });

                    salvarPersonalizacaoLocal();
                    alert('‚úÖ Logo removido com sucesso!');
                }

                // Fun√ß√µes de tema
                function aplicarTema(tema) {
                    personalizacao.tema = tema;
                    personalizacao.coresPersonalizadas.ativo = false;

                    // Remover classes de tema atual e estilos personalizados
                    document.body.className = document.body.className.replace(/bg-gradient-to-br from-\w+-50 to-\w+-50/, '');
                    document.body.style.background = '';

                    // Aplicar novo tema baseado no modo escuro
                    let temas;
                    if (personalizacao.modoEscuro) {
                        temas = {
                            'rosa': 'bg-gradient-to-br from-gray-900 to-pink-900',
                            'azul': 'bg-gradient-to-br from-gray-900 to-blue-900',
                            'verde': 'bg-gradient-to-br from-gray-900 to-green-900',
                            'roxo': 'bg-gradient-to-br from-gray-900 to-purple-900'
                        };
                    } else {
                        temas = {
                            'rosa': 'bg-gradient-to-br from-pink-50 to-purple-50',
                            'azul': 'bg-gradient-to-br from-blue-50 to-indigo-50',
                            'verde': 'bg-gradient-to-br from-green-50 to-emerald-50',
                            'roxo': 'bg-gradient-to-br from-purple-50 to-violet-50'
                        };
                    }

                    document.body.className += ' ' + temas[tema];

                    // Atualizar bot√µes de tema
                    document.querySelectorAll('.tema-btn').forEach(btn => {
                        btn.classList.remove('border-pink-300', 'border-blue-300', 'border-green-300', 'border-purple-300');
                        btn.classList.add('border-gray-300');
                    });

                    if (event && event.target) {
                        event.target.closest('.tema-btn').classList.remove('border-gray-300');
                        event.target.closest('.tema-btn').classList.add(`border-${tema === 'rosa' ? 'pink' : tema === 'azul' ? 'blue' : tema === 'verde' ? 'green' : 'purple'}-300`);
                    }

                    salvarPersonalizacaoLocal();
                }

                // Fun√ß√µes de cores personalizadas
                function aplicarCoresPersonalizadas() {
                    const corPrimaria = document.getElementById('corPrimaria').value;
                    const corSecundaria = document.getElementById('corSecundaria').value;

                    // Atualizar vari√°veis
                    personalizacao.coresPersonalizadas.primaria = corPrimaria;
                    personalizacao.coresPersonalizadas.secundaria = corSecundaria;
                    personalizacao.coresPersonalizadas.ativo = true;
                    personalizacao.tema = 'personalizado';

                    // Aplicar cores ao fundo
                    aplicarGradientePersonalizado(corPrimaria, corSecundaria);

                    // Atualizar preview
                    atualizarPreviewCores();

                    // Desmarcar temas predefinidos
                    document.querySelectorAll('.tema-btn').forEach(btn => {
                        btn.classList.remove('border-pink-300', 'border-blue-300', 'border-green-300', 'border-purple-300');
                        btn.classList.add('border-gray-300');
                    });

                    salvarPersonalizacaoLocal();

                    // Mostrar feedback
                    mostrarFeedbackCores('‚ú® Cores personalizadas aplicadas com sucesso!');
                }

                function aplicarGradientePersonalizado(corPrimaria, corSecundaria) {
                    // Remover classes de tema
                    document.body.className = document.body.className.replace(/bg-gradient-to-br from-\w+-50 to-\w+-50/, '');

                    // Converter cores hex para RGB para criar tons mais claros
                    const rgb1 = hexToRgb(corPrimaria);
                    const rgb2 = hexToRgb(corSecundaria);

                    // Criar tons mais claros (adicionar branco)
                    const cor1Clara = `rgba(${rgb1.r}, ${rgb1.g}, ${rgb1.b}, 0.1)`;
                    const cor2Clara = `rgba(${rgb2.r}, ${rgb2.g}, ${rgb2.b}, 0.1)`;

                    if (personalizacao.modoEscuro) {
                        // Modo escuro: usar cores mais escuras
                        const cor1Escura = `rgba(${Math.max(0, rgb1.r - 100)}, ${Math.max(0, rgb1.g - 100)}, ${Math.max(0, rgb1.b - 100)}, 0.8)`;
                        const cor2Escura = `rgba(${Math.max(0, rgb2.r - 100)}, ${Math.max(0, rgb2.g - 100)}, ${Math.max(0, rgb2.b - 100)}, 0.8)`;
                        document.body.style.background = `linear-gradient(135deg, ${cor1Escura}, ${cor2Escura})`;
                    } else {
                        // Modo claro: usar tons suaves
                        document.body.style.background = `linear-gradient(135deg, ${cor1Clara}, ${cor2Clara})`;
                    }
                }

                function hexToRgb(hex) {
                    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                    return result ? {
                        r: parseInt(result[1], 16),
                        g: parseInt(result[2], 16),
                        b: parseInt(result[3], 16)
                    } : null;
                }

                function sincronizarCorPrimaria() {
                    const hex = document.getElementById('corPrimariaHex').value;
                    if (isValidHex(hex)) {
                        document.getElementById('corPrimaria').value = hex;
                        document.getElementById('corPrimariaHex').value = hex;
                        atualizarPreviewCores();
                    }
                }

                function sincronizarCorSecundaria() {
                    const hex = document.getElementById('corSecundariaHex').value;
                    if (isValidHex(hex)) {
                        document.getElementById('corSecundaria').value = hex;
                        document.getElementById('corSecundariaHex').value = hex;
                        atualizarPreviewCores();
                    }
                }

                function isValidHex(hex) {
                    return /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(hex);
                }

                function atualizarPreviewCores() {
                    const corPrimaria = document.getElementById('corPrimaria').value;
                    const corSecundaria = document.getElementById('corSecundaria').value;

                    // Sincronizar inputs
                    document.getElementById('corPrimariaHex').value = corPrimaria;
                    document.getElementById('corSecundariaHex').value = corSecundaria;

                    // Atualizar preview
                    document.getElementById('previewGradiente').style.background = `linear-gradient(135deg, ${corPrimaria}, ${corSecundaria})`;
                    document.getElementById('previewPrimaria').textContent = corPrimaria;
                    document.getElementById('previewSecundaria').textContent = corSecundaria;
                }

                function gerarPaletaAleatoria() {
                    // Gerar cores aleat√≥rias harmoniosas
                    const hue1 = Math.floor(Math.random() * 360);
                    const hue2 = (hue1 + 60 + Math.random() * 120) % 360; // Cores complementares ou an√°logas

                    const saturation = 70 + Math.random() * 30; // 70-100%
                    const lightness = 45 + Math.random() * 20; // 45-65%

                    const cor1 = hslToHex(hue1, saturation, lightness);
                    const cor2 = hslToHex(hue2, saturation, lightness);

                    // Aplicar cores
                    document.getElementById('corPrimaria').value = cor1;
                    document.getElementById('corSecundaria').value = cor2;

                    atualizarPreviewCores();
                    mostrarFeedbackCores('üé≤ Paleta aleat√≥ria gerada!');
                }

                function hslToHex(h, s, l) {
                    l /= 100;
                    const a = s * Math.min(l, 1 - l) / 100;
                    const f = n => {
                        const k = (n + h / 30) % 12;
                        const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                        return Math.round(255 * color).toString(16).padStart(2, '0');
                    };
                    return `#${f(0)}${f(8)}${f(4)}`;
                }

                function aplicarPaletaSugerida(cor1, cor2) {
                    document.getElementById('corPrimaria').value = cor1;
                    document.getElementById('corSecundaria').value = cor2;

                    atualizarPreviewCores();
                    mostrarFeedbackCores('üí° Paleta sugerida aplicada!');
                }

                function mostrarFeedbackCores(mensagem) {
                    // Criar elemento de feedback tempor√°rio
                    const feedback = document.createElement('div');
                    feedback.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300';
                    feedback.textContent = mensagem;

                    document.body.appendChild(feedback);

                    // Remover ap√≥s 3 segundos
                    setTimeout(() => {
                        feedback.style.opacity = '0';
                        feedback.style.transform = 'translateY(-20px)';
                        setTimeout(() => {
                            if (feedback.parentNode) {
                                feedback.parentNode.removeChild(feedback);
                            }
                        }, 300);
                    }, 2000);
                }

                // Fun√ß√£o de modo escuro
                function toggleModoEscuro() {
                    personalizacao.modoEscuro = document.getElementById('modoEscuro').checked;

                    if (personalizacao.modoEscuro) {
                        // Aplicar modo escuro
                        document.documentElement.classList.add('dark');
                        document.body.style.filter = 'invert(1) hue-rotate(180deg)';
                        document.querySelectorAll('img, video, svg, .no-invert').forEach(el => {
                            el.style.filter = 'invert(1) hue-rotate(180deg)';
                        });
                    } else {
                        // Remover modo escuro
                        document.documentElement.classList.remove('dark');
                        document.body.style.filter = '';
                        document.querySelectorAll('img, video, svg, .no-invert').forEach(el => {
                            el.style.filter = '';
                        });
                    }

                    // Reaplicar tema com nova configura√ß√£o
                    aplicarTema(personalizacao.tema);
                    salvarPersonalizacaoLocal();
                }

                // Fun√ß√£o de transpar√™ncia
                function ajustarTransparencia(valor) {
                    personalizacao.transparencia = parseFloat(valor);

                    // Aplicar transpar√™ncia aos cards
                    document.querySelectorAll('.bg-white').forEach(el => {
                        if (!el.closest('header')) { // N√£o aplicar no header
                            el.style.opacity = valor;
                        }
                    });

                    salvarPersonalizacaoLocal();
                }

                // Fun√ß√µes de padr√µes de fundo
                function aplicarPadrao(padrao) {
                    personalizacao.padrao = padrao;

                    // Remover padr√µes anteriores
                    document.body.style.backgroundImage = '';
                    document.body.style.backgroundColor = '';

                    // Aplicar novo padr√£o
                    switch (padrao) {
                        case 'padrao':
                            // Manter gradiente do tema
                            break;
                        case 'solido':
                            document.body.className = document.body.className.replace(/bg-gradient-to-br from-\w+-50 to-\w+-50/, '');
                            document.body.style.backgroundColor = personalizacao.modoEscuro ? '#1f2937' : '#f9fafb';
                            break;
                        case 'geometrico':
                            document.body.style.backgroundImage = 'repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.05) 10px, rgba(0,0,0,0.05) 20px)';
                            break;
                        case 'ondas':
                            document.body.style.backgroundImage = 'radial-gradient(circle at 25% 25%, rgba(0,0,0,0.05) 0%, transparent 50%), radial-gradient(circle at 75% 75%, rgba(0,0,0,0.05) 0%, transparent 50%)';
                            break;
                        case 'pontos':
                            document.body.style.backgroundImage = 'radial-gradient(circle, rgba(0,0,0,0.1) 1px, transparent 1px)';
                            document.body.style.backgroundSize = '20px 20px';
                            break;
                        case 'listras':
                            document.body.style.backgroundImage = 'repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0,0,0,0.05) 2px, rgba(0,0,0,0.05) 4px)';
                            break;
                    }

                    // Atualizar bot√µes de padr√£o
                    document.querySelectorAll('.padrao-btn').forEach(btn => {
                        btn.classList.remove('border-pink-300');
                        btn.classList.add('border-gray-300');
                    });

                    event.target.closest('.padrao-btn').classList.remove('border-gray-300');
                    event.target.closest('.padrao-btn').classList.add('border-pink-300');

                    salvarPersonalizacaoLocal();
                }

                // Fun√ß√µes de fundo personalizado
                function processarFundoPersonalizado(input) {
                    const file = input.files[0];
                    if (!file) return;

                    // Validar tamanho (5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        alert('‚ùå Arquivo muito grande! A imagem deve ter no m√°ximo 5MB.');
                        return;
                    }

                    // Validar tipo
                    if (!file.type.startsWith('image/')) {
                        alert('‚ùå Formato inv√°lido! Use JPG ou PNG.');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const fundoData = e.target.result;

                        personalizacao.fundoPersonalizado = fundoData;

                        // Aplicar fundo
                        document.body.style.backgroundImage = `url(${fundoData})`;
                        document.body.style.backgroundSize = 'cover';
                        document.body.style.backgroundPosition = 'center';
                        document.body.style.backgroundAttachment = 'fixed';

                        // Mostrar preview
                        document.getElementById('fundoPreview').classList.remove('hidden');

                        salvarPersonalizacaoLocal();
                        alert('‚úÖ Fundo personalizado aplicado com sucesso!');
                    };

                    reader.readAsDataURL(file);
                }

                function removerFundoPersonalizado() {
                    personalizacao.fundoPersonalizado = null;

                    document.body.style.backgroundImage = '';
                    document.body.style.backgroundSize = '';
                    document.body.style.backgroundPosition = '';
                    document.body.style.backgroundAttachment = '';

                    document.getElementById('fundoPreview').classList.add('hidden');
                    document.getElementById('fundoUpload').value = '';

                    // Reaplicar padr√£o atual
                    aplicarPadrao(personalizacao.padrao);

                    salvarPersonalizacaoLocal();
                    alert('‚úÖ Fundo personalizado removido!');
                }

                // Fun√ß√µes de gerenciamento de personaliza√ß√£o
                function salvarPersonalizacaoLocal() {
                    localStorage.setItem('personalizacao', JSON.stringify(personalizacao));
                    atualizarStatusPersonalizacao();
                }

                function salvarPersonalizacao() {
                    salvarPersonalizacaoLocal();
                    alert('‚úÖ Personaliza√ß√£o salva com sucesso!\n\nTodas as suas configura√ß√µes foram preservadas.');
                }

                function carregarPersonalizacao() {
                    const personalizacaoSalva = localStorage.getItem('personalizacao');
                    if (personalizacaoSalva) {
                        personalizacao = { ...personalizacao, ...JSON.parse(personalizacaoSalva) };
                        aplicarPersonalizacao();
                    }
                }

                function aplicarPersonalizacao() {
                    // Aplicar nome da empresa
                    if (document.getElementById('nomeEmpresa')) {
                        document.getElementById('nomeEmpresa').value = personalizacao.nomeEmpresa;
                        atualizarNomeEmpresa();
                    }

                    // Aplicar logo
                    if (personalizacao.logoTipo === 'imagem' && personalizacao.logo) {
                        if (document.getElementById('logoImage')) {
                            document.getElementById('logoImage').src = personalizacao.logo;
                            document.getElementById('logoPreview').classList.remove('hidden');
                        }
                        if (document.getElementById('previewLogo')) {
                            document.getElementById('previewLogo').innerHTML = `<img src="${personalizacao.logo}" alt="Logo" class="h-8 w-auto">`;
                        }

                        // Atualizar logo na sidebar e header
                        ['sidebarLogo', 'mobileLogo'].forEach(id => {
                            const el = document.getElementById(id);
                            if (el) el.innerHTML = `<img src="${personalizacao.logo}" alt="Logo" class="h-8 w-auto">`;
                        });
                    } else {
                        selecionarEmoji(personalizacao.emoji);
                    }

                    // Aplicar cores personalizadas
                    if (personalizacao.coresPersonalizadas && personalizacao.coresPersonalizadas.ativo) {
                        if (document.getElementById('corPrimaria')) {
                            document.getElementById('corPrimaria').value = personalizacao.coresPersonalizadas.primaria;
                            document.getElementById('corSecundaria').value = personalizacao.coresPersonalizadas.secundaria;
                            atualizarPreviewCores();
                            aplicarGradientePersonalizado(personalizacao.coresPersonalizadas.primaria, personalizacao.coresPersonalizadas.secundaria);
                        }
                    } else {
                        // Aplicar tema predefinido
                        aplicarTema(personalizacao.tema);
                    }

                    // Aplicar modo escuro
                    if (document.getElementById('modoEscuro')) {
                        document.getElementById('modoEscuro').checked = personalizacao.modoEscuro;
                        if (personalizacao.modoEscuro) {
                            toggleModoEscuro();
                        }
                    }

                    // Aplicar transpar√™ncia
                    if (document.getElementById('transparenciaSlider')) {
                        document.getElementById('transparenciaSlider').value = personalizacao.transparencia;
                        ajustarTransparencia(personalizacao.transparencia);
                    }

                    // Aplicar padr√£o
                    aplicarPadrao(personalizacao.padrao);

                    // Aplicar fundo personalizado
                    if (personalizacao.fundoPersonalizado) {
                        document.body.style.backgroundImage = `url(${personalizacao.fundoPersonalizado})`;
                        document.body.style.backgroundSize = 'cover';
                        document.body.style.backgroundPosition = 'center';
                        document.body.style.backgroundAttachment = 'fixed';
                        if (document.getElementById('fundoPreview')) {
                            document.getElementById('fundoPreview').classList.remove('hidden');
                        }
                    }

                    atualizarStatusPersonalizacao();
                }

                function exportarConfiguracoes() {
                    const configuracaoCompleta = {
                        personalizacao: personalizacao,
                        configuracoes: configuracoes,
                        versao: '1.0',
                        dataExportacao: new Date().toISOString()
                    };

                    const dataStr = JSON.stringify(configuracaoCompleta, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });

                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(dataBlob);
                    link.download = `configuracoes_personalizacao_${new Date().toISOString().split('T')[0]}.json`;
                    link.click();

                    alert('‚úÖ Configura√ß√µes exportadas com sucesso!\n\nüìÅ Arquivo: ' + link.download);
                }

                function importarConfiguracoes() {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';

                    input.onchange = function (event) {
                        const file = event.target.files[0];
                        if (!file) return;

                        const reader = new FileReader();
                        reader.onload = function (e) {
                            try {
                                const config = JSON.parse(e.target.result);

                                if (!config.personalizacao) {
                                    throw new Error('Arquivo de configura√ß√£o inv√°lido');
                                }

                                const confirmacao = confirm(
                                    `Confirma a importa√ß√£o das configura√ß√µes?\n\n` +
                                    `üìÖ Exportado em: ${new Date(config.dataExportacao).toLocaleDateString('pt-BR')}\n\n` +
                                    `‚ö†Ô∏è ATEN√á√ÉO: Suas configura√ß√µes atuais ser√£o substitu√≠das!`
                                );

                                if (confirmacao) {
                                    personalizacao = { ...personalizacao, ...config.personalizacao };
                                    if (config.configuracoes) {
                                        configuracoes = { ...configuracoes, ...config.configuracoes };
                                    }

                                    aplicarPersonalizacao();
                                    salvarPersonalizacaoLocal();

                                    alert('‚úÖ Configura√ß√µes importadas com sucesso!\n\nTodas as personaliza√ß√µes foram aplicadas.');
                                }

                            } catch (error) {
                                alert('‚ùå Erro ao importar configura√ß√µes: ' + error.message);
                            }
                        };
                        reader.readAsText(file);
                    };

                    input.click();
                }

                function restaurarPadraoPersonalizacao() {
                    const confirmacao = confirm(
                        'üîÑ Restaurar Configura√ß√µes Padr√£o\n\n' +
                        'Tem certeza que deseja restaurar todas as configura√ß√µes para o padr√£o?\n\n' +
                        '‚ö†Ô∏è Esta a√ß√£o n√£o pode ser desfeita!'
                    );

                    if (confirmacao) {
                        // Resetar personaliza√ß√£o
                        personalizacao = {
                            nomeEmpresa: 'Doce Controle',
                            logo: null,
                            logoTipo: 'emoji',
                            emoji: 'üßÅ',
                            tema: 'rosa',
                            coresPersonalizadas: {
                                primaria: '#ec4899',
                                secundaria: '#a855f7',
                                ativo: false
                            },
                            modoEscuro: false,
                            transparencia: 1,
                            padrao: 'padrao',
                            fundoPersonalizado: null
                        };

                        // Limpar localStorage
                        localStorage.removeItem('personalizacao');

                        // Aplicar configura√ß√µes padr√£o
                        aplicarPersonalizacao();

                        alert('‚úÖ Configura√ß√µes restauradas para o padr√£o!\n\nTodas as personaliza√ß√µes foram removidas.');
                    }
                }

                function previewPersonalizacao() {
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">üëÅÔ∏è Preview da Personaliza√ß√£o</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-3">üìã Configura√ß√µes Atuais</h4>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div><strong>Nome:</strong> ${personalizacao.nomeEmpresa}</div>
                                <div><strong>Logo:</strong> ${personalizacao.logoTipo === 'imagem' ? 'Imagem personalizada' : personalizacao.emoji}</div>
                                <div><strong>Tema:</strong> ${personalizacao.tema.charAt(0).toUpperCase() + personalizacao.tema.slice(1)}</div>
                                <div><strong>Modo Escuro:</strong> ${personalizacao.modoEscuro ? 'Ativado' : 'Desativado'}</div>
                                <div><strong>Transpar√™ncia:</strong> ${Math.round(personalizacao.transparencia * 100)}%</div>
                                <div><strong>Padr√£o:</strong> ${personalizacao.padrao.charAt(0).toUpperCase() + personalizacao.padrao.slice(1)}</div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2">üí° Dicas de Personaliza√ß√£o</h4>
                            <ul class="text-blue-700 text-sm space-y-1">
                                <li>‚Ä¢ Use logos em formato PNG para melhor qualidade</li>
                                <li>‚Ä¢ O modo escuro reduz o cansa√ßo visual</li>
                                <li>‚Ä¢ Padr√µes sutis melhoram a legibilidade</li>
                                <li>‚Ä¢ Salve suas configura√ß√µes regularmente</li>
                            </ul>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-lg transition-colors">
                                Fechar
                            </button>
                            <button onclick="salvarPersonalizacao(); this.closest('.fixed').remove()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg transition-colors">
                                üíæ Salvar e Fechar
                            </button>
                        </div>
                    </div>
                </div>
            `;

                    document.body.appendChild(modal);
                }

                function atualizarStatusPersonalizacao() {
                    const status = document.getElementById('statusPersonalizacao');
                    const ultima = document.getElementById('ultimaPersonalizacao');

                    let modificacoes = 0;
                    if (personalizacao.nomeEmpresa !== 'Doce Controle') modificacoes++;
                    if (personalizacao.logoTipo === 'imagem') modificacoes++;
                    if (personalizacao.emoji !== 'üßÅ') modificacoes++;
                    if (personalizacao.tema !== 'rosa' || personalizacao.coresPersonalizadas.ativo) modificacoes++;
                    if (personalizacao.coresPersonalizadas.ativo) modificacoes++;
                    if (personalizacao.modoEscuro) modificacoes++;
                    if (personalizacao.transparencia !== 1) modificacoes++;
                    if (personalizacao.padrao !== 'padrao') modificacoes++;
                    if (personalizacao.fundoPersonalizado) modificacoes++;

                    if (modificacoes === 0) {
                        status.textContent = 'Configura√ß√µes padr√£o ativas';
                    } else {
                        status.textContent = `${modificacoes} personaliza√ß√£o(√µes) ativa(s)`;
                    }

                    ultima.textContent = new Date().toLocaleString('pt-BR');
                }

                // Fun√ß√µes auxiliares
                function editarProduto(id) {
                    alert('Fun√ß√£o de edi√ß√£o em desenvolvimento!');
                }

                function excluirProduto(id) {
                    if (confirm('Tem certeza que deseja excluir este produto?')) {
                        produtos = produtos.filter(p => p.id !== id);
                        salvarDados();
                        atualizarDashboard();
                        alert('‚úÖ Produto exclu√≠do com sucesso!');
                    }
                }

                function editarReceita(id) {
                    const receita = receitas.find(r => r.id === id);
                    if (!receita) return;

                    // Abrir modal primeiro para evitar limpar os campos depois
                    openModal('modalReceita');

                    // Definir que estamos editando
                    receitaEditando = id;

                    // Atualizar t√≠tulo do modal
                    document.getElementById('tituloModalReceita').textContent = 'Editar Receita';
                    document.getElementById('btnSalvarReceita').textContent = 'Atualizar Receita';

                    // Preencher campos b√°sicos
                    document.getElementById('nomeReceita').value = receita.nome;
                    document.getElementById('rendimentoReceita').value = receita.rendimento;
                    document.getElementById('modoPreparoReceita').value = receita.modoPreparo || '';
                    document.getElementById('margemLucro').value = receita.margemLucro || 200;
                    document.getElementById('meuPreco').value = receita.precoVenda || '';

                    // Limpar ingredientes existentes
                    const container = document.getElementById('ingredientesReceita');
                    container.innerHTML = '';

                    // Adicionar ingredientes da receita
                    receita.ingredientes.forEach((ingrediente, index) => {
                        const newRow = document.createElement('div');
                        newRow.className = 'flex space-x-2 ingrediente-row';
                        newRow.innerHTML = `
                    <select class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ingrediente-select" onchange="calcularCustoReceita()">
                        <option value="">Selecione um ingrediente</option>
                    </select>
                    <input type="number" placeholder="Qtd" min="0.01" step="0.01" class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent quantidade-ingrediente" onchange="calcularCustoReceita()">
                    <button type="button" onclick="removerIngrediente(this)" class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">üóëÔ∏è</button>
                `;
                        container.appendChild(newRow);

                        // Preencher select com produtos
                        const select = newRow.querySelector('.ingrediente-select');
                        const quantidadeInput = newRow.querySelector('.quantidade-ingrediente');

                        produtos.forEach(produto => {
                            const option = document.createElement('option');
                            option.value = produto.id;
                            option.textContent = `${produto.nome} (${produto.unidade})`;
                            if (produto.id === ingrediente.produtoId) {
                                option.selected = true;
                            }
                            select.appendChild(option);
                        });

                        quantidadeInput.value = ingrediente.quantidade;
                    });

                    // Calcular custos
                    setTimeout(() => {
                        calcularCustoReceita();
                    }, 100);
                }

                function excluirReceita(id) {
                    if (confirm('Tem certeza que deseja excluir esta receita?')) {
                        receitas = receitas.filter(r => r.id !== id);
                        salvarDados();
                        atualizarReceitas();
                        alert('‚úÖ Receita exclu√≠da com sucesso!');
                    }
                }

                function verDetalhesVenda(id) {
                    const venda = vendas.find(v => v.id === id);
                    if (venda) {
                        const detalhes = venda.itens.map(item =>
                            `${item.receita}: ${item.quantidade}x R$ ${item.preco.toFixed(2)} = R$ ${item.total.toFixed(2)}`
                        ).join('\n');

                        alert(`Detalhes da Venda #${id}\n\nCliente: ${venda.cliente}\nData: ${new Date(venda.data).toLocaleDateString('pt-BR')}\n\nItens:\n${detalhes}\n\nTotal: R$ ${venda.totalPedido.toFixed(2)}\nLucro: R$ ${venda.lucroTotal.toFixed(2)}`);
                    }
                }

                function excluirVenda(id) {
                    if (confirm('Tem certeza que deseja excluir esta venda?')) {
                        vendas = vendas.filter(v => v.id !== id);
                        salvarDados();
                        atualizarVendas();
                        alert('‚úÖ Venda exclu√≠da com sucesso!');
                    }
                }

                // Fun√ß√µes de configura√ß√£o
                function salvarLimites() {
                    // Atualizar limites nas configura√ß√µes
                    const unidades = ['kg', 'g', 'L', 'ml', 'un', 'cx', 'pct'];

                    unidades.forEach(unidade => {
                        const minInput = document.getElementById(`limite-${unidade}-min`);
                        const maxInput = document.getElementById(`limite-${unidade}-max`);

                        if (minInput && maxInput) {
                            configuracoes.limites[unidade] = {
                                min: parseFloat(minInput.value) || 0,
                                max: parseFloat(maxInput.value) || 0
                            };
                        }
                    });

                    // Atualizar resumo
                    atualizarResumoLimites();

                    // Atualizar dashboard se estiver vis√≠vel
                    if (!document.getElementById('dashboard').classList.contains('hidden')) {
                        atualizarDashboard();
                    }

                    // Salvar no localStorage
                    localStorage.setItem('configuracoes', JSON.stringify(configuracoes));
                }

                function atualizarResumoLimites() {
                    const container = document.getElementById('resumoLimites');
                    container.innerHTML = '';

                    Object.entries(configuracoes.limites).forEach(([unidade, limites]) => {
                        const div = document.createElement('div');
                        div.className = 'bg-white rounded-lg p-3 text-center border border-purple-200';
                        div.innerHTML = `
                    <div class="font-bold text-purple-800">${unidade}</div>
                    <div class="text-xs text-purple-600">Min: ${limites.min}</div>
                    <div class="text-xs text-purple-600">Max: ${limites.max}</div>
                `;
                        container.appendChild(div);
                    });
                }

                function restaurarPadroes() {
                    if (confirm('Tem certeza que deseja restaurar os limites padr√£o? Esta a√ß√£o n√£o pode ser desfeita.')) {
                        // Restaurar valores padr√£o
                        configuracoes.limites = {
                            'kg': { min: 1, max: 10 },
                            'g': { min: 100, max: 1000 },
                            'L': { min: 1, max: 10 },
                            'ml': { min: 100, max: 1000 },
                            'un': { min: 5, max: 50 },
                            'cx': { min: 2, max: 20 },
                            'pct': { min: 3, max: 30 }
                        };

                        // Atualizar inputs
                        Object.entries(configuracoes.limites).forEach(([unidade, limites]) => {
                            const minInput = document.getElementById(`limite-${unidade}-min`);
                            const maxInput = document.getElementById(`limite-${unidade}-max`);

                            if (minInput && maxInput) {
                                minInput.value = limites.min;
                                maxInput.value = limites.max;
                            }
                        });

                        // Atualizar resumo
                        atualizarResumoLimites();

                        // Salvar
                        localStorage.setItem('configuracoes', JSON.stringify(configuracoes));

                        alert('‚úÖ Limites restaurados para os valores padr√£o!');
                    }
                }

                function salvarConfiguracoes() {
                    // Atualizar notifica√ß√µes
                    configuracoes.notificacoes.estoqueBaixo = document.getElementById('notificarEstoqueBaixo').checked;
                    configuracoes.notificacoes.vencimento = document.getElementById('notificarVencimento').checked;
                    configuracoes.notificacoes.whatsapp = document.getElementById('notificarWhatsApp').checked;
                    configuracoes.notificacoes.automatica = document.getElementById('notificacaoAutomatica')?.checked || false;
                    configuracoes.notificacoes.diasAntecedencia = parseInt(document.getElementById('diasAntecedencia').value) || 7;

                    // Atualizar contatos
                    configuracoes.contato.whatsapp = document.getElementById('whatsappContato')?.value || '';
                    configuracoes.contato.email = document.getElementById('emailContato')?.value || '';

                    // Atualizar moeda
                    configuracoes.moeda = document.getElementById('moeda').value;

                    // Mostrar/esconder configura√ß√µes de contato
                    const configContato = document.getElementById('configContato');
                    if (configuracoes.notificacoes.whatsapp) {
                        configContato.classList.remove('hidden');
                    } else {
                        configContato.classList.add('hidden');
                    }

                    // Configurar notifica√ß√£o autom√°tica
                    configurarNotificacaoAutomatica();

                    // Salvar no localStorage
                    localStorage.setItem('configuracoes', JSON.stringify(configuracoes));
                }

                function carregarConfiguracoes() {
                    // Carregar do localStorage
                    const configSalvas = localStorage.getItem('configuracoes');
                    if (configSalvas) {
                        configuracoes = { ...configuracoes, ...JSON.parse(configSalvas) };
                    }

                    // Aplicar aos inputs
                    Object.entries(configuracoes.limites).forEach(([unidade, limites]) => {
                        const minInput = document.getElementById(`limite-${unidade}-min`);
                        const maxInput = document.getElementById(`limite-${unidade}-max`);

                        if (minInput && maxInput) {
                            minInput.value = limites.min;
                            maxInput.value = limites.max;
                        }
                    });

                    // Aplicar notifica√ß√µes
                    document.getElementById('notificarEstoqueBaixo').checked = configuracoes.notificacoes.estoqueBaixo;
                    document.getElementById('notificarVencimento').checked = configuracoes.notificacoes.vencimento;
                    document.getElementById('notificarWhatsApp').checked = configuracoes.notificacoes.whatsapp;
                    if (document.getElementById('notificacaoAutomatica')) {
                        document.getElementById('notificacaoAutomatica').checked = configuracoes.notificacoes.automatica;
                    }
                    document.getElementById('diasAntecedencia').value = configuracoes.notificacoes.diasAntecedencia;

                    // Aplicar contatos
                    if (document.getElementById('whatsappContato')) {
                        document.getElementById('whatsappContato').value = configuracoes.contato.whatsapp;
                    }
                    if (document.getElementById('emailContato')) {
                        document.getElementById('emailContato').value = configuracoes.contato.email;
                    }

                    // Aplicar moeda
                    document.getElementById('moeda').value = configuracoes.moeda;

                    // Atualizar resumo
                    atualizarResumoLimites();

                    // Configurar visibilidade de contatos
                    salvarConfiguracoes();
                }

                function exportarBackup() {
                    const backup = {
                        produtos,
                        receitas,
                        vendas,
                        configuracoes,
                        categorias,
                        versao: '1.0',
                        dataExportacao: new Date().toISOString()
                    };

                    const dataStr = JSON.stringify(backup, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });

                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(dataBlob);
                    link.download = `backup_doce_controle_${new Date().toISOString().split('T')[0]}.json`;
                    link.click();

                    alert('‚úÖ Backup exportado com sucesso!\n\nüìÅ Arquivo salvo como: ' + link.download);
                }

                function importarBackup() {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';

                    input.onchange = function (event) {
                        const file = event.target.files[0];
                        if (!file) return;

                        const reader = new FileReader();
                        reader.onload = function (e) {
                            try {
                                const backup = JSON.parse(e.target.result);

                                // Validar estrutura do backup
                                if (!backup.produtos || !backup.receitas || !backup.vendas) {
                                    throw new Error('Arquivo de backup inv√°lido');
                                }

                                const confirmacao = confirm(
                                    `Confirma a importa√ß√£o do backup?\n\n` +
                                    `üì¶ ${backup.produtos.length} produtos\n` +
                                    `üìù ${backup.receitas.length} receitas\n` +
                                    `üí∞ ${backup.vendas.length} vendas\n` +
                                    `üìÖ Exportado em: ${new Date(backup.dataExportacao).toLocaleDateString('pt-BR')}\n\n` +
                                    `‚ö†Ô∏è ATEN√á√ÉO: Todos os dados atuais ser√£o substitu√≠dos!`
                                );

                                if (confirmacao) {
                                    // Restaurar dados
                                    produtos = backup.produtos || [];
                                    receitas = backup.receitas || [];
                                    vendas = backup.vendas || [];
                                    configuracoes = { ...configuracoes, ...(backup.configuracoes || {}) };
                                    categorias = backup.categorias || categorias;

                                    // Atualizar IDs
                                    proximoIdProduto = Math.max(...produtos.map(p => p.id), 0) + 1;
                                    proximoIdReceita = Math.max(...receitas.map(r => r.id), 0) + 1;
                                    proximoIdVenda = Math.max(...vendas.map(v => v.id), 0) + 1;

                                    // Salvar no localStorage
                                    localStorage.setItem('configuracoes', JSON.stringify(configuracoes));

                                    // Recarregar configura√ß√µes
                                    carregarConfiguracoes();

                                    // Atualizar todas as se√ß√µes
                                    atualizarDashboard();
                                    atualizarReceitas();
                                    atualizarVendas();
                                    atualizarEstatisticasCategorias();

                                    alert('‚úÖ Backup importado com sucesso!\n\nTodos os dados foram restaurados.');
                                }

                            } catch (error) {
                                alert('‚ùå Erro ao importar backup: ' + error.message);
                            }
                        };
                        reader.readAsText(file);
                    };

                    input.click();
                }

                function adicionarCategoria() {
                    const input = document.getElementById('novaCategoria');
                    const nome = input.value.trim();

                    if (!nome) {
                        alert('‚ö†Ô∏è Por favor, digite o nome da categoria!');
                        return;
                    }

                    if (categorias.includes(nome)) {
                        alert('‚ö†Ô∏è Esta categoria j√° existe!');
                        return;
                    }

                    categorias.push(nome);
                    input.value = '';

                    // Salvar dados
                    salvarDados();

                    // Atualizar lista visual
                    atualizarListaCategorias();

                    // Atualizar selects de categoria
                    atualizarSelectsCategorias();

                    // Atualizar estat√≠sticas
                    atualizarEstatisticasCategorias();

                    alert('‚úÖ Categoria adicionada com sucesso!');
                }

                function removerCategoria(nome) {
                    // Verificar se h√° produtos usando esta categoria
                    const produtosCategoria = produtos.filter(p => p.categoria === nome);

                    if (produtosCategoria.length > 0) {
                        const confirmacao = confirm(
                            `A categoria "${nome}" est√° sendo usada por ${produtosCategoria.length} produto(s).\n\n` +
                            `Se voc√™ remover esta categoria, estes produtos ficar√£o sem categoria.\n\n` +
                            `Deseja continuar?`
                        );

                        if (!confirmacao) return;

                        // Remover categoria dos produtos
                        produtos.forEach(produto => {
                            if (produto.categoria === nome) {
                                produto.categoria = 'Sem Categoria';
                            }
                        });
                    }

                    // Remover categoria da lista
                    const index = categorias.indexOf(nome);
                    if (index > -1) {
                        categorias.splice(index, 1);
                    }

                    // Atualizar lista visual
                    atualizarListaCategorias();

                    // Atualizar selects de categoria
                    atualizarSelectsCategorias();

                    // Atualizar estat√≠sticas
                    atualizarEstatisticasCategorias();

                    // Atualizar dashboard se necess√°rio
                    if (produtosCategoria.length > 0) {
                        atualizarDashboard();
                    }

                    alert('‚úÖ Categoria removida com sucesso!');
                }

                function atualizarListaCategorias() {
                    const container = document.getElementById('listaCategorias');
                    container.innerHTML = '';

                    categorias.forEach(categoria => {
                        const div = document.createElement('div');
                        div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                        div.innerHTML = `
                    <span class="font-medium categoria-nome" data-categoria="${categoria}">${categoria}</span>
                    <div class="flex space-x-2">
                        <button onclick="editarCategoria('${categoria}')" class="text-blue-500 hover:text-blue-700" title="Editar categoria">‚úèÔ∏è</button>
                        <button onclick="removerCategoria('${categoria}')" class="text-red-500 hover:text-red-700" title="Excluir categoria">üóëÔ∏è</button>
                    </div>
                `;
                        container.appendChild(div);
                    });
                }

                function editarCategoria(categoriaAntiga) {
                    const novoNome = prompt(`Editar categoria:\n\nNome atual: ${categoriaAntiga}\n\nDigite o novo nome:`, categoriaAntiga);

                    if (!novoNome || novoNome.trim() === '') {
                        return;
                    }

                    const nomeFormatado = novoNome.trim();

                    if (nomeFormatado === categoriaAntiga) {
                        return; // N√£o houve mudan√ßa
                    }

                    if (categorias.includes(nomeFormatado)) {
                        alert('‚ö†Ô∏è J√° existe uma categoria com este nome!');
                        return;
                    }

                    // Atualizar categoria na lista
                    const index = categorias.indexOf(categoriaAntiga);
                    if (index > -1) {
                        categorias[index] = nomeFormatado;
                    }

                    // Atualizar produtos que usam esta categoria
                    produtos.forEach(produto => {
                        if (produto.categoria === categoriaAntiga) {
                            produto.categoria = nomeFormatado;
                        }
                    });

                    // Atualizar interface
                    atualizarListaCategorias();
                    atualizarSelectsCategorias();
                    atualizarEstatisticasCategorias();

                    // Atualizar dashboard se necess√°rio
                    if (!document.getElementById('dashboard').classList.contains('hidden')) {
                        atualizarDashboard();
                    }

                    alert('‚úÖ Categoria atualizada com sucesso!');
                }

                function atualizarSelectsCategorias() {
                    // Atualizar todos os selects de categoria no sistema
                    const selects = document.querySelectorAll('#categoriaItemDash, #filtroCategoria');

                    selects.forEach(select => {
                        const valorAtual = select.value;

                        // Limpar op√ß√µes (exceto a primeira)
                        while (select.children.length > 1) {
                            select.removeChild(select.lastChild);
                        }

                        // Adicionar categorias
                        categorias.forEach(categoria => {
                            const option = document.createElement('option');
                            option.value = categoria;
                            option.textContent = categoria;
                            select.appendChild(option);
                        });

                        // Restaurar valor se ainda existir
                        if (categorias.includes(valorAtual)) {
                            select.value = valorAtual;
                        }
                    });
                }

                function atualizarEstatisticasCategorias() {
                    const container = document.getElementById('estatisticasCategorias');
                    container.innerHTML = '';

                    // Calcular estat√≠sticas por categoria
                    const stats = {};

                    categorias.forEach(categoria => {
                        const produtosCategoria = produtos.filter(p => p.categoria === categoria);
                        const valorTotal = produtosCategoria.reduce((sum, p) => sum + (p.quantidade * p.preco), 0);

                        stats[categoria] = {
                            produtos: produtosCategoria.length,
                            valor: valorTotal
                        };
                    });

                    // Produtos sem categoria
                    const produtosSemCategoria = produtos.filter(p => !categorias.includes(p.categoria));
                    if (produtosSemCategoria.length > 0) {
                        const valorSemCategoria = produtosSemCategoria.reduce((sum, p) => sum + (p.quantidade * p.preco), 0);
                        stats['Sem Categoria'] = {
                            produtos: produtosSemCategoria.length,
                            valor: valorSemCategoria
                        };
                    }

                    // Exibir estat√≠sticas
                    Object.entries(stats).forEach(([categoria, dados]) => {
                        const div = document.createElement('div');
                        div.className = 'flex justify-between items-center';
                        div.innerHTML = `
                    <span class="text-gray-700">${categoria}:</span>
                    <span class="font-medium">${dados.produtos} itens (R$ ${dados.valor.toFixed(2)})</span>
                `;
                        container.appendChild(div);
                    });

                    if (Object.keys(stats).length === 0) {
                        container.innerHTML = '<p class="text-gray-500 text-center">Nenhuma categoria com produtos</p>';
                    }
                }

                // Vari√°veis do scanner
                let scannerAtivo = false;
                let inputAtual = null;
                let codigoDetectado = null;
                let streamAtivo = null;

                // Fun√ß√£o para iniciar scanner
                function iniciarScanner(inputId) {
                    // Parar qualquer scanner anterior primeiro
                    pararScannerInterno();

                    inputAtual = inputId;

                    // Verificar se Quagga est√° dispon√≠vel
                    if (typeof Quagga === 'undefined') {
                        alert('‚ùå Biblioteca de scanner n√£o carregada!\n\nPor favor, digite o c√≥digo manualmente.');
                        return;
                    }

                    // Verificar se o navegador suporta getUserMedia
                    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                        alert('‚ùå Seu navegador n√£o suporta acesso √† c√¢mera!\n\nPor favor, digite o c√≥digo manualmente.');
                        return;
                    }

                    openModal('modalScanner');

                    // Limpar estado anterior
                    document.getElementById('resultado-scanner').classList.add('hidden');
                    document.getElementById('btnUsarCodigo').disabled = true;
                    document.getElementById('btnUsarCodigo').classList.add('opacity-50', 'cursor-not-allowed');
                    codigoDetectado = null;

                    // Aguardar um pouco para o modal aparecer
                    setTimeout(() => {
                        // Verificar se o modal ainda est√° aberto antes de iniciar
                        const modal = document.getElementById('modalScanner');
                        if (modal && !modal.classList.contains('hidden')) {
                            inicializarQuagga();
                        }
                    }, 300);
                }

                function inicializarQuagga() {
                    // Configurar Quagga
                    Quagga.init({
                        inputStream: {
                            name: "Live",
                            type: "LiveStream",
                            target: document.querySelector('#interactive'),
                            constraints: {
                                width: { min: 320, ideal: 640, max: 1280 },
                                height: { min: 240, ideal: 480, max: 720 },
                                facingMode: "environment"
                            }
                        },
                        locator: {
                            patchSize: "medium",
                            halfSample: true
                        },
                        numOfWorkers: 2,
                        frequency: 10,
                        decoder: {
                            readers: [
                                "code_128_reader",
                                "ean_reader",
                                "ean_8_reader",
                                "code_39_reader",
                                "upc_reader",
                                "upc_e_reader"
                            ]
                        },
                        locate: true
                    }, function (err) {
                        if (err) {
                            console.error('Erro ao inicializar Quagga:', err);
                            handleScannerError(err);
                            return;
                        }

                        console.log("‚úÖ Scanner inicializado com sucesso");

                        try {
                            Quagga.start();
                            scannerAtivo = true;

                            // Configurar listener para detec√ß√£o
                            Quagga.onDetected(onBarcodeDetected);

                        } catch (startErr) {
                            console.error('Erro ao iniciar scanner:', startErr);
                            handleScannerError(startErr);
                        }
                    });
                }

                function onBarcodeDetected(result) {
                    if (!scannerAtivo) return;

                    const codigo = result.codeResult.code;
                    console.log("üì∑ C√≥digo detectado:", codigo);

                    // Validar c√≥digo (deve ter pelo menos 6 caracteres)
                    if (codigo && codigo.length >= 6) {
                        // Verificar se n√£o √© um c√≥digo duplicado muito rapidamente
                        if (codigoDetectado === codigo) return;

                        // Limpar c√≥digo (remover espa√ßos e caracteres especiais desnecess√°rios)
                        const codigoLimpo = codigo.trim().replace(/[^\w\d]/g, '');
                        codigoDetectado = codigoLimpo;

                        // Mostrar resultado
                        document.getElementById('codigo-detectado').textContent = codigoLimpo;
                        document.getElementById('resultado-scanner').classList.remove('hidden');

                        // Habilitar bot√£o
                        document.getElementById('btnUsarCodigo').disabled = false;
                        document.getElementById('btnUsarCodigo').classList.remove('opacity-50', 'cursor-not-allowed');

                        // Parar scanner ap√≥s detec√ß√£o bem-sucedida
                        setTimeout(() => {
                            if (scannerAtivo) {
                                pararScannerInterno();
                            }
                        }, 500);

                        // Feedback sonoro e visual
                        try {
                            // Som de sucesso
                            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                            const oscillator = audioContext.createOscillator();
                            const gainNode = audioContext.createGain();

                            oscillator.connect(gainNode);
                            gainNode.connect(audioContext.destination);

                            oscillator.frequency.value = 800;
                            gainNode.gain.value = 0.1;

                            oscillator.start();
                            oscillator.stop(audioContext.currentTime + 0.2);
                        } catch (e) {
                            // Ignorar erro de √°udio
                        }

                        // Feedback visual
                        const container = document.getElementById('scanner-container');
                        container.style.border = '3px solid #10B981';
                        setTimeout(() => {
                            container.style.border = '';
                        }, 1000);
                    }
                }

                function handleScannerError(err) {
                    let mensagemErro = '‚ùå Erro ao acessar a c√¢mera!\n\n';

                    if (err.name === 'NotAllowedError' || err.message.includes('Permission')) {
                        mensagemErro += 'Permiss√£o para usar a c√¢mera foi negada.\n\n';
                        mensagemErro += 'Para usar o scanner:\n';
                        mensagemErro += '1. Clique no √≠cone de c√¢mera na barra de endere√ßos\n';
                        mensagemErro += '2. Selecione "Permitir"\n';
                        mensagemErro += '3. Recarregue a p√°gina e tente novamente\n\n';
                    } else if (err.name === 'NotFoundError' || err.message.includes('camera')) {
                        mensagemErro += 'Nenhuma c√¢mera foi encontrada no dispositivo.\n\n';
                    } else if (err.name === 'NotReadableError' || err.message.includes('use')) {
                        mensagemErro += 'A c√¢mera est√° sendo usada por outro aplicativo.\n';
                        mensagemErro += 'Feche outros aplicativos que possam estar usando a c√¢mera.\n\n';
                    } else if (err.name === 'OverconstrainedError') {
                        mensagemErro += 'As configura√ß√µes da c√¢mera n√£o s√£o suportadas.\n\n';
                    } else {
                        mensagemErro += 'Erro t√©cnico: ' + (err.message || err.name || 'Desconhecido') + '\n\n';
                    }

                    mensagemErro += 'Voc√™ pode digitar o c√≥digo de barras manualmente.';
                    alert(mensagemErro);
                    closeModal('modalScanner');
                }

                function pararScannerInterno() {
                    try {
                        if (scannerAtivo) {
                            Quagga.stop();
                            scannerAtivo = false;
                            console.log("üõë Scanner parado");
                        }

                        // Remover listener para evitar m√∫ltiplas chamadas
                        Quagga.offDetected(onBarcodeDetected);

                        // Limpar container visual para evitar duplica√ß√£o de v√≠deo
                        const container = document.querySelector('#interactive');
                        if (container) {
                            container.innerHTML = '';
                        }
                    } catch (e) {
                        console.error('Erro ao parar scanner:', e);
                        // For√ßar limpeza mesmo com erro
                        const container = document.querySelector('#interactive');
                        if (container) {
                            container.innerHTML = '';
                        }
                    }
                }

                // Fun√ß√£o para parar scanner
                function pararScanner() {
                    pararScannerInterno();
                    closeModal('modalScanner');
                    inputAtual = null;
                    codigoDetectado = null;
                }

                // Fun√ß√£o para usar c√≥digo detectado
                function usarCodigoDetectado() {
                    if (codigoDetectado && inputAtual) {
                        document.getElementById(inputAtual).value = codigoDetectado;

                        // Verificar se √© √∫nico
                        verificarCodigoBarrasUnico(inputAtual, inputAtual.includes('Dash') ? 'dashboard' : 'modal');

                        pararScanner();
                        alert('‚úÖ C√≥digo de barras adicionado com sucesso!');
                    }
                }

                function verificarCodigoBarrasUnico(inputId, contexto) {
                    // Fun√ß√£o para verificar se c√≥digo de barras j√° existe
                    const codigo = document.getElementById(inputId).value;
                    if (codigo) {
                        const existe = produtos.some(p => p.codigoBarras === codigo);
                        const alertaId = contexto === 'dashboard' ? 'alertaCodigoDash' : 'alertaCodigoModal';
                        const alerta = document.getElementById(alertaId);

                        if (existe) {
                            alerta.classList.remove('hidden');
                        } else {
                            alerta.classList.add('hidden');
                        }
                    }
                }

                // Fechar menu de exporta√ß√£o ao clicar fora
                document.addEventListener('click', function (event) {
                    const exportMenu = document.getElementById('exportMenu');
                    const exportButton = event.target.closest('.mobile-export');

                    if (!exportButton && !exportMenu.contains(event.target)) {
                        exportMenu.classList.add('hidden');
                    }
                });

                // Fun√ß√£o de importa√ß√£o de carga r√°pida
                function importarCargaRapida() {
                    const cargasDisponiveis = [
                        {
                            nome: "Carga B√°sica de Confeitaria",
                            descricao: "Ingredientes essenciais para confeitaria",
                            itens: [
                                { nome: "Farinha de Trigo Especial", categoria: "Ingredientes B√°sicos", quantidade: 10, unidade: "kg", preco: 4.80, marca: "Dona Benta" },
                                { nome: "A√ß√∫car Refinado", categoria: "Ingredientes B√°sicos", quantidade: 5, unidade: "kg", preco: 3.50, marca: "Uni√£o" },
                                { nome: "Ovos Grandes", categoria: "Ingredientes B√°sicos", quantidade: 60, unidade: "un", preco: 0.50, marca: "Korin" },
                                { nome: "Manteiga sem Sal", categoria: "Latic√≠nios", quantidade: 2, unidade: "kg", preco: 26.00, marca: "Presidente" },
                                { nome: "Leite Integral", categoria: "Latic√≠nios", quantidade: 4, unidade: "L", preco: 4.20, marca: "Parmalat" },
                                { nome: "Chocolate em P√≥", categoria: "Ingredientes B√°sicos", quantidade: 1, unidade: "kg", preco: 22.00, marca: "Nestl√©" },
                                { nome: "Fermento em P√≥", categoria: "Ingredientes B√°sicos", quantidade: 500, unidade: "g", preco: 8.50, marca: "Royal" },
                                { nome: "Ess√™ncia de Baunilha", categoria: "Ingredientes B√°sicos", quantidade: 100, unidade: "ml", preco: 12.00, marca: "Arcolor" }
                            ]
                        },
                        {
                            nome: "Carga Premium de Chocolateria",
                            descricao: "Ingredientes especiais para chocolates gourmet",
                            itens: [
                                { nome: "Chocolate Meio Amargo 70%", categoria: "Ingredientes B√°sicos", quantidade: 2, unidade: "kg", preco: 45.00, marca: "Callebaut" },
                                { nome: "Cacau em P√≥ Alcalino", categoria: "Ingredientes B√°sicos", quantidade: 500, unidade: "g", preco: 28.00, marca: "Garoto" },
                                { nome: "Creme de Leite Fresco", categoria: "Latic√≠nios", quantidade: 2, unidade: "L", preco: 8.50, marca: "Nestl√©" },
                                { nome: "Glucose de Milho", categoria: "Ingredientes B√°sicos", quantidade: 1, unidade: "kg", preco: 15.00, marca: "Karo" },
                                { nome: "Manteiga de Cacau", categoria: "Ingredientes B√°sicos", quantidade: 500, unidade: "g", preco: 35.00, marca: "Sicao" },
                                { nome: "Leite Condensado", categoria: "Latic√≠nios", quantidade: 6, unidade: "un", preco: 4.80, marca: "Mo√ßa" },
                                { nome: "Castanha do Par√°", categoria: "Frutas", quantidade: 500, unidade: "g", preco: 18.00, marca: "Nutty" }
                            ]
                        },
                        {
                            nome: "Carga de Embalagens e Decora√ß√£o",
                            descricao: "Materiais para apresenta√ß√£o e decora√ß√£o",
                            itens: [
                                { nome: "Forminhas de Papel", categoria: "Embalagens", quantidade: 500, unidade: "un", preco: 0.08, marca: "Plumrose" },
                                { nome: "Caixas para Bolo", categoria: "Embalagens", quantidade: 50, unidade: "un", preco: 2.50, marca: "Della Fonte" },
                                { nome: "Papel Manteiga", categoria: "Embalagens", quantidade: 5, unidade: "un", preco: 3.20, marca: "Wyda" },
                                { nome: "Confeitos Coloridos", categoria: "Decora√ß√£o", quantidade: 200, unidade: "g", preco: 12.00, marca: "Maval√©rio" },
                                { nome: "Chantilly em P√≥", categoria: "Decora√ß√£o", quantidade: 1, unidade: "kg", preco: 18.50, marca: "Am√©lia" },
                                { nome: "Corante Aliment√≠cio", categoria: "Decora√ß√£o", quantidade: 50, unidade: "ml", preco: 6.80, marca: "Arcolor" },
                                { nome: "A√ß√∫car de Confeiteiro", categoria: "Decora√ß√£o", quantidade: 1, unidade: "kg", preco: 8.90, marca: "Uni√£o" }
                            ]
                        }
                    ];

                    let opcoes = "Selecione uma carga para importar:\n\n";
                    cargasDisponiveis.forEach((carga, index) => {
                        opcoes += `${index + 1}. ${carga.nome}\n   ${carga.descricao} (${carga.itens.length} itens)\n\n`;
                    });

                    const escolha = prompt(opcoes + "Digite o n√∫mero da carga desejada:");

                    if (escolha && !isNaN(escolha)) {
                        const indice = parseInt(escolha) - 1;
                        if (indice >= 0 && indice < cargasDisponiveis.length) {
                            const cargaSelecionada = cargasDisponiveis[indice];

                            const confirmacao = confirm(
                                `Confirma a importa√ß√£o da "${cargaSelecionada.nome}"?\n\n` +
                                `${cargaSelecionada.descricao}\n` +
                                `Total de ${cargaSelecionada.itens.length} itens\n\n` +
                                `Os produtos existentes ser√£o atualizados e novos produtos ser√£o adicionados.`
                            );

                            if (confirmacao) {
                                let adicionados = 0;
                                let atualizados = 0;

                                cargaSelecionada.itens.forEach(item => {
                                    // Verificar se produto j√° existe
                                    const produtoExistente = produtos.find(p =>
                                        p.nome.toLowerCase() === item.nome.toLowerCase()
                                    );

                                    if (produtoExistente) {
                                        // Atualizar produto existente
                                        produtoExistente.categoria = item.categoria;
                                        produtoExistente.quantidade += item.quantidade; // Somar quantidades
                                        produtoExistente.unidade = item.unidade;
                                        produtoExistente.preco = item.preco;
                                        produtoExistente.marca = item.marca;
                                        atualizados++;
                                    } else {
                                        // Adicionar novo produto
                                        const novoProduto = {
                                            id: proximoIdProduto++,
                                            nome: item.nome,
                                            categoria: item.categoria,
                                            quantidade: item.quantidade,
                                            unidade: item.unidade,
                                            preco: item.preco,
                                            validade: null,
                                            marca: item.marca,
                                            codigoBarras: ''
                                        };
                                        produtos.push(novoProduto);
                                        adicionados++;
                                    }
                                });

                                // Atualizar dashboard
                                atualizarDashboard();

                                // Mostrar resultado
                                alert(
                                    `‚úÖ Carga "${cargaSelecionada.nome}" importada com sucesso!\n\n` +
                                    `üì¶ ${adicionados} novos produtos adicionados\n` +
                                    `üîÑ ${atualizados} produtos existentes atualizados\n\n` +
                                    `Total processado: ${adicionados + atualizados} itens`
                                );
                            }
                        } else {
                            alert('‚ùå Op√ß√£o inv√°lida!');
                        }
                    }
                }

                // Fun√ß√µes de importa√ß√£o de receitas
                function baixarTemplateReceitas() {
                    // Criar template Excel para receitas
                    const wb = XLSX.utils.book_new();
                    const templateData = [
                        ['nome', 'rendimento', 'ingredientes', 'modo_preparo', 'margem_lucro'],
                        ['Bolo de Chocolate', '12', 'Farinha de Trigo:0.5:kg;A√ß√∫car Cristal:0.3:kg;Ovos:4:un;Cacau em P√≥:0.1:kg', 'Misture todos os ingredientes secos, adicione os ovos e bata bem. Asse por 40 minutos a 180¬∞C.', '200'],
                        ['Brigadeiro Gourmet', '30', 'Leite Condensado:1:un;Chocolate em P√≥:0.05:kg;Manteiga:0.02:kg', 'Misture todos os ingredientes em fogo baixo at√© desgrudar da panela. Deixe esfriar e fa√ßa bolinhas.', '300'],
                        ['Torta de Lim√£o', '8', 'Biscoito Maisena:0.2:kg;Manteiga:0.1:kg;Leite Condensado:1:un;Lim√£o:5:un', 'Fa√ßa a base com biscoito e manteiga. Prepare o recheio com leite condensado e lim√£o. Monte e leve √† geladeira.', '250']
                    ];

                    const ws = XLSX.utils.aoa_to_sheet(templateData);

                    // Definir larguras das colunas
                    ws['!cols'] = [
                        { wch: 25 }, // nome
                        { wch: 12 }, // rendimento
                        { wch: 60 }, // ingredientes
                        { wch: 50 }, // modo_preparo
                        { wch: 15 }  // margem_lucro
                    ];

                    // Adicionar coment√°rios explicativos
                    ws['C1'].c = [{
                        a: 'Sistema',
                        t: 'Formato: NomeProduto:Quantidade:Unidade;ProximoProduto:Quantidade:Unidade\nExemplo: Farinha de Trigo:0.5:kg;A√ß√∫car:0.3:kg'
                    }];

                    XLSX.utils.book_append_sheet(wb, ws, 'Template Receitas');
                    XLSX.writeFile(wb, 'template_receitas.xlsx');
                }

                function processarArquivoReceitas(input) {
                    const file = input.files[0];
                    if (!file) return;

                    // Mostrar arquivo selecionado
                    document.getElementById('dropZoneReceitas').classList.add('hidden');
                    document.getElementById('arquivoSelecionadoReceitas').classList.remove('hidden');
                    document.getElementById('nomeArquivoReceitas').textContent = file.name;
                    document.getElementById('tamanhoArquivoReceitas').textContent = `${(file.size / 1024).toFixed(1)} KB`;

                    const reader = new FileReader();

                    reader.onload = function (e) {
                        try {
                            let data;

                            if (file.name.endsWith('.csv')) {
                                // Processar CSV
                                const csv = e.target.result;
                                const lines = csv.split('\n');
                                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));

                                data = lines.slice(1).filter(line => line.trim()).map(line => {
                                    const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
                                    const obj = {};
                                    headers.forEach((header, index) => {
                                        obj[header] = values[index] || '';
                                    });
                                    return obj;
                                });
                            } else {
                                // Processar Excel
                                const workbook = XLSX.read(e.target.result, { type: 'binary' });
                                const sheetName = workbook.SheetNames[0];
                                const worksheet = workbook.Sheets[sheetName];
                                data = XLSX.utils.sheet_to_json(worksheet);
                            }

                            dadosImportacaoReceitas = data;
                            mostrarMapeamentoCamposReceitas(data);

                        } catch (error) {
                            alert('‚ùå Erro ao processar arquivo: ' + error.message);
                            removerArquivoReceitas();
                        }
                    };

                    if (file.name.endsWith('.csv')) {
                        reader.readAsText(file);
                    } else {
                        reader.readAsBinaryString(file);
                    }
                }

                function mostrarMapeamentoCamposReceitas(data) {
                    if (data.length === 0) {
                        alert('‚ùå Arquivo vazio ou sem dados v√°lidos!');
                        return;
                    }

                    const camposArquivo = Object.keys(data[0]);
                    const container = document.getElementById('mapeamentoCamposReceitas');
                    container.innerHTML = '';

                    // Resetar mapeamento
                    mapeamentoCamposReceitas = {};

                    camposObrigatoriosReceitas.forEach(campo => {
                        const div = document.createElement('div');
                        div.className = 'grid grid-cols-2 gap-4 items-center';

                        // Campo obrigat√≥rio
                        const labelDiv = document.createElement('div');
                        labelDiv.innerHTML = `
                    <label class="block text-sm font-medium text-gray-700">
                        ${campo.charAt(0).toUpperCase() + campo.slice(1)} *
                    </label>
                `;

                        // Select para mapear
                        const selectDiv = document.createElement('div');
                        const select = document.createElement('select');
                        select.className = 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent';
                        select.setAttribute('data-campo', campo);
                        select.onchange = () => atualizarMapeamentoReceitas();

                        // Op√ß√£o vazia
                        const emptyOption = document.createElement('option');
                        emptyOption.value = '';
                        emptyOption.textContent = 'Selecione uma coluna';
                        select.appendChild(emptyOption);

                        // Op√ß√µes do arquivo
                        camposArquivo.forEach(campoArquivo => {
                            const option = document.createElement('option');
                            option.value = campoArquivo;
                            option.textContent = campoArquivo;

                            // Auto-mapear campos similares
                            if (campoArquivo.toLowerCase().includes(campo.toLowerCase()) ||
                                campo.toLowerCase().includes(campoArquivo.toLowerCase())) {
                                option.selected = true;
                                mapeamentoCamposReceitas[campo] = campoArquivo;
                            }

                            select.appendChild(option);
                        });

                        selectDiv.appendChild(select);
                        div.appendChild(labelDiv);
                        div.appendChild(selectDiv);
                        container.appendChild(div);
                    });

                    // Campos opcionais
                    const camposOpcionais = ['modo_preparo', 'margem_lucro'];
                    camposOpcionais.forEach(campo => {
                        const div = document.createElement('div');
                        div.className = 'grid grid-cols-2 gap-4 items-center';

                        const labelDiv = document.createElement('div');
                        labelDiv.innerHTML = `
                    <label class="block text-sm font-medium text-gray-500">
                        ${campo.replace('_', ' ').charAt(0).toUpperCase() + campo.replace('_', ' ').slice(1)}
                    </label>
                `;

                        const selectDiv = document.createElement('div');
                        const select = document.createElement('select');
                        select.className = 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent';
                        select.setAttribute('data-campo', campo);
                        select.onchange = () => atualizarMapeamentoReceitas();

                        const emptyOption = document.createElement('option');
                        emptyOption.value = '';
                        emptyOption.textContent = 'N√£o mapear';
                        select.appendChild(emptyOption);

                        camposArquivo.forEach(campoArquivo => {
                            const option = document.createElement('option');
                            option.value = campoArquivo;
                            option.textContent = campoArquivo;

                            if (campoArquivo.toLowerCase().includes(campo.toLowerCase()) ||
                                campo.toLowerCase().includes(campoArquivo.toLowerCase())) {
                                option.selected = true;
                                mapeamentoCamposReceitas[campo] = campoArquivo;
                            }

                            select.appendChild(option);
                        });

                        selectDiv.appendChild(select);
                        div.appendChild(labelDiv);
                        div.appendChild(selectDiv);
                        container.appendChild(div);
                    });

                    // Mostrar preview
                    atualizarPreviewImportacaoReceitas();

                    // Mostrar se√ß√£o de mapeamento
                    document.getElementById('secaoMapeamentoReceitas').classList.remove('hidden');
                }

                function atualizarMapeamentoReceitas() {
                    const selects = document.querySelectorAll('#mapeamentoCamposReceitas select');
                    mapeamentoCamposReceitas = {};

                    selects.forEach(select => {
                        const campo = select.getAttribute('data-campo');
                        if (select.value) {
                            mapeamentoCamposReceitas[campo] = select.value;
                        }
                    });

                    atualizarPreviewImportacaoReceitas();
                }

                function atualizarPreviewImportacaoReceitas() {
                    const tbody = document.getElementById('previewImportacaoReceitas');
                    tbody.innerHTML = '';

                    // Mostrar apenas os primeiros 5 registros
                    const preview = dadosImportacaoReceitas.slice(0, 5);

                    preview.forEach((item, index) => {
                        const row = document.createElement('tr');
                        row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';

                        const nome = item[mapeamentoCamposReceitas.nome] || '';
                        const rendimento = item[mapeamentoCamposReceitas.rendimento] || '';
                        const ingredientes = item[mapeamentoCamposReceitas.ingredientes] || '';
                        const modoPreparo = item[mapeamentoCamposReceitas.modo_preparo] || '';

                        // Validar dados
                        const erros = [];
                        if (!nome) erros.push('Nome obrigat√≥rio');
                        if (!rendimento || isNaN(parseInt(rendimento))) erros.push('Rendimento inv√°lido');
                        if (!ingredientes) erros.push('Ingredientes obrigat√≥rios');

                        // Validar formato dos ingredientes
                        if (ingredientes) {
                            try {
                                const ingredientesArray = ingredientes.split(';');
                                let ingredientesValidos = true;
                                ingredientesArray.forEach(ing => {
                                    const partes = ing.split(':');
                                    if (partes.length !== 3 || !partes[0] || !partes[1] || !partes[2]) {
                                        ingredientesValidos = false;
                                    }
                                });
                                if (!ingredientesValidos) {
                                    erros.push('Formato de ingredientes inv√°lido');
                                }
                            } catch (e) {
                                erros.push('Formato de ingredientes inv√°lido');
                            }
                        }

                        const statusClass = erros.length > 0 ? 'text-red-600' : 'text-green-600';
                        const statusIcon = erros.length > 0 ? '‚ùå' : '‚úÖ';
                        const statusText = erros.length > 0 ? erros.join(', ') : 'OK';

                        row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${nome}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${rendimento} por√ß√µes</td>
                    <td class="px-6 py-4 text-sm text-gray-900 max-w-xs truncate">${ingredientes}</td>
                    <td class="px-6 py-4 text-sm text-gray-900 max-w-xs truncate">${modoPreparo}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${statusClass}">
                        ${statusIcon} ${statusText}
                    </td>
                `;
                        tbody.appendChild(row);
                    });

                    // Atualizar contador
                    const totalRegistros = dadosImportacaoReceitas.length;
                    const registrosValidos = dadosImportacaoReceitas.filter(item => {
                        const nome = item[mapeamentoCamposReceitas.nome];
                        const rendimento = item[mapeamentoCamposReceitas.rendimento];
                        const ingredientes = item[mapeamentoCamposReceitas.ingredientes];

                        return nome && rendimento && !isNaN(parseInt(rendimento)) && ingredientes;
                    }).length;

                    document.getElementById('contadorImportacaoReceitas').textContent =
                        `${registrosValidos} de ${totalRegistros} registros v√°lidos`;

                    // Habilitar/desabilitar bot√£o de importa√ß√£o
                    const btnImportar = document.querySelector('button[onclick="executarImportacaoReceitas()"]');
                    if (registrosValidos > 0) {
                        btnImportar.disabled = false;
                        btnImportar.classList.remove('opacity-50', 'cursor-not-allowed');
                    } else {
                        btnImportar.disabled = true;
                        btnImportar.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                }

                function removerArquivoReceitas() {
                    document.getElementById('arquivoImportacaoReceitas').value = '';
                    document.getElementById('dropZoneReceitas').classList.remove('hidden');
                    document.getElementById('arquivoSelecionadoReceitas').classList.add('hidden');
                    document.getElementById('secaoMapeamentoReceitas').classList.add('hidden');
                    dadosImportacaoReceitas = [];
                    mapeamentoCamposReceitas = {};
                }

                function executarImportacaoReceitas() {
                    if (dadosImportacaoReceitas.length === 0) {
                        alert('‚ùå Nenhum dado para importar!');
                        return;
                    }

                    let importados = 0;
                    let erros = 0;

                    dadosImportacaoReceitas.forEach(item => {
                        try {
                            const nome = item[mapeamentoCamposReceitas.nome];
                            const rendimento = parseInt(item[mapeamentoCamposReceitas.rendimento]);
                            const ingredientesTexto = item[mapeamentoCamposReceitas.ingredientes];
                            const modoPreparo = item[mapeamentoCamposReceitas.modo_preparo] || '';
                            const margemLucro = parseFloat(item[mapeamentoCamposReceitas.margem_lucro]) || 200;

                            // Validar dados obrigat√≥rios
                            if (!nome || isNaN(rendimento) || !ingredientesTexto) {
                                erros++;
                                return;
                            }

                            // Processar ingredientes
                            const ingredientes = [];
                            let custoTotal = 0;
                            let ingredientesValidos = true;

                            try {
                                const ingredientesArray = ingredientesTexto.split(';');

                                ingredientesArray.forEach(ing => {
                                    const partes = ing.trim().split(':');
                                    if (partes.length !== 3) {
                                        ingredientesValidos = false;
                                        return;
                                    }

                                    const nomeProduto = partes[0].trim();
                                    const quantidade = parseFloat(partes[1]);
                                    const unidade = partes[2].trim();

                                    // Buscar produto no estoque
                                    const produto = produtos.find(p =>
                                        p.nome.toLowerCase() === nomeProduto.toLowerCase() ||
                                        p.nome.toLowerCase().includes(nomeProduto.toLowerCase())
                                    );

                                    if (produto && !isNaN(quantidade)) {
                                        ingredientes.push({
                                            produtoId: produto.id,
                                            quantidade: quantidade
                                        });
                                        custoTotal += quantidade * produto.preco;
                                    } else {
                                        ingredientesValidos = false;
                                    }
                                });
                            } catch (e) {
                                ingredientesValidos = false;
                            }

                            if (!ingredientesValidos || ingredientes.length === 0) {
                                erros++;
                                return;
                            }

                            // Verificar se receita j√° existe
                            const receitaExistente = receitas.find(r =>
                                r.nome.toLowerCase() === nome.toLowerCase()
                            );

                            const custoPorPorcao = custoTotal / rendimento;
                            const precoSugerido = custoPorPorcao * (1 + margemLucro / 100);

                            if (receitaExistente) {
                                // Atualizar receita existente
                                receitaExistente.rendimento = rendimento;
                                receitaExistente.ingredientes = ingredientes;
                                receitaExistente.modoPreparo = modoPreparo;
                                receitaExistente.custoTotal = custoTotal;
                                receitaExistente.custoPorPorcao = custoPorPorcao;
                                receitaExistente.margemLucro = margemLucro;
                                receitaExistente.precoSugerido = precoSugerido;
                                receitaExistente.precoVenda = precoSugerido;
                            } else {
                                // Criar nova receita
                                const novaReceita = {
                                    id: proximoIdReceita++,
                                    nome,
                                    rendimento,
                                    ingredientes,
                                    modoPreparo,
                                    custoTotal,
                                    custoPorPorcao,
                                    margemLucro,
                                    precoSugerido,
                                    precoVenda: precoSugerido
                                };
                                receitas.push(novaReceita);
                            }

                            importados++;
                        } catch (error) {
                            erros++;
                        }
                    });

                    // Salvar dados ap√≥s importa√ß√£o
                    if (importados > 0) {
                        salvarDados();
                    }

                    // Fechar modal e atualizar receitas
                    closeModal('modalImportacaoReceitas');
                    atualizarReceitas();

                    // Mostrar resultado
                    let mensagem = `‚úÖ Importa√ß√£o de receitas conclu√≠da!\n\n`;
                    mensagem += `üìù ${importados} receitas importadas com sucesso\n`;
                    if (erros > 0) {
                        mensagem += `‚ùå ${erros} registros com erro foram ignorados\n\n`;
                        mensagem += `üí° Dica: Verifique se todos os ingredientes existem no estoque`;
                    }

                    alert(mensagem);
                }

                // Fun√ß√µes de receitas avan√ßadas
                function exportarReceitasExcel() {
                    if (receitas.length === 0) {
                        alert('‚ùå Nenhuma receita para exportar!');
                        return;
                    }

                    // Preparar dados para exporta√ß√£o
                    const dadosExportacao = receitas.map(receita => {
                        const ingredientesTexto = receita.ingredientes.map(ing => {
                            const produto = produtos.find(p => p.id === ing.produtoId);
                            return produto ? `${ing.quantidade} ${produto.unidade} de ${produto.nome}` : '';
                        }).filter(Boolean).join('; ');

                        return {
                            'Nome da Receita': receita.nome,
                            'Rendimento (por√ß√µes)': receita.rendimento,
                            'Custo Total': receita.custoTotal.toFixed(2),
                            'Custo por Por√ß√£o': receita.custoPorPorcao.toFixed(2),
                            'Pre√ßo Sugerido': (receita.custoPorPorcao * 3).toFixed(2),
                            'Margem Sugerida (%)': '200',
                            'Ingredientes': ingredientesTexto,
                            'Modo de Preparo': receita.modoPreparo || ''
                        };
                    });

                    // Criar workbook
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.json_to_sheet(dadosExportacao);

                    // Definir larguras das colunas
                    ws['!cols'] = [
                        { wch: 25 }, // Nome da Receita
                        { wch: 18 }, // Rendimento
                        { wch: 15 }, // Custo Total
                        { wch: 18 }, // Custo por Por√ß√£o
                        { wch: 18 }, // Pre√ßo Sugerido
                        { wch: 18 }, // Margem Sugerida
                        { wch: 50 }, // Ingredientes
                        { wch: 40 }  // Modo de Preparo
                    ];

                    XLSX.utils.book_append_sheet(wb, ws, 'Receitas');

                    // Gerar nome do arquivo com data
                    const agora = new Date();
                    const dataFormatada = agora.toISOString().split('T')[0];
                    const nomeArquivo = `receitas_${dataFormatada}.xlsx`;

                    XLSX.writeFile(wb, nomeArquivo);

                    alert(`‚úÖ Cat√°logo de receitas exportado com sucesso!\nüìÅ ${nomeArquivo}`);
                }

                function exportarReceitasPDF() {
                    if (receitas.length === 0) {
                        alert('‚ùå Nenhuma receita para exportar!');
                        return;
                    }

                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();

                    // Configurar fonte
                    doc.setFont('helvetica');

                    // Cabe√ßalho
                    doc.setFontSize(20);
                    doc.text('Cat√°logo de Receitas', 20, 20);

                    doc.setFontSize(12);
                    doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}`, 20, 30);
                    doc.text(`Total de receitas: ${receitas.length}`, 20, 40);

                    // Linha separadora
                    doc.line(20, 50, 190, 50);

                    let yPos = 60;

                    receitas.forEach((receita, index) => {
                        // Verificar se precisa de nova p√°gina
                        if (yPos > 220) {
                            doc.addPage();
                            yPos = 20;
                        }

                        // Nome da receita
                        doc.setFontSize(16);
                        doc.setFont('helvetica', 'bold');
                        doc.text(receita.nome, 20, yPos);
                        yPos += 10;

                        // Informa√ß√µes b√°sicas
                        doc.setFontSize(10);
                        doc.setFont('helvetica', 'normal');
                        doc.text(`Rendimento: ${receita.rendimento} por√ß√µes`, 20, yPos);
                        doc.text(`Custo: R$ ${receita.custoTotal.toFixed(2)} (R$ ${receita.custoPorPorcao.toFixed(2)}/por√ß√£o)`, 100, yPos);
                        yPos += 8;

                        // Ingredientes
                        doc.setFont('helvetica', 'bold');
                        doc.text('Ingredientes:', 20, yPos);
                        yPos += 6;

                        doc.setFont('helvetica', 'normal');
                        receita.ingredientes.forEach(ing => {
                            const produto = produtos.find(p => p.id === ing.produtoId);
                            if (produto) {
                                doc.text(`‚Ä¢ ${ing.quantidade} ${produto.unidade} de ${produto.nome}`, 25, yPos);
                                yPos += 5;
                            }
                        });

                        // Modo de preparo
                        if (receita.modoPreparo) {
                            yPos += 3;
                            doc.setFont('helvetica', 'bold');
                            doc.text('Modo de Preparo:', 20, yPos);
                            yPos += 6;

                            doc.setFont('helvetica', 'normal');
                            const linhas = doc.splitTextToSize(receita.modoPreparo, 170);
                            linhas.forEach(linha => {
                                doc.text(linha, 20, yPos);
                                yPos += 5;
                            });
                        }

                        // Separador entre receitas
                        yPos += 10;
                        if (index < receitas.length - 1) {
                            doc.line(20, yPos, 190, yPos);
                            yPos += 10;
                        }
                    });

                    // Salvar PDF
                    const agora = new Date();
                    const dataFormatada = agora.toISOString().split('T')[0];
                    const nomeArquivo = `catalogo_receitas_${dataFormatada}.pdf`;

                    doc.save(nomeArquivo);

                    alert(`‚úÖ Cat√°logo de receitas PDF gerado com sucesso!\nüìÅ ${nomeArquivo}`);
                }

                // Fun√ß√µes adicionais para os bot√µes dos cards
                function duplicarReceita(id) {
                    const receita = receitas.find(r => r.id === id);
                    if (receita) {
                        const novaReceita = {
                            ...receita,
                            id: proximoIdReceita++,
                            nome: receita.nome + ' (C√≥pia)'
                        };
                        receitas.push(novaReceita);
                        atualizarReceitas();
                        alert('‚úÖ Receita duplicada com sucesso!');
                    }
                }

                function calcularReceita(id) {
                    const receita = receitas.find(r => r.id === id);
                    if (receita) {
                        const novoRendimento = prompt(`Calcular receita para quantas por√ß√µes?\n\nReceita original: ${receita.rendimento} por√ß√µes`, receita.rendimento);
                        if (novoRendimento && !isNaN(novoRendimento)) {
                            const fator = parseFloat(novoRendimento) / receita.rendimento;

                            let detalhes = `üìä C√°lculo para ${novoRendimento} por√ß√µes:\n\n`;
                            detalhes += `üßÑ Ingredientes ajustados:\n`;

                            receita.ingredientes.forEach(ing => {
                                const produto = produtos.find(p => p.id === ing.produtoId);
                                if (produto) {
                                    const novaQuantidade = (ing.quantidade * fator).toFixed(2);
                                    detalhes += `‚Ä¢ ${novaQuantidade} ${produto.unidade} de ${produto.nome}\n`;
                                }
                            });

                            const novoCusto = receita.custoTotal * fator;
                            detalhes += `\nüí∞ Custo total: R$ ${novoCusto.toFixed(2)}`;
                            detalhes += `\nüí∞ Custo por por√ß√£o: R$ ${receita.custoPorPorcao.toFixed(2)}`;

                            alert(detalhes);
                        }
                    }
                }

                function imprimirReceita(id) {
                    const receita = receitas.find(r => r.id === id);
                    if (!receita) return;

                    // Criar janela de impress√£o
                    const printWindow = window.open('', '_blank');

                    const ingredientesHTML = receita.ingredientes.map(ing => {
                        const produto = produtos.find(p => p.id === ing.produtoId);
                        if (produto) {
                            const custoIngrediente = ing.quantidade * produto.preco;
                            return `<li>${ing.quantidade} ${produto.unidade} de ${produto.nome} <span class="custo">(R$ ${custoIngrediente.toFixed(2)})</span></li>`;
                        }
                        return '';
                    }).filter(Boolean).join('');

                    const precoSugerido = receita.custoPorPorcao * 3;
                    const margem = 200;
                    const lucro = precoSugerido - receita.custoPorPorcao;

                    printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Receita: ${receita.nome}</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            max-width: 800px;
                            margin: 0 auto;
                            padding: 20px;
                            line-height: 1.6;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #333;
                            padding-bottom: 20px;
                            margin-bottom: 30px;
                        }
                        .title {
                            font-size: 28px;
                            font-weight: bold;
                            color: #333;
                            margin-bottom: 10px;
                        }
                        .info-grid {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 20px;
                            margin-bottom: 30px;
                        }
                        .info-box {
                            background: #f5f5f5;
                            padding: 15px;
                            border-radius: 8px;
                            border-left: 4px solid #8B5CF6;
                        }
                        .info-label {
                            font-weight: bold;
                            color: #666;
                            font-size: 12px;
                            text-transform: uppercase;
                        }
                        .info-value {
                            font-size: 18px;
                            font-weight: bold;
                            color: #333;
                        }
                        .section {
                            margin-bottom: 30px;
                        }
                        .section-title {
                            font-size: 20px;
                            font-weight: bold;
                            color: #333;
                            margin-bottom: 15px;
                            border-bottom: 1px solid #ddd;
                            padding-bottom: 5px;
                        }
                        .ingredients {
                            list-style: none;
                            padding: 0;
                        }
                        .ingredients li {
                            padding: 8px 0;
                            border-bottom: 1px dotted #ccc;
                            display: flex;
                            justify-content: space-between;
                        }
                        .custo {
                            color: #666;
                            font-size: 14px;
                        }
                        .preparo {
                            background: #f9f9f9;
                            padding: 20px;
                            border-radius: 8px;
                            border-left: 4px solid #10B981;
                        }
                        .pricing {
                            background: linear-gradient(135deg, #10B981, #059669);
                            color: white;
                            padding: 20px;
                            border-radius: 8px;
                            margin-top: 30px;
                        }
                        .pricing-grid {
                            display: grid;
                            grid-template-columns: 1fr 1fr 1fr;
                            gap: 20px;
                            text-align: center;
                        }
                        .pricing-item {
                            background: rgba(255,255,255,0.1);
                            padding: 15px;
                            border-radius: 6px;
                        }
                        .pricing-value {
                            font-size: 24px;
                            font-weight: bold;
                        }
                        .pricing-label {
                            font-size: 12px;
                            opacity: 0.9;
                        }
                        .footer {
                            text-align: center;
                            margin-top: 40px;
                            padding-top: 20px;
                            border-top: 1px solid #ddd;
                            color: #666;
                            font-size: 12px;
                        }
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="title"> ${receita.nome}</div>
                        <div>Receita para ${receita.rendimento} por√ß√µes</div>
                    </div>
                    
                    <div class="info-grid">
                        <div class="info-box">
                            <div class="info-label">Custo Total</div>
                            <div class="info-value">R$ ${receita.custoTotal.toFixed(2)}</div>
                        </div>
                        <div class="info-box">
                            <div class="info-label">Custo por Por√ß√£o</div>
                            <div class="info-value">R$ ${receita.custoPorPorcao.toFixed(2)}</div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <div class="section-title">üßÑ Ingredientes</div>
                        <ul class="ingredients">
                            ${ingredientesHTML}
                        </ul>
                    </div>
                    
                    ${receita.modoPreparo ? `
                        <div class="section">
                            <div class="section-title">üë®‚Äçüç≥ Modo de Preparo</div>
                            <div class="preparo">${receita.modoPreparo}</div>
                        </div>
                    ` : ''}
                    
                    <div class="pricing">
                        <div class="section-title" style="color: white; border-color: rgba(255,255,255,0.3);">üí∞ Sugest√£o de Pre√ßo</div>
                        <div class="pricing-grid">
                            <div class="pricing-item">
                                <div class="pricing-value">R$ ${precoSugerido.toFixed(2)}</div>
                                <div class="pricing-label">Pre√ßo por Por√ß√£o</div>
                            </div>
                            <div class="pricing-item">
                                <div class="pricing-value">${margem}%</div>
                                <div class="pricing-label">Margem</div>
                            </div>
                            <div class="pricing-item">
                                <div class="pricing-value">R$ ${lucro.toFixed(2)}</div>
                                <div class="pricing-label">Lucro por Por√ß√£o</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="footer">
                        Receita gerada em ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}<br>
                        Sistema de Controle de Estoque - Bem Brownieria

                    </div>
                </body>
                </html>
            `);

                    printWindow.document.close();

                    // Aguardar carregamento e imprimir
                    printWindow.onload = function () {
                        setTimeout(() => {
                            printWindow.print();
                            printWindow.close();
                        }, 500);
                    };
                }

                // Fun√ß√µes do Sistema de Notifica√ß√µes
                function verificarNotificacoes() {
                    alertasAtivos = [];

                    // Verificar estoque baixo
                    if (configuracoes.notificacoes.estoqueBaixo) {
                        produtos.forEach(produto => {
                            const status = getStatusEstoque(produto.quantidade, produto.unidade);
                            if (status === 'baixo') {
                                alertasAtivos.push({
                                    tipo: 'estoque',
                                    prioridade: 'alta',
                                    titulo: `Estoque baixo: ${produto.nome}`,
                                    descricao: `Apenas ${produto.quantidade} ${produto.unidade} restantes`,
                                    produto: produto,
                                    timestamp: new Date()
                                });
                            }
                        });
                    }

                    // Verificar produtos pr√≥ximos ao vencimento
                    if (configuracoes.notificacoes.vencimento) {
                        const hoje = new Date();
                        const diasAntecedencia = configuracoes.notificacoes.diasAntecedencia;

                        produtos.forEach(produto => {
                            if (produto.validade) {
                                const dataVencimento = new Date(produto.validade);
                                const diasRestantes = Math.ceil((dataVencimento - hoje) / (1000 * 60 * 60 * 24));

                                if (diasRestantes <= diasAntecedencia && diasRestantes >= 0) {
                                    let prioridade = 'media';
                                    let emoji = '‚ö†Ô∏è';

                                    if (diasRestantes <= 2) {
                                        prioridade = 'critica';
                                        emoji = 'üö®';
                                    } else if (diasRestantes <= 5) {
                                        prioridade = 'alta';
                                        emoji = '‚ö†Ô∏è';
                                    }

                                    alertasAtivos.push({
                                        tipo: 'vencimento',
                                        prioridade: prioridade,
                                        titulo: `${emoji} ${produto.nome} vence em ${diasRestantes} dia(s)`,
                                        descricao: `Vencimento: ${dataVencimento.toLocaleDateString('pt-BR')}`,
                                        produto: produto,
                                        diasRestantes: diasRestantes,
                                        timestamp: new Date()
                                    });
                                }
                            }
                        });
                    }

                    // Ordenar alertas por prioridade
                    const ordemPrioridade = { 'critica': 0, 'alta': 1, 'media': 2, 'baixa': 3 };
                    alertasAtivos.sort((a, b) => ordemPrioridade[a.prioridade] - ordemPrioridade[b.prioridade]);

                    // Atualizar timestamp da √∫ltima verifica√ß√£o
                    ultimaVerificacaoNotificacoes = new Date();

                    // Atualizar interface
                    atualizarInterfaceAlertas();
                    atualizarStatusNotificacoes();

                    // Mostrar notifica√ß√£o se houver alertas cr√≠ticos
                    const alertasCriticos = alertasAtivos.filter(a => a.prioridade === 'critica');
                    if (alertasCriticos.length > 0) {
                        mostrarNotificacaoUrgente(alertasCriticos);
                    }

                    return alertasAtivos;
                }

                function atualizarInterfaceAlertas() {
                    const badge = document.getElementById('badgeAlertas');
                    const listaAlertas = document.getElementById('listaAlertas');

                    // Atualizar badge
                    if (alertasAtivos.length > 0) {
                        badge.textContent = alertasAtivos.length;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }

                    // Atualizar lista de alertas
                    listaAlertas.innerHTML = '';

                    if (alertasAtivos.length === 0) {
                        listaAlertas.innerHTML = `
                    <div class="p-4 text-center text-gray-500">
                        <div class="text-2xl mb-2">‚úÖ</div>
                        <div>Nenhum alerta no momento</div>
                        <div class="text-xs mt-1">Tudo est√° funcionando bem!</div>
                    </div>
                `;
                    } else {
                        alertasAtivos.forEach(alerta => {
                            const div = document.createElement('div');
                            div.className = `p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer ${getPrioridadeClass(alerta.prioridade)}`;

                            const tempoRelativo = getTempoRelativo(alerta.timestamp);

                            div.innerHTML = `
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0 mt-1">
                                ${getPrioridadeIcon(alerta.prioridade)}
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="font-medium text-sm text-gray-900">${alerta.titulo}</div>
                                <div class="text-xs text-gray-600 mt-1">${alerta.descricao}</div>
                                <div class="text-xs text-gray-400 mt-1">${tempoRelativo}</div>
                            </div>
                            <button onclick="resolverAlerta('${alerta.produto.id}', '${alerta.tipo}')" class="text-gray-400 hover:text-gray-600" title="Marcar como resolvido">
                                ‚úï
                            </button>
                        </div>
                    `;

                            // Adicionar a√ß√£o ao clicar
                            div.onclick = function (e) {
                                if (e.target.tagName !== 'BUTTON') {
                                    mostrarDetalhesAlerta(alerta);
                                }
                            };

                            listaAlertas.appendChild(div);
                        });
                    }
                }

                function atualizarStatusNotificacoes() {
                    const countEstoqueBaixo = document.getElementById('countEstoqueBaixo');
                    const countVencimento = document.getElementById('countVencimento');
                    const ultimaVerificacao = document.getElementById('ultimaVerificacao');

                    if (countEstoqueBaixo) {
                        const estoqueBaixo = alertasAtivos.filter(a => a.tipo === 'estoque').length;
                        countEstoqueBaixo.textContent = estoqueBaixo;
                    }

                    if (countVencimento) {
                        const vencimento = alertasAtivos.filter(a => a.tipo === 'vencimento').length;
                        countVencimento.textContent = vencimento;
                    }

                    if (ultimaVerificacao && ultimaVerificacaoNotificacoes) {
                        ultimaVerificacao.textContent = ultimaVerificacaoNotificacoes.toLocaleTimeString('pt-BR');
                    }
                }

                function getPrioridadeClass(prioridade) {
                    switch (prioridade) {
                        case 'critica': return 'border-l-4 border-red-500 bg-red-50';
                        case 'alta': return 'border-l-4 border-orange-500 bg-orange-50';
                        case 'media': return 'border-l-4 border-yellow-500 bg-yellow-50';
                        default: return 'border-l-4 border-blue-500 bg-blue-50';
                    }
                }

                function getPrioridadeIcon(prioridade) {
                    switch (prioridade) {
                        case 'critica': return 'üö®';
                        case 'alta': return '‚ö†Ô∏è';
                        case 'media': return '‚ö°';
                        default: return '‚ÑπÔ∏è';
                    }
                }

                function getTempoRelativo(timestamp) {
                    const agora = new Date();
                    const diff = agora - timestamp;
                    const minutos = Math.floor(diff / (1000 * 60));

                    if (minutos < 1) return 'Agora mesmo';
                    if (minutos < 60) return `${minutos} min atr√°s`;

                    const horas = Math.floor(minutos / 60);
                    if (horas < 24) return `${horas}h atr√°s`;

                    const dias = Math.floor(horas / 24);
                    return `${dias}d atr√°s`;
                }

                function toggleAlertas() {
                    const dropdown = document.getElementById('dropdownAlertas');
                    dropdown.classList.toggle('hidden');

                    // Verificar notifica√ß√µes ao abrir
                    if (!dropdown.classList.contains('hidden')) {
                        verificarNotificacoes();
                    }
                }

                function mostrarNotificacaoUrgente(alertasCriticos) {
                    let mensagem = 'üö® ALERTAS CR√çTICOS!\n\n';

                    alertasCriticos.forEach(alerta => {
                        mensagem += `‚Ä¢ ${alerta.titulo}\n`;
                    });

                    mensagem += '\n‚ö†Ô∏è A√ß√£o imediata necess√°ria!';

                    // Mostrar alerta nativo do navegador
                    alert(mensagem);

                    // Tentar mostrar notifica√ß√£o do navegador se permitido
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification('Doce Controle - Alertas Cr√≠ticos', {
                            body: `${alertasCriticos.length} alerta(s) cr√≠tico(s) detectado(s)`,
                            icon: 'üö®',
                            requireInteraction: true
                        });
                    }
                }

                function mostrarDetalhesAlerta(alerta) {
                    let detalhes = `üìã Detalhes do Alerta\n\n`;
                    detalhes += `Produto: ${alerta.produto.nome}\n`;
                    detalhes += `Categoria: ${alerta.produto.categoria}\n`;

                    if (alerta.tipo === 'estoque') {
                        detalhes += `Quantidade atual: ${alerta.produto.quantidade} ${alerta.produto.unidade}\n`;
                        const limite = configuracoes.limites[alerta.produto.unidade];
                        detalhes += `Limite m√≠nimo: ${limite.min} ${alerta.produto.unidade}\n`;
                        detalhes += `\nüí° Sugest√£o: Reabastecer o estoque`;
                    } else if (alerta.tipo === 'vencimento') {
                        detalhes += `Data de vencimento: ${new Date(alerta.produto.validade).toLocaleDateString('pt-BR')}\n`;
                        detalhes += `Dias restantes: ${alerta.diasRestantes}\n`;
                        detalhes += `\nüí° Sugest√£o: Usar o produto em breve ou fazer promo√ß√£o`;
                    }

                    alert(detalhes);
                }

                function resolverAlerta(produtoId, tipo) {
                    // Remover alerta da lista
                    alertasAtivos = alertasAtivos.filter(a =>
                        !(a.produto.id == produtoId && a.tipo === tipo)
                    );

                    // Atualizar interface
                    atualizarInterfaceAlertas();
                    atualizarStatusNotificacoes();
                }

                function configurarNotificacaoAutomatica() {
                    // Limpar intervalo anterior se existir
                    if (intervalNotificacoes) {
                        clearInterval(intervalNotificacoes);
                        intervalNotificacoes = null;
                    }

                    // Configurar novo intervalo se ativado
                    if (configuracoes.notificacoes.automatica) {
                        // Verificar a cada 30 minutos (1800000 ms)
                        intervalNotificacoes = setInterval(() => {
                            verificarNotificacoes();
                        }, 1800000);

                        console.log('‚úÖ Verifica√ß√£o autom√°tica de notifica√ß√µes ativada (30 min)');
                    } else {
                        console.log('‚ùå Verifica√ß√£o autom√°tica de notifica√ß√µes desativada');
                    }
                }

                function solicitarPermissaoNotificacao() {
                    if ('Notification' in window && Notification.permission === 'default') {
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                console.log('‚úÖ Permiss√£o para notifica√ß√µes concedida');
                                new Notification('Doce Controle', {
                                    body: 'Notifica√ß√µes ativadas com sucesso!',
                                    icon: 'üßÅ'
                                });
                            }
                        });
                    }
                }

                // Fun√ß√µes dos menus de configura√ß√£o
                function toggleConfigMenu() {
                    const menu = document.getElementById('configMenu');
                    menu.classList.toggle('hidden');
                }

                function toggleMobileConfigMenu() {
                    const menu = document.getElementById('mobileConfigMenu');
                    menu.classList.toggle('hidden');
                }

                // Fechar dropdowns ao clicar fora
                document.addEventListener('click', function (event) {
                    const dropdownAlertas = document.getElementById('dropdownAlertas');
                    const botaoAlertas = event.target.closest('button[onclick="toggleAlertas()"]');

                    if (!botaoAlertas && !dropdownAlertas.contains(event.target)) {
                        dropdownAlertas.classList.add('hidden');
                    }

                    const exportMenu = document.getElementById('exportMenu');
                    const exportButton = event.target.closest('.mobile-export');

                    if (!exportButton && !exportMenu.contains(event.target)) {
                        exportMenu.classList.add('hidden');
                    }

                    // Fechar menu de configura√ß√µes desktop
                    const configMenu = document.getElementById('configMenu');
                    const configButton = event.target.closest('button[onclick="toggleConfigMenu()"]');

                    if (!configButton && !configMenu.contains(event.target)) {
                        configMenu.classList.add('hidden');
                    }

                    // Fechar menu de configura√ß√µes mobile
                    const mobileConfigMenu = document.getElementById('mobileConfigMenu');
                    const mobileConfigButton = event.target.closest('button[onclick="toggleMobileConfigMenu()"]');

                    if (!mobileConfigButton && !mobileConfigMenu.contains(event.target)) {
                        mobileConfigMenu.classList.add('hidden');
                    }
                });

                // Toggle Sidebar Function
                function toggleSidebar() {
                    const sidebar = document.getElementById('desktopSidebar');
                    if (sidebar.classList.contains('-translate-x-full') || sidebar.style.width === '0px') {
                        // Open sidebar
                        sidebar.classList.remove('-translate-x-full');
                        sidebar.classList.remove('hidden');
                        sidebar.style.width = '256px'; // w-64
                        sidebar.classList.add('md:flex');
                    } else {
                        // Close sidebar
                        sidebar.classList.add('-translate-x-full');
                        // sidebar.classList.add('hidden'); // Optional: keep it in DOM but moved
                        sidebar.style.width = '0px';
                        sidebar.classList.remove('md:flex');
                        sidebar.classList.add('hidden'); // Hide completely to remove space
                    }
                }

                // Fun√ß√µes de envio manual de alertas
                function enviarAlertasWhatsApp() {
                    const whatsapp = configuracoes.contato.whatsapp;

                    if (!whatsapp) {
                        alert('‚ö†Ô∏è Por favor, configure um n√∫mero de WhatsApp primeiro!');
                        return;
                    }

                    // Verificar alertas atuais
                    verificarNotificacoes();

                    if (alertasAtivos.length === 0) {
                        const confirmacao = confirm('‚úÖ N√£o h√° alertas ativos no momento.\n\nDeseja enviar um relat√≥rio de status mesmo assim?');
                        if (!confirmacao) return;
                    }

                    // Gerar mensagem para WhatsApp
                    let mensagem = `üßÅ *DOCE CONTROLE - RELAT√ìRIO DE ALERTAS*\n`;
                    mensagem += `üìÖ ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}\n\n`;

                    if (alertasAtivos.length === 0) {
                        mensagem += `‚úÖ *TUDO OK!*\n`;
                        mensagem += `Nenhum alerta ativo no momento.\n`;
                        mensagem += `Seu estoque est√° funcionando perfeitamente! üéâ\n\n`;
                    } else {
                        mensagem += `‚ö†Ô∏è *${alertasAtivos.length} ALERTA(S) DETECTADO(S)*\n\n`;

                        // Agrupar por tipo
                        const estoquesBaixos = alertasAtivos.filter(a => a.tipo === 'estoque');
                        const vencimentos = alertasAtivos.filter(a => a.tipo === 'vencimento');

                        if (estoquesBaixos.length > 0) {
                            mensagem += `üì¶ *ESTOQUE BAIXO (${estoquesBaixos.length}):*\n`;
                            estoquesBaixos.forEach(alerta => {
                                mensagem += `‚Ä¢ ${alerta.produto.nome}: ${alerta.produto.quantidade} ${alerta.produto.unidade}\n`;
                            });
                            mensagem += `\n`;
                        }

                        if (vencimentos.length > 0) {
                            mensagem += `‚è∞ *PR√ìXIMOS AO VENCIMENTO (${vencimentos.length}):*\n`;
                            vencimentos.forEach(alerta => {
                                mensagem += `‚Ä¢ ${alerta.produto.nome}: ${alerta.diasRestantes} dia(s)\n`;
                            });
                            mensagem += `\n`;
                        }
                    }

                    // Adicionar resumo do estoque
                    const totalProdutos = produtos.length;
                    const valorTotal = produtos.reduce((sum, p) => sum + (p.quantidade * p.preco), 0);

                    mensagem += `üìä *RESUMO DO ESTOQUE:*\n`;
                    mensagem += `‚Ä¢ Total de produtos: ${totalProdutos}\n`;
                    mensagem += `‚Ä¢ Valor total: R$ ${valorTotal.toFixed(2)}\n`;
                    mensagem += `‚Ä¢ √öltima verifica√ß√£o: ${new Date().toLocaleTimeString('pt-BR')}\n\n`;

                    mensagem += `ü§ñ _Mensagem autom√°tica do sistema Doce Controle_`;

                    // Criar link do WhatsApp
                    const numeroLimpo = whatsapp.replace(/\D/g, '');
                    const mensagemCodificada = encodeURIComponent(mensagem);
                    const linkWhatsApp = `https://wa.me/55${numeroLimpo}?text=${mensagemCodificada}`;

                    // Abrir WhatsApp
                    window.open(linkWhatsApp, '_blank');

                    alert('üì± WhatsApp aberto com a mensagem pronta!\n\nRevise e envie a mensagem.');
                }

                function enviarAlertasEmail() {
                    const email = configuracoes.contato.email;

                    if (!email) {
                        alert('‚ö†Ô∏è Por favor, configure um email primeiro!');
                        return;
                    }

                    // Verificar alertas atuais
                    verificarNotificacoes();

                    if (alertasAtivos.length === 0) {
                        const confirmacao = confirm('‚úÖ N√£o h√° alertas ativos no momento.\n\nDeseja enviar um relat√≥rio de status mesmo assim?');
                        if (!confirmacao) return;
                    }

                    // Gerar assunto e corpo do email
                    const dataAtual = new Date().toLocaleDateString('pt-BR');
                    let assunto = '';
                    let corpo = '';

                    if (alertasAtivos.length === 0) {
                        assunto = `Doce Controle - Status OK (${dataAtual})`;
                        corpo = `DOCE CONTROLE - RELAT√ìRIO DE STATUS\n`;
                        corpo += `Data: ${dataAtual} √†s ${new Date().toLocaleTimeString('pt-BR')}\n\n`;
                        corpo += `‚úÖ TUDO OK!\n\n`;
                        corpo += `Nenhum alerta ativo no momento.\n`;
                        corpo += `Seu estoque est√° funcionando perfeitamente!\n\n`;
                    } else {
                        const alertasCriticos = alertasAtivos.filter(a => a.prioridade === 'critica').length;
                        assunto = alertasCriticos > 0 ?
                            `üö® URGENTE - Doce Controle (${alertasAtivos.length} alertas)` :
                            `‚ö†Ô∏è Doce Controle - ${alertasAtivos.length} Alerta(s) (${dataAtual})`;

                        corpo = `DOCE CONTROLE - RELAT√ìRIO DE ALERTAS\n`;
                        corpo += `Data: ${dataAtual} √†s ${new Date().toLocaleTimeString('pt-BR')}\n\n`;
                        corpo += `‚ö†Ô∏è ${alertasAtivos.length} ALERTA(S) DETECTADO(S)\n\n`;

                        // Agrupar por prioridade
                        const criticos = alertasAtivos.filter(a => a.prioridade === 'critica');
                        const altos = alertasAtivos.filter(a => a.prioridade === 'alta');
                        const medios = alertasAtivos.filter(a => a.prioridade === 'media');

                        if (criticos.length > 0) {
                            corpo += `üö® CR√çTICOS (${criticos.length}):\n`;
                            criticos.forEach(alerta => {
                                corpo += `‚Ä¢ ${alerta.titulo}\n  ${alerta.descricao}\n`;
                            });
                            corpo += `\n`;
                        }

                        if (altos.length > 0) {
                            corpo += `‚ö†Ô∏è ALTA PRIORIDADE (${altos.length}):\n`;
                            altos.forEach(alerta => {
                                corpo += `‚Ä¢ ${alerta.titulo}\n  ${alerta.descricao}\n`;
                            });
                            corpo += `\n`;
                        }

                        if (medios.length > 0) {
                            corpo += `‚ö° M√âDIA PRIORIDADE (${medios.length}):\n`;
                            medios.forEach(alerta => {
                                corpo += `‚Ä¢ ${alerta.titulo}\n  ${alerta.descricao}\n`;
                            });
                            corpo += `\n`;
                        }
                    }

                    // Adicionar resumo do estoque
                    const totalProdutos = produtos.length;
                    const valorTotal = produtos.reduce((sum, p) => sum + (p.quantidade * p.preco), 0);

                    corpo += `üìä RESUMO DO ESTOQUE:\n`;
                    corpo += `‚Ä¢ Total de produtos: ${totalProdutos}\n`;
                    corpo += `‚Ä¢ Valor total: R$ ${valorTotal.toFixed(2)}\n`;
                    corpo += `‚Ä¢ √öltima verifica√ß√£o: ${new Date().toLocaleTimeString('pt-BR')}\n\n`;

                    corpo += `---\n`;
                    corpo += `Este √© um relat√≥rio autom√°tico do sistema Doce Controle.\n`;
                    corpo += `Para mais detalhes, acesse o sistema diretamente.`;

                    // Criar link do email
                    const assuntoCodificado = encodeURIComponent(assunto);
                    const corpoCodificado = encodeURIComponent(corpo);
                    const linkEmail = `mailto:${email}?subject=${assuntoCodificado}&body=${corpoCodificado}`;

                    // Abrir cliente de email
                    window.location.href = linkEmail;

                    alert('üìß Cliente de email aberto com a mensagem pronta!\n\nRevise e envie o email.');
                }

                function gerarRelatorioAlertas() {
                    // Verificar alertas atuais
                    verificarNotificacoes();

                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();

                    // Configurar fonte
                    doc.setFont('helvetica');

                    // Cabe√ßalho
                    doc.setFontSize(20);
                    doc.text('üßÅ DOCE CONTROLE', 20, 20);
                    doc.setFontSize(16);
                    doc.text('Relat√≥rio de Alertas do Sistema', 20, 30);

                    doc.setFontSize(12);
                    doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}`, 20, 45);

                    // Linha separadora
                    doc.line(20, 55, 190, 55);

                    let yPos = 70;

                    // Status geral
                    doc.setFontSize(14);
                    doc.setFont('helvetica', 'bold');

                    if (alertasAtivos.length === 0) {
                        doc.setTextColor(0, 150, 0); // Verde
                        doc.text('‚úÖ STATUS: TUDO OK!', 20, yPos);
                        yPos += 15;

                        doc.setTextColor(0, 0, 0); // Preto
                        doc.setFont('helvetica', 'normal');
                        doc.setFontSize(12);
                        doc.text('Nenhum alerta ativo detectado no momento.', 20, yPos);
                        doc.text('Seu estoque est√° funcionando perfeitamente!', 20, yPos + 8);
                        yPos += 25;
                    } else {
                        doc.setTextColor(200, 0, 0); // Vermelho
                        doc.text(`‚ö†Ô∏è ${alertasAtivos.length} ALERTA(S) DETECTADO(S)`, 20, yPos);
                        yPos += 20;

                        // Alertas por prioridade
                        const prioridades = [
                            { nome: 'CR√çTICOS', filtro: 'critica', cor: [200, 0, 0], icon: 'üö®' },
                            { nome: 'ALTA PRIORIDADE', filtro: 'alta', cor: [255, 140, 0], icon: '‚ö†Ô∏è' },
                            { nome: 'M√âDIA PRIORIDADE', filtro: 'media', cor: [255, 200, 0], icon: '‚ö°' }
                        ];

                        prioridades.forEach(prioridade => {
                            const alertasPrioridade = alertasAtivos.filter(a => a.prioridade === prioridade.filtro);

                            if (alertasPrioridade.length > 0) {
                                doc.setTextColor(...prioridade.cor);
                                doc.setFont('helvetica', 'bold');
                                doc.setFontSize(12);
                                doc.text(`${prioridade.icon} ${prioridade.nome} (${alertasPrioridade.length}):`, 20, yPos);
                                yPos += 10;

                                doc.setTextColor(0, 0, 0);
                                doc.setFont('helvetica', 'normal');
                                doc.setFontSize(10);

                                alertasPrioridade.forEach(alerta => {
                                    if (yPos > 270) {
                                        doc.addPage();
                                        yPos = 20;
                                    }

                                    doc.text(`‚Ä¢ ${alerta.titulo}`, 25, yPos);
                                    yPos += 6;
                                    doc.text(`  ${alerta.descricao}`, 25, yPos);
                                    yPos += 8;
                                });

                                yPos += 5;
                            }
                        });
                    }

                    // Resumo do estoque
                    if (yPos > 200) {
                        doc.addPage();
                        yPos = 20;
                    }

                    doc.setTextColor(0, 0, 0);
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(14);
                    doc.text('üìä RESUMO DO ESTOQUE', 20, yPos);
                    yPos += 15;

                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(12);

                    const totalProdutos = produtos.length;
                    const valorTotal = produtos.reduce((sum, p) => sum + (p.quantidade * p.preco), 0);
                    const estoqueBaixo = produtos.filter(p => getStatusEstoque(p.quantidade, p.unidade) === 'baixo').length;
                    const totalCategorias = [...new Set(produtos.map(p => p.categoria))].length;

                    doc.text(`Total de produtos cadastrados: ${totalProdutos}`, 20, yPos);
                    yPos += 8;
                    doc.text(`Produtos com estoque baixo: ${estoqueBaixo}`, 20, yPos);
                    yPos += 8;
                    doc.text(`N√∫mero de categorias: ${totalCategorias}`, 20, yPos);
                    yPos += 8;
                    doc.text(`Valor total do invent√°rio: R$ ${valorTotal.toFixed(2)}`, 20, yPos);
                    yPos += 15;

                    // Produtos com estoque baixo (detalhado)
                    if (estoqueBaixo > 0) {
                        doc.setFont('helvetica', 'bold');
                        doc.text('üî¥ PRODUTOS COM ESTOQUE BAIXO:', 20, yPos);
                        yPos += 10;

                        doc.setFont('helvetica', 'normal');
                        doc.setFontSize(10);

                        produtos.filter(p => getStatusEstoque(p.quantidade, p.unidade) === 'baixo').forEach(produto => {
                            if (yPos > 270) {
                                doc.addPage();
                                yPos = 20;
                            }

                            doc.text(`‚Ä¢ ${produto.nome}: ${produto.quantidade} ${produto.unidade}`, 25, yPos);
                            yPos += 6;
                        });
                    }

                    // Rodap√©
                    const totalPages = doc.internal.getNumberOfPages();
                    for (let i = 1; i <= totalPages; i++) {
                        doc.setPage(i);
                        doc.setFontSize(8);
                        doc.setTextColor(100, 100, 100);
                        doc.text(`P√°gina ${i} de ${totalPages}`, 20, 290);
                        doc.text('Relat√≥rio gerado automaticamente pelo sistema Doce Controle', 105, 290, { align: 'center' });
                    }

                    // Salvar PDF
                    const dataFormatada = new Date().toISOString().split('T')[0];
                    const horaFormatada = new Date().toTimeString().split(' ')[0].replace(/:/g, '');
                    const nomeArquivo = `relatorio_alertas_${dataFormatada}_${horaFormatada}.pdf`;

                    doc.save(nomeArquivo);

                    alert(`üìã Relat√≥rio completo gerado com sucesso!\n\nüìÅ ${nomeArquivo}\n\n${alertasAtivos.length > 0 ? '‚ö†Ô∏è ' + alertasAtivos.length + ' alerta(s) detectado(s)' : '‚úÖ Nenhum alerta ativo'}`);
                }

                // Inicializar sistema
                document.addEventListener('DOMContentLoaded', function () {
                    console.log('üßÅ Iniciando Doce Controle...');

                    // Carregar dados salvos primeiro
                    const dadosCarregados = carregarDados();

                    // Carregar configura√ß√µes salvas
                    carregarConfiguracoes();

                    // Carregar personaliza√ß√£o salva
                    carregarPersonalizacao();

                    // Atualizar interface
                    atualizarDashboard();
                    atualizarReceitas();
                    atualizarVendas();
                    atualizarListaCategorias();
                    atualizarSelectsCategorias();
                    atualizarEstatisticasCategorias();

                    // Configurar sistema de notifica√ß√µes
                    verificarNotificacoes();
                    configurarNotificacaoAutomatica();
                    solicitarPermissaoNotificacao();

                    // Mostrar status de inicializa√ß√£o
                    if (dadosCarregados) {
                        console.log(`‚úÖ Sistema carregado com dados existentes`);
                        console.log(`üì¶ ${produtos.length} produtos | üìù ${receitas.length} receitas | üí∞ ${vendas.length} vendas`);
                    } else {
                        console.log('üÜï Sistema iniciado vazio - Pronto para receber dados!');

                        // Mostrar mensagem de boas-vindas apenas na primeira vez
                        setTimeout(() => {
                            if (produtos.length === 0 && receitas.length === 0 && vendas.length === 0) {
                                alert(
                                    'üßÅ Bem-vindo ao Doce Controle!\n\n' +
                                    '‚ú® Sistema iniciado com sucesso!\n\n' +
                                    'üìã Para come√ßar:\n' +
                                    '‚Ä¢ Adicione seus primeiros produtos no Dashboard\n' +
                                    '‚Ä¢ Crie receitas na se√ß√£o Receitas\n' +
                                    '‚Ä¢ Registre vendas na se√ß√£o Vendas\n\n' +
                                    'üíæ Todos os dados s√£o salvos automaticamente no seu navegador!'
                                );
                            }
                        }, 1000);
                    }
                });
            </script>
            <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'98dbad57d31ae2a0',t:'MTc2MDMyNTM3NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>